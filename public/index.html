<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phoenix JARVIS - Holographic Mind Map</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Holographic HUD Frame -->
    <div class="hud-frame">
        <div class="corner-bracket top-left"></div>
        <div class="corner-bracket top-right"></div>
        <div class="corner-bracket bottom-left"></div>
        <div class="corner-bracket bottom-right"></div>
    </div>

    <!-- Top Date Bar -->
    <div class="date-bar">
        <div class="date-segment" id="date-day-1">01</div>
        <div class="date-segment" id="date-day-2">02</div>
        <div class="date-segment" id="date-day-3">03</div>
        <div class="date-segment" id="date-day-4">04</div>
        <div class="date-segment" id="date-day-5">05</div>
        <div class="date-segment" id="date-day-6">06</div>
        <div class="date-segment" id="date-day-7">07</div>
        <div class="date-segment" id="date-day-8">08</div>
        <div class="date-segment" id="date-day-9">09</div>
        <div class="date-segment" id="date-day-10">10</div>
        <div class="date-segment" id="date-day-11">11</div>
        <div class="date-segment" id="date-day-12">12</div>
        <div class="date-segment" id="date-day-13">13</div>
        <div class="date-segment" id="date-day-14">14</div>
        <div class="date-segment" id="date-day-15">15</div>
        <div class="date-segment" id="date-day-16">16</div>
        <div class="date-segment" id="date-day-17">17</div>
        <div class="date-segment" id="date-day-18">18</div>
        <div class="date-segment" id="date-day-19">19</div>
        <div class="date-segment" id="date-day-20">20</div>
        <div class="date-segment active" id="date-day-21">21</div>
        <div class="date-segment" id="date-day-22">22</div>
        <div class="date-segment" id="date-day-23">23</div>
        <div class="date-segment" id="date-day-24">24</div>
        <div class="date-segment" id="date-day-25">25</div>
        <div class="date-segment" id="date-day-26">26</div>
        <div class="date-segment" id="date-day-27">27</div>
        <div class="date-segment" id="date-day-28">28</div>
        <div class="date-segment" id="date-day-29">29</div>
        <div class="date-segment" id="date-day-30">30</div>
    </div>

    <!-- Left Panel: Vitals -->
    <div class="panel-left vitals-panel">
        <div class="panel-section" id="hrv-section">
            <div class="metric-label">HRV</div>
            <div class="metric-value" id="hrv-value">--</div>
            <div class="metric-unit">ms</div>
        </div>
        
        <div class="panel-section" id="rhr-section">
            <div class="metric-label">RHR</div>
            <div class="metric-value" id="rhr-value">--</div>
            <div class="metric-unit">bpm</div>
        </div>
        
        <div class="panel-section" id="recovery-section">
            <div class="metric-label">RECOVERY</div>
            <div class="metric-value" id="recovery-value">--</div>
            <div class="metric-unit">%</div>
            <div class="metric-status" id="recovery-status">Calculating...</div>
        </div>
        
        <div class="panel-section" id="o2-section">
            <div class="metric-label">O‚ÇÇ</div>
            <div class="metric-value" id="o2-value">--</div>
            <div class="metric-unit">%</div>
        </div>

        <div class="panel-section weather-section" id="weather-section">
            <div class="metric-label">WEATHER</div>
            <div class="weather-temp" id="weather-temp">--¬∞F</div>
            <div class="weather-status" id="weather-status">Loading...</div>
        </div>
    </div>

    <!-- Right Panel: System Info & Goals -->
    <div class="panel-right">
        <div class="system-time-panel">
            <div class="time-label">SYSTEM TIME</div>
            <div class="time-display" id="system-time">00:00</div>
            <div class="date-display" id="system-date">LOADING...</div>
            <div class="location-display" id="location">Sarasota, Florida</div>
        </div>

        <div class="goals-panel" id="goals-panel">
            <div class="panel-title">GOALS PROGRESS</div>
            <div class="goals-fraction" id="goals-fraction">0/0</div>
            <div class="goals-percentage" id="goals-percentage">0% Complete</div>
            <div class="goals-list" id="goals-list"></div>
        </div>

        <div class="quick-notes-panel">
            <div class="panel-title">Notes</div>
            <div class="notes-content">
                <div class="notes-header">Things to do:</div>
                <div class="notes-list" id="notes-list">
                    <div class="note-item">‚Ä¢ Sync wearables</div>
                    <div class="note-item">‚Ä¢ Review health data</div>
                </div>
            </div>
            <button class="add-note-btn" id="add-note-btn">+</button>
        </div>
    </div>

    <!-- Center: Mind Map Canvas -->
    <div class="mind-map-container" id="mind-map-container">
        <!-- Phoenix Core Reactor -->
        <div class="phoenix-core" id="phoenix-core">
            <div class="core-rings">
                <div class="core-ring ring-1"></div>
                <div class="core-ring ring-2"></div>
                <div class="core-ring ring-3"></div>
            </div>
            <div class="core-center">
                <div class="core-glow"></div>
                <div class="core-text">PHOENIX</div>
            </div>
        </div>

        <!-- Greeting Message -->
        <div class="phoenix-greeting" id="phoenix-greeting">
            <div class="greeting-text">Good evening, Josh</div>
            <div class="greeting-subtitle">Wind down mode. Focus on recovery and tomorrow's preparation.</div>
        </div>

        <!-- Planets Container -->
        <div class="planets-container" id="planets-container">
            <!-- Mercury -->
            <div class="planet-gear mercury" id="planet-mercury" data-planet="mercury">
                <div class="gear-outer"></div>
                <div class="gear-inner"></div>
                <div class="planet-icon">‚òø</div>
                <div class="planet-label">MERCURY</div>
                <div class="planet-sublabel">Health</div>
                <div class="planet-metric" id="mercury-metric">--</div>
                <div class="loading-ring"></div>
            </div>

            <!-- Venus -->
            <div class="planet-gear venus" id="planet-venus" data-planet="venus">
                <div class="gear-outer"></div>
                <div class="gear-inner"></div>
                <div class="planet-icon">‚ôÄ</div>
                <div class="planet-label">VENUS</div>
                <div class="planet-sublabel">Fitness</div>
                <div class="planet-metric" id="venus-metric">--</div>
                <div class="loading-ring"></div>
            </div>

            <!-- Earth -->
            <div class="planet-gear earth" id="planet-earth" data-planet="earth">
                <div class="gear-outer"></div>
                <div class="gear-inner"></div>
                <div class="planet-icon">üåç</div>
                <div class="planet-label">EARTH</div>
                <div class="planet-sublabel">Calendar</div>
                <div class="planet-metric" id="earth-metric">--</div>
                <div class="loading-ring"></div>
            </div>

            <!-- Mars -->
            <div class="planet-gear mars" id="planet-mars" data-planet="mars">
                <div class="gear-outer"></div>
                <div class="gear-inner"></div>
                <div class="planet-icon">‚ôÇ</div>
                <div class="planet-label">MARS</div>
                <div class="planet-sublabel">Goals</div>
                <div class="planet-metric" id="mars-metric">--</div>
                <div class="loading-ring"></div>
            </div>

            <!-- Jupiter -->
            <div class="planet-gear jupiter" id="planet-jupiter" data-planet="jupiter">
                <div class="gear-outer"></div>
                <div class="gear-inner"></div>
                <div class="planet-icon">‚ôÉ</div>
                <div class="planet-label">JUPITER</div>
                <div class="planet-sublabel">Finance</div>
                <div class="planet-metric" id="jupiter-metric">--</div>
                <div class="loading-ring"></div>
            </div>

            <!-- Saturn -->
            <div class="planet-gear saturn" id="planet-saturn" data-planet="saturn">
                <div class="gear-outer"></div>
                <div class="gear-inner"></div>
                <div class="planet-icon">‚ôÑ</div>
                <div class="planet-label">SATURN</div>
                <div class="planet-sublabel">Legacy</div>
                <div class="planet-metric" id="saturn-metric">--</div>
                <div class="loading-ring"></div>
            </div>
        </div>

        <!-- Correlation Lines -->
        <svg class="correlation-lines" id="correlation-lines">
            <!-- Lines drawn dynamically -->
        </svg>
    </div>

    <!-- Bottom: Quick Action Bar -->
    <div class="quick-actions-bar">
        <button class="action-btn" id="sync-wearables-btn">
            <span class="btn-icon">‚ü≥</span>
            <span class="btn-text">SYNC WEARABLES</span>
        </button>
        
        <button class="action-btn" id="todays-goals-btn">
            <span class="btn-icon">‚óé</span>
            <span class="btn-text">TODAY'S GOALS</span>
        </button>
        
        <button class="action-btn" id="health-analysis-btn">
            <span class="btn-icon">‚úö</span>
            <span class="btn-text">HEALTH ANALYSIS</span>
        </button>
    </div>

    <!-- Expanded Dashboard Overlay (Level 1) -->
    <div class="dashboard-overlay" id="dashboard-overlay">
        <div class="dashboard-container">
            <button class="dashboard-close" id="dashboard-close">√ó</button>
            <div class="dashboard-header">
                <h2 id="dashboard-title">PLANET NAME</h2>
                <div class="dashboard-subtitle" id="dashboard-subtitle">Loading...</div>
            </div>
            <div class="dashboard-content" id="dashboard-content">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Sync Wearables Modal -->
    <div class="modal-overlay" id="sync-modal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Sync Wearables</h3>
                <button class="modal-close" onclick="closeSyncModal()">√ó</button>
            </div>
            <div class="modal-content">
                <div class="wearable-option" id="sync-fitbit">
                    <div class="wearable-icon">üì±</div>
                    <div class="wearable-name">Fitbit</div>
                    <div class="wearable-status" id="fitbit-status">Not Connected</div>
                    <button class="connect-btn" onclick="connectFitbit()">Connect</button>
                </div>
                <div class="wearable-option" id="sync-polar">
                    <div class="wearable-icon">‚åö</div>
                    <div class="wearable-name">Polar</div>
                    <div class="wearable-status" id="polar-status">Not Connected</div>
                    <button class="connect-btn" onclick="connectPolar()">Connect</button>
                </div>
                <div class="wearable-option" id="sync-oura">
                    <div class="wearable-icon">üíç</div>
                    <div class="wearable-name">Oura Ring</div>
                    <div class="wearable-status">Coming Soon</div>
                </div>
                <div class="sync-status" id="sync-status"></div>
            </div>
        </div>
    </div>

    <!-- Voice Interface -->
    <div class="voice-button" id="voice-button">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#00ffff">
            <path d="M12 15c1.66 0 3-1.34 3-3V6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3z"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
        </svg>
    </div>

    <!-- Chat Interface -->
    <div class="chat-interface" id="chat-interface">
        <div class="chat-messages" id="chat-messages"></div>
        <input type="text" class="chat-input" id="chat-input" placeholder="Ask Phoenix anything...">
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Initializing Phoenix...</div>
    </div>

    <!-- Scripts -->
    <script type="module" src="api.js"></script>
    <script type="module" src="jarvis.js"></script>
    <script src="planets.js"></script>
    <script src="reactor.js"></script>
    <script src="voice.js"></script>
    <script src="shaders.js"></script>

    <script>
    // Modal controls
    function closeSyncModal() {
        document.getElementById('sync-modal').style.display = 'none';
    }

    async function connectFitbit() {
        document.getElementById('fitbit-status').textContent = 'Connecting...';
        
        const token = localStorage.getItem('phoenixToken');
        
        if (!token) {
            alert('Please log in first');
            document.getElementById('fitbit-status').textContent = 'Not Connected';
            return;
        }
        
        try {
            // Call backend to get OAuth URL
            const response = await fetch('https://pal-backend-production.up.railway.app/api/wearables/connect/fitbit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            });
            
            const data = await response.json();
            
            if (data.success && data.authUrl) {
                // Redirect to Fitbit authorization
                window.location.href = data.authUrl;
            } else {
                document.getElementById('fitbit-status').textContent = 'Connection failed';
                alert('Failed to connect: ' + (data.error || 'Unknown error'));
            }
        } catch (error) {
            console.error('Connection error:', error);
            document.getElementById('fitbit-status').textContent = 'Connection failed';
            alert('Network error. Please try again.');
        }
    }

    async function connectPolar() {
        document.getElementById('polar-status').textContent = 'Connecting...';
        
        const token = localStorage.getItem('phoenixToken');
        
        if (!token) {
            alert('Please log in first');
            document.getElementById('polar-status').textContent = 'Not Connected';
            return;
        }
        
        try {
            const response = await fetch('https://pal-backend-production.up.railway.app/api/wearables/connect/polar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            });
            
            const data = await response.json();
            
            if (data.success && data.authUrl) {
                window.location.href = data.authUrl;
            } else {
                document.getElementById('polar-status').textContent = 'Connection failed';
                alert('Failed to connect: ' + (data.error || 'Unknown error'));
            }
        } catch (error) {
            console.error('Connection error:', error);
            document.getElementById('polar-status').textContent = 'Connection failed';
            alert('Network error. Please try again.');
        }
    }

    // Initialize time display
    function updateSystemTime() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        document.getElementById('system-time').textContent = `${hours}:${minutes}`;
        
        const days = ['SUNDAY', 'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY'];
        const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
        const dateStr = `${days[now.getDay()]}, ${months[now.getMonth()]} ${now.getDate()}`;
        document.getElementById('system-date').textContent = dateStr;

        // Highlight current day
        const currentDay = now.getDate();
        document.querySelectorAll('.date-segment').forEach((seg, i) => {
            seg.classList.toggle('active', i + 1 === currentDay);
        });
    }

    updateSystemTime();
    setInterval(updateSystemTime, 1000);

    // Sync button handler
    document.getElementById('sync-wearables-btn').addEventListener('click', () => {
        document.getElementById('sync-modal').style.display = 'flex';
    });
</script>
</body>
</html>
