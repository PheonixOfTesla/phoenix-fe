<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Phoenix - Your AI Companion for Life Optimization">
    <title>Phoenix JARVIS - AI Life Companion</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="/phoenix-voice.css">
</head>
<body>
    <!-- ============================================ -->
    <!-- LOADING SCREEN -->
    <!-- ============================================ -->
    <div id="loading" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10000;transition:opacity 1s">
        <div style="font-size:64px;color:#00ffff;text-shadow:0 0 30px rgba(0,255,255,1);letter-spacing:12px;margin-bottom:30px;animation:pulse 2s infinite">PHOENIX</div>
        <div style="width:60px;height:60px;border:3px solid rgba(0,255,255,0.2);border-top-color:#00ffff;border-radius:50%;animation:spin 1s linear infinite"></div>
        <div style="margin-top:30px;color:rgba(0,255,255,0.7);font-size:14px;letter-spacing:2px">INITIALIZING AI SYSTEMS...</div>
    </div>

    <!-- ============================================ -->
    <!-- ONBOARDING ACTIVATION (First-Time Users) -->
    <!-- ============================================ -->
    <div id="onboarding" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.98);z-index:9000;display:none;align-items:center;justify-content:center;flex-direction:column">
        <div style="font-size:48px;color:#00ffff;margin-bottom:20px;text-shadow:0 0 30px rgba(0,255,255,1);letter-spacing:8px">PHOENIX</div>
        <div style="font-size:18px;color:rgba(0,255,255,0.7);text-align:center;max-width:600px;margin-bottom:40px;line-height:1.6">
            Your AI companion is ready to optimize every aspect of your life.<br>
            Tap below to activate and begin your journey.
        </div>
        <button id="activate-btn" style="padding:20px 60px;background:rgba(0,255,255,0.1);border:2px solid #00ffff;color:#00ffff;font-family:inherit;font-size:18px;cursor:pointer;transition:all 0.3s;letter-spacing:2px;border-radius:8px">
            ACTIVATE PHOENIX
        </button>
    </div>

    <!-- ============================================ -->
    <!-- HUD FRAME & CORNER BRACKETS -->
    <!-- ============================================ -->
    <div class="hud-frame">
        <div class="corner-bracket top-left"></div>
        <div class="corner-bracket top-right"></div>
        <div class="corner-bracket bottom-left"></div>
        <div class="corner-bracket bottom-right"></div>
    </div>

    <!-- ============================================ -->
    <!-- VISUAL EFFECTS LAYERS -->
    <!-- ============================================ -->
    <div class="grid-underlay"></div>
    <div class="vhs-overlay"></div>

    <!-- ============================================ -->
    <!-- PERSONALIZED GREETING -->
    <!-- ============================================ -->
    <div id="greeting" style="position:fixed;top:25%;left:50%;transform:translateX(-50%);text-align:center;z-index:500;opacity:0;animation:fadeIn 1s 1s forwards">
        <div class="greeting-main" style="font-size:32px;color:#00ffff;margin-bottom:10px;text-shadow:0 0 20px rgba(0,255,255,1)">Welcome</div>
        <div class="greeting-sub" style="font-size:14px;color:rgba(0,255,255,0.6)">Initializing AI companion systems...</div>
    </div>

    <!-- ============================================ -->
    <!-- TOP LEFT HUD: TIME, DATE, WEATHER, LOCATION -->
    <!-- Blueprint Requirement: Real-time clock, weather, IP geolocation -->
    <!-- ============================================ -->
    <div id="hud-tl" style="position:fixed;top:20px;left:20px;z-index:1000;pointer-events:none;padding:15px;background:rgba(0,10,20,0.8);border:1px solid rgba(0,255,255,0.3);backdrop-filter:blur(10px);border-radius:8px;min-width:220px">
        <!-- Time Display -->
        <div style="font-size:9px;color:rgba(0,255,255,0.5);letter-spacing:1px">LOCAL TIME</div>
        <div id="time-display" style="font-size:18px;color:#00ffff;font-weight:bold;text-shadow:0 0 10px rgba(0,255,255,0.8);margin-bottom:10px">--:--</div>
        
        <!-- Date Display -->
        <div style="font-size:9px;color:rgba(0,255,255,0.5);letter-spacing:1px">DATE</div>
        <div id="date-display" style="font-size:12px;color:#00ffff;margin-bottom:10px">---</div>
        
        <!-- Weather & Location (NEW - Blueprint Requirement) -->
        <div style="font-size:9px;color:rgba(0,255,255,0.5);letter-spacing:1px">LOCATION</div>
        <div id="location-display" style="font-size:11px;color:#00ffff;margin-bottom:5px">Detecting...</div>
        
        <div style="font-size:9px;color:rgba(0,255,255,0.5);letter-spacing:1px;margin-top:8px">WEATHER</div>
        <div id="weather-display" style="font-size:14px;color:#00ffff;display:flex;align-items:center;gap:8px;margin-top:4px">
            <span id="weather-icon">‚òÄÔ∏è</span>
            <span id="weather-temp">--¬∞F</span>
            <span id="weather-condition" style="font-size:10px;color:rgba(0,255,255,0.7)">Loading...</span>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- TOP RIGHT HUD: RECOVERY SCORE -->
    <!-- Blueprint Requirement: Real-time recovery with visual bar -->
    <!-- ============================================ -->
    <div id="hud-tr" style="position:fixed;top:20px;right:20px;z-index:1000;pointer-events:none;text-align:right;padding:15px;background:rgba(0,10,20,0.8);border:1px solid rgba(0,255,255,0.3);backdrop-filter:blur(10px);border-radius:8px;min-width:140px">
        <div style="font-size:9px;color:rgba(0,255,255,0.5);letter-spacing:1px">RECOVERY</div>
        <div id="recovery-value" style="font-size:20px;color:#00ffff;font-weight:bold;margin:5px 0">--</div>
        <div style="width:120px;height:6px;background:rgba(0,255,255,0.2);margin:8px 0;border-radius:3px;overflow:hidden">
            <div id="recovery-fill" style="width:0%;height:100%;background:linear-gradient(90deg, #00ffff, #00ff88);transition:width 0.5s;box-shadow:0 0 10px rgba(0,255,255,0.6)"></div>
        </div>
        <div id="recovery-status" style="font-size:9px;color:rgba(0,255,255,0.6);margin-top:4px">Analyzing...</div>
    </div>

    <!-- ============================================ -->
    <!-- BOTTOM LEFT HUD: SYSTEM STATUS -->
    <!-- Blueprint Requirement: Status indicators, butler status -->
    <!-- ============================================ -->
    <div id="hud-bl" style="position:fixed;bottom:20px;left:20px;z-index:1000;pointer-events:none;padding:15px;background:rgba(0,10,20,0.8);border:1px solid rgba(0,255,255,0.3);backdrop-filter:blur(10px);border-radius:8px;min-width:180px">
        <div style="font-size:9px;color:rgba(0,255,255,0.5);letter-spacing:1px">SYSTEM STATUS</div>
        <div id="status-display" style="font-size:13px;color:#00ff88;font-weight:bold;margin:5px 0;display:flex;align-items:center;gap:8px">
            <span style="width:8px;height:8px;background:#00ff88;border-radius:50%;box-shadow:0 0 10px #00ff88;animation:pulse 2s infinite"></span>
            ONLINE
        </div>
        
        <!-- Butler Status -->
        <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(0,255,255,0.2)">
            <div id="butler-status" style="font-size:11px;color:rgba(0,255,255,0.8);display:flex;align-items:center;gap:6px">
                ü§µ <span>Butler Ready</span>
            </div>
            <div id="devices-status" style="font-size:9px;color:rgba(0,255,255,0.5);margin-top:8px">
                <span id="devices-count">0</span> devices connected
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- BOTTOM RIGHT HUD: MODE INDICATOR -->
    <!-- Blueprint Requirement: Active mode display -->
    <!-- ============================================ -->
    <div id="hud-br" style="position:fixed;bottom:20px;right:200px;z-index:1000;pointer-events:none;text-align:right;padding:15px;background:rgba(0,10,20,0.8);border:1px solid rgba(0,255,255,0.3);backdrop-filter:blur(10px);border-radius:8px">
        <div style="font-size:9px;color:rgba(0,255,255,0.5);letter-spacing:1px">MODE</div>
        <div id="mode-display" style="font-size:14px;color:#00ffff;font-weight:bold;margin-top:5px">ACTIVE</div>
        <div id="ai-personality" style="font-size:9px;color:rgba(0,255,255,0.6);margin-top:8px">Echo (British Butler)</div>
    </div>

    <!-- ============================================ -->
    <!-- LOGOUT BUTTON -->
    <!-- ============================================ -->
    <button id="logout-btn" style="position:fixed;top:20px;right:20px;padding:10px 20px;background:rgba(255,68,68,0.1);border:1px solid rgba(255,68,68,0.5);color:#ff4444;font-family:inherit;font-size:11px;cursor:pointer;z-index:1001;letter-spacing:1px;border-radius:6px;transition:all 0.3s">
        LOGOUT
    </button>

    <!-- ============================================ -->
    <!-- CIRCULAR ACTION MENU -->
    <!-- Blueprint Requirement: 6 primary actions in circular layout -->
    <!-- Triggered by: Clicking Phoenix Core -->
    <!-- ============================================ -->
    <div id="action-menu" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:8000;display:none">
        <div style="position:relative;width:400px;height:400px">
            <!-- Workout (Mercury) -->
            <div class="action-button-circular" id="action-workout" data-tooltip="Log workouts, view performance" style="position:absolute;top:10%;left:50%;transform:translate(-50%,-50%);width:80px;height:80px;background:rgba(0,10,20,0.9);border:2px solid rgba(255,107,53,0.5);border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s">
                <div style="font-size:28px;margin-bottom:5px">üí™</div>
                <div style="font-size:10px;color:#ff6b35;letter-spacing:1px;font-weight:bold">WORKOUT</div>
            </div>
            
            <!-- Meal (Venus) -->
            <div class="action-button-circular" id="action-meal" data-tooltip="Log meals, track macros" style="position:absolute;top:30%;right:10%;transform:translate(50%,-50%);width:80px;height:80px;background:rgba(0,10,20,0.9);border:2px solid rgba(255,102,255,0.5);border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s">
                <div style="font-size:28px;margin-bottom:5px">üçΩÔ∏è</div>
                <div style="font-size:10px;color:#ff66ff;letter-spacing:1px;font-weight:bold">MEAL</div>
            </div>
            
            <!-- Goals (Mars) -->
            <div class="action-button-circular" id="action-goals" data-tooltip="Track goals & habits" style="position:absolute;bottom:30%;right:10%;transform:translate(50%,50%);width:80px;height:80px;background:rgba(0,10,20,0.9);border:2px solid rgba(255,68,68,0.5);border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s">
                <div style="font-size:28px;margin-bottom:5px">üéØ</div>
                <div style="font-size:10px;color:#ff4444;letter-spacing:1px;font-weight:bold">GOALS</div>
            </div>
            
            <!-- Chat (Phoenix AI) -->
            <div class="action-button-circular" id="action-chat" data-tooltip="Talk to Phoenix AI" style="position:absolute;bottom:10%;left:50%;transform:translate(-50%,50%);width:80px;height:80px;background:rgba(0,10,20,0.9);border:2px solid rgba(0,255,255,0.5);border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s">
                <div style="font-size:28px;margin-bottom:5px">üí¨</div>
                <div style="font-size:10px;color:#00ffff;letter-spacing:1px;font-weight:bold">CHAT</div>
            </div>
            
            <!-- Butler (Autonomous Actions) -->
            <div class="action-button-circular" id="action-butler" data-tooltip="Order food, book rides, etc." style="position:absolute;bottom:30%;left:10%;transform:translate(-50%,50%);width:80px;height:80px;background:rgba(0,10,20,0.9);border:2px solid rgba(0,255,136,0.5);border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s">
                <div style="font-size:28px;margin-bottom:5px">ü§µ</div>
                <div style="font-size:10px;color:#00ff88;letter-spacing:1px;font-weight:bold">BUTLER</div>
            </div>
            
            <!-- Insights (Analytics) -->
            <div class="action-button-circular" id="action-insights" data-tooltip="View AI insights & patterns" style="position:absolute;top:30%;left:10%;transform:translate(-50%,-50%);width:80px;height:80px;background:rgba(0,10,20,0.9);border:2px solid rgba(255,170,0,0.5);border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s">
                <div style="font-size:28px;margin-bottom:5px">üìä</div>
                <div style="font-size:10px;color:#ffaa00;letter-spacing:1px;font-weight:bold">INSIGHTS</div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- PLANET DETAIL MODAL -->
    <!-- Blueprint Requirement: Full-screen dashboard for each planetary system -->
    <!-- Shows: Mercury (Health), Venus (Fitness), Earth (Calendar), Mars (Goals), Jupiter (Finance), Saturn (Legacy) -->
    <!-- ============================================ -->
    <div id="planet-detail" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.98);z-index:7000;display:none;overflow-y:auto">
        <div id="close-detail" style="position:fixed;top:30px;right:30px;width:50px;height:50px;background:rgba(0,10,20,0.9);border:2px solid rgba(0,255,255,0.5);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:24px;color:#00ffff;z-index:7100;transition:all 0.3s">
            ‚úï
        </div>
        
        <div style="padding:40px;text-align:center">
            <div id="detail-title" style="font-size:36px;color:#00ffff;text-shadow:0 0 20px rgba(0,255,255,1);margin-bottom:10px">LOADING...</div>
            <div id="detail-subtitle" style="font-size:14px;color:rgba(0,255,255,0.6);margin-bottom:30px">Fetching data...</div>
        </div>
        
        <div id="detail-content" style="padding:40px;max-width:1200px;margin:0 auto">
            <!-- Dynamic content loaded by planets.js -->
        </div>
    </div>

    <!-- ============================================ -->
    <!-- QUICK ACTIONS BAR -->
    <!-- Blueprint Requirement: Fast access to primary actions -->
    <!-- ============================================ -->
    <div id="quick-actions" style="position:fixed;bottom:30px;left:50%;transform:translateX(-50%);display:flex;gap:15px;z-index:6000;opacity:0;animation:fadeIn 1s 2s forwards">
        <button id="quick-workout" class="quick-action-btn" data-tooltip="üí™ Log Workout">
            LOG WORKOUT
        </button>
        <button id="quick-meal" class="quick-action-btn" data-tooltip="üçΩÔ∏è Log Meal">
            LOG MEAL
        </button>
        <button id="quick-butler" class="quick-action-btn" data-tooltip="ü§µ Butler Actions">
            ü§µ BUTLER
        </button>
        <button id="quick-chat" class="quick-action-btn" data-tooltip="üí¨ Voice Chat">
            ASK PHOENIX
        </button>
    </div>

    <!-- ============================================ -->
    <!-- THREE.JS SOLAR SYSTEM CONTAINER -->
    <!-- Blueprint Requirement: 3D planetary visualization -->
    <!-- ============================================ -->
    <div id="container"></div>

    <!-- ============================================ -->
    <!-- PHOENIX CORE - CENTER SPHERE -->
    <!-- Blueprint Requirement: Interactive AI core with particle effects -->
    <!-- Click to: Open action menu -->
    <!-- ============================================ -->
    <div id="phoenix-core-container" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:200px;height:200px;z-index:500;pointer-events:auto;cursor:pointer">
        <!-- Orbital Rings -->
        <div style="position:absolute;top:0;left:0;width:100%;height:100%">
            <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100%;height:100%;border:1px solid rgba(0,255,255,0.4);border-radius:50%;animation:coreRotate 20s linear infinite"></div>
            <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:120%;height:120%;border:1px dashed rgba(0,255,255,0.3);border-radius:50%;animation:coreRotate 15s linear infinite reverse"></div>
            <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:140%;height:140%;border:1px dotted rgba(0,255,255,0.2);border-radius:50%;animation:coreRotate 25s linear infinite"></div>
        </div>
        
        <!-- Core Sphere -->
        <div id="phoenix-sphere" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100px;height:100px;background:radial-gradient(circle,rgba(0,255,255,0.8),rgba(0,255,255,0.2));border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 0 50px rgba(0,255,255,0.8),inset 0 0 30px rgba(0,255,255,0.4);animation:corePulse 2s ease-in-out infinite">
            <div style="font-size:14px;font-weight:bold;color:#00ffff;text-shadow:0 0 10px rgba(0,255,255,1);letter-spacing:3px;z-index:1">PHOENIX</div>
        </div>
        
        <!-- Particle Canvas -->
        <canvas id="phoenix-particles" width="200" height="200" style="position:absolute;top:0;left:0;pointer-events:none"></canvas>
    </div>

    <!-- ============================================ -->
    <!-- ENERGY BEAMS (SVG) -->
    <!-- Blueprint Requirement: Visual connections between planets and core -->
    <!-- ============================================ -->
    <svg id="energy-beams" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:450"></svg>

    <!-- ============================================ -->
    <!-- DATA CONSTELLATION -->
    <!-- Blueprint Requirement: Floating data points visualization -->
    <!-- ============================================ -->
    <div id="data-constellation" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:600"></div>

    <!-- ============================================ -->
    <!-- VOICE OVERLAY -->
    <!-- Blueprint Requirement: Full-screen voice interaction UI -->
    <!-- Triggered by: Voice button, "Ask Phoenix" -->
    <!-- ============================================ -->
    <div id="voice-overlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:none;align-items:center;justify-content:center;z-index:9000;flex-direction:column">
        <div style="width:200px;height:100px;margin-bottom:30px">
            <canvas id="waveform-canvas" width="200" height="100"></canvas>
        </div>
        <div id="voice-text" style="color:#00ffff;font-size:18px;text-align:center;padding:20px;max-width:80%;margin-bottom:20px;min-height:60px">
            Listening...
        </div>
        <div style="font-size:12px;color:rgba(0,255,255,0.5);text-align:center;max-width:600px;line-height:1.8">
            <strong>Try saying:</strong><br>
            "What's my recovery score?" | "Order Thai food" | "Book an Uber to the airport"<br>
            "How did I sleep?" | "Show my workout history" | "What's my spending this week?"
        </div>
        <button onclick="window.phoenix?.activateVoice()" style="margin-top:30px;padding:12px 30px;background:rgba(255,68,68,0.2);border:1px solid rgba(255,68,68,0.5);color:#ff4444;cursor:pointer;border-radius:6px;font-size:12px">
            CANCEL
        </button>
    </div>

    <!-- ============================================ -->
    <!-- BUTLER QUICK ACTIONS PANEL -->
    <!-- Blueprint Requirement: Fast butler actions with real-world examples -->
    <!-- Triggered by: Butler button, voice command "open butler" -->
    <!-- ============================================ -->
    <div id="butler-panel" style="position:fixed;bottom:180px;right:24px;z-index:9998;background:rgba(0,10,20,0.95);border:2px solid rgba(0,255,255,0.5);border-radius:12px;padding:20px;max-width:320px;display:none;backdrop-filter:blur(10px);box-shadow:0 0 40px rgba(0,255,255,0.3)">
        <div style="font-size:18px;color:#00ffff;margin-bottom:8px;font-weight:bold;text-shadow:0 0 10px rgba(0,255,255,0.8)">
            ü§µ Butler Actions
        </div>
        <div style="font-size:11px;color:rgba(0,255,255,0.6);margin-bottom:20px">
            Quick actions or use voice commands
        </div>
        
        <div style="display:grid;gap:10px">
            <!-- Food Ordering -->
            <button class="butler-quick-btn" onclick="butlerAction('food')" data-example="Order Thai food from Sukhothai">
                <span style="font-size:20px">üçî</span>
                <span>Order Food</span>
            </button>
            
            <!-- Ride Booking -->
            <button class="butler-quick-btn" onclick="butlerAction('ride')" data-example="Book Uber to airport">
                <span style="font-size:20px">üöó</span>
                <span>Book Ride</span>
            </button>
            
            <!-- Restaurant Reservation -->
            <button class="butler-quick-btn" onclick="butlerAction('reservation')" data-example="Reserve table at Nobu 7pm">
                <span style="font-size:20px">üçΩÔ∏è</span>
                <span>Reserve Table</span>
            </button>
            
            <!-- Calendar Event -->
            <button class="butler-quick-btn" onclick="butlerAction('calendar')" data-example="Add sleep 2-4pm today">
                <span style="font-size:20px">üìÖ</span>
                <span>Schedule Event</span>
            </button>
            
            <!-- Email -->
            <button class="butler-quick-btn" onclick="butlerAction('email')" data-example="Send email to John about meeting">
                <span style="font-size:20px">üìß</span>
                <span>Send Email</span>
            </button>
            
            <!-- Phone Call -->
            <button class="butler-quick-btn" onclick="butlerAction('call')" data-example="Call Mom">
                <span style="font-size:20px">üìû</span>
                <span>Make Call</span>
            </button>
        </div>
        
        <div style="margin-top:15px;padding-top:15px;border-top:1px solid rgba(0,255,255,0.3)">
            <button onclick="toggleButlerPanel()" style="width:100%;padding:8px;background:transparent;border:1px solid rgba(0,255,255,0.3);color:rgba(0,255,255,0.7);font-size:11px;cursor:pointer;border-radius:6px;transition:all 0.3s">
                CLOSE
            </button>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- VOICE CONTROLS (BOTTOM RIGHT) -->
    <!-- Blueprint Requirement: Persistent voice controls with personality selector -->
    <!-- ============================================ -->
    <div class="voice-controls" style="position:fixed;bottom:20px;right:20px;z-index:6000;display:flex;flex-direction:column;gap:10px;align-items:flex-end">
        <!-- Voice Status Indicator -->
        <div id="voice-status" class="voice-status idle" style="padding:8px 16px;background:rgba(0,10,20,0.9);border:1px solid rgba(0,255,255,0.3);border-radius:20px;font-size:11px;color:rgba(0,255,255,0.7);display:flex;align-items:center;gap:8px">
            <span style="width:8px;height:8px;background:#00ffff;border-radius:50%;animation:pulse 2s infinite"></span>
            Ready
        </div>
        
        <!-- Voice Button -->
        <button class="voice-btn" onclick="toggleVoice()" style="padding:12px 24px;background:rgba(0,255,255,0.1);border:2px solid rgba(0,255,255,0.5);color:#00ffff;font-size:14px;cursor:pointer;border-radius:8px;transition:all 0.3s;display:flex;align-items:center;gap:10px;font-weight:bold;letter-spacing:1px">
            <span style="font-size:18px">üéôÔ∏è</span>
            TALK TO PHOENIX
        </button>
        
        <!-- Voice Personality Selector -->
        <select class="voice-selector" onchange="changeVoice(this.value)" style="padding:8px 12px;background:rgba(0,10,20,0.9);border:1px solid rgba(0,255,255,0.3);color:#00ffff;font-size:11px;cursor:pointer;border-radius:6px;outline:none">
            <option value="echo">üá¨üáß Echo - British Butler (Recommended)</option>
            <option value="nova">üòä Nova - Friendly Helper</option>
            <option value="onyx">üíº Onyx - Professional</option>
            <option value="fable">‚ú® Fable - Storyteller</option>
            <option value="shimmer">üå∏ Shimmer - Gentle Guide</option>
            <option value="alloy">‚ö° Alloy - Efficient</option>
        </select>
    </div>

    <!-- ============================================ -->
    <!-- COMMAND EXAMPLES TOOLTIP -->
    <!-- Blueprint Requirement: Help users discover voice commands -->
    <!-- ============================================ -->
    <div id="command-examples" style="position:fixed;bottom:140px;right:24px;z-index:5999;background:rgba(0,10,20,0.95);border:2px solid rgba(0,255,255,0.3);border-radius:12px;padding:20px;max-width:350px;display:none;backdrop-filter:blur(10px)">
        <div style="font-size:14px;color:#00ffff;margin-bottom:15px;font-weight:bold">üí¨ Voice Command Examples</div>
        
        <div style="font-size:11px;color:rgba(0,255,255,0.8);line-height:1.8">
            <strong>Butler Actions:</strong><br>
            ‚Ä¢ "Order Thai food from Sukhothai"<br>
            ‚Ä¢ "Book me an Uber to the airport"<br>
            ‚Ä¢ "Make a reservation at Nobu for 7pm"<br>
            ‚Ä¢ "Call Mom"<br><br>
            
            <strong>Health Questions:</strong><br>
            ‚Ä¢ "What's my recovery score?"<br>
            ‚Ä¢ "How did I sleep last night?"<br>
            ‚Ä¢ "Am I ready to train hard today?"<br><br>
            
            <strong>Fitness Questions:</strong><br>
            ‚Ä¢ "Show my workout history"<br>
            ‚Ä¢ "What are my macros today?"<br>
            ‚Ä¢ "Did I hit my protein goal?"<br><br>
            
            <strong>Finance Questions:</strong><br>
            ‚Ä¢ "How much have I spent this week?"<br>
            ‚Ä¢ "Show me my biggest expenses"<br><br>
            
            <strong>AI Analysis:</strong><br>
            ‚Ä¢ "Give me my daily summary"<br>
            ‚Ä¢ "Why am I so tired lately?"<br>
            ‚Ä¢ "What should I optimize?"
        </div>
    </div>

    <!-- ============================================ -->
    <!-- COMPONENT STYLES -->
    <!-- ============================================ -->
    <style>
        /* Butler Quick Button Styles */
        .butler-quick-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(0,255,255,0.1);
            border: 1px solid rgba(0,255,255,0.3);
            border-radius: 8px;
            color: #00ffff;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            position: relative;
        }
        
        .butler-quick-btn:hover {
            background: rgba(0,255,255,0.2);
            border-color: #00ffff;
            transform: translateX(5px);
            box-shadow: 0 0 20px rgba(0,255,255,0.4);
        }
        
        .butler-quick-btn::after {
            content: attr(data-example);
            position: absolute;
            left: 110%;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.95);
            border: 1px solid rgba(0,255,255,0.5);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            color: rgba(0,255,255,0.8);
        }
        
        .butler-quick-btn:hover::after {
            opacity: 1;
        }
        
        /* Quick Action Button Styles */
        .quick-action-btn {
            padding: 12px 24px;
            background: rgba(0,10,20,0.9);
            border: 1px solid rgba(0,255,255,0.3);
            color: #00ffff;
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            letter-spacing: 1px;
            transition: all 0.3s;
            border-radius: 6px;
            font-weight: bold;
        }
        
        .quick-action-btn:hover {
            background: rgba(0,255,255,0.2);
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0,255,255,0.4);
            transform: translateY(-2px);
        }
        
        /* Circular Action Button Hover */
        .action-button-circular:hover {
            background: rgba(0,255,255,0.2);
            border-color: #00ffff;
            transform: scale(1.15);
            box-shadow: 0 0 30px rgba(0,255,255,0.6);
        }
        
        /* Close Button Hover */
        #close-detail:hover {
            background: rgba(255,0,0,0.2);
            border-color: #ff4444;
            color: #ff4444;
            transform: rotate(90deg);
        }
        
        /* Logout Button Hover */
        #logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(255,68,68,0.5);
            background: rgba(255,68,68,0.2);
        }
        
        /* Voice Button Hover */
        .voice-btn:hover {
            background: rgba(0,255,255,0.2);
            border-color: #00ffff;
            box-shadow: 0 0 25px rgba(0,255,255,0.5);
            transform: scale(1.05);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }
        
        @keyframes coreRotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        @keyframes corePulse {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 0 50px rgba(0,255,255,0.8);
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.08);
                box-shadow: 0 0 70px rgba(0,255,255,1);
            }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes phoenixPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }
    </style>

    <!-- ============================================ -->
    <!-- THREE.JS LIBRARY -->
    <!-- Blueprint Requirement: 3D visualization engine -->
    <!-- ============================================ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- ============================================ -->
    <!-- FIRST-TIME USER DETECTION -->
    <!-- Blueprint Requirement: Redirect to onboarding if not completed -->
    <!-- ============================================ -->
    <script>
    (function checkOnboarding() {
        const onboardingComplete = localStorage.getItem('phoenixOnboardingComplete');
        
        if (!onboardingComplete || onboardingComplete !== 'true') {
            console.log('üé¨ First-time user detected, redirecting to onboarding...');
            window.location.href = '/onboarding.html';
            return;
        }
        
        console.log('‚úÖ Returning user, loading main app...');
    })();
    </script>
    
    <!-- ============================================ -->
    <!-- PHOENIX CORE ENGINE -->
    <!-- Blueprint Requirement: Main application logic -->
    <!-- ============================================ -->
    <script>
        // API Configuration
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:5000/api' 
            : 'https://pal-backend-production.up.railway.app/api';
        
        const getAuthHeaders = () => {
            const token = localStorage.getItem('phoenixToken');
            return {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            };
        };

        /**
         * PHOENIX ENGINE CLASS
         * Blueprint Requirements:
         * - 3D solar system visualization
         * - Real-time metrics updates
         * - Voice interface integration
         * - Butler action handling
         * - Weather & location tracking
         * - Device status monitoring
         */
        class PhoenixEngine {
            constructor() {
                // 3D Scene
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.phoenixCore = null;
                this.planets = [];
                this.particles = [];
                
                // State
                this.time = 0;
                this.isListening = false;
                this.recoveryScore = 75;
                this.mouseX = 0;
                this.mouseY = 0;
                
                // User Data
                this.userId = null;
                this.userData = {};
                this.isActivated = false;
                this.actionMenuOpen = false;
                this.currentPlanet = null;
                
                // Weather & Location
                this.location = { city: 'Unknown', state: '', country: '' };
                this.weather = { temp: '--', condition: 'Loading...', icon: '‚òÄÔ∏è' };
            }

            /**
             * INITIALIZE ALL SYSTEMS
             * Blueprint Flow: Auth ‚Üí API ‚Üí Components ‚Üí Health Monitor ‚Üí App Ready
             */
            async init() {
                console.log('üöÄ Phoenix Engine Initializing...');
                
                // Step 1: Authentication
                await this.authenticate();
                
                // Step 2: Setup 3D Scene
                this.setupScene();
                this.createPhoenixCore();
                this.createPlanets();
                this.createParticleField();
                this.setupLighting();
                
                // Step 3: Setup Event Listeners
                this.setupEventListeners();
                this.setupUIHandlers();
                
                // Step 4: Start Animation Loop
                this.animate();
                
                // Step 5: Initialize HUD
                this.startHUD();
                
                // Step 6: Weather & Location
                this.initWeatherAndLocation();
                
                // Step 7: Check Activation Status
                const hasActivated = localStorage.getItem('phoenixActivated');
                if (hasActivated) {
                    document.getElementById('onboarding').style.display = 'none';
                    this.isActivated = true;
                    await this.loadUserData();
                    this.startDataSync();
                    
                    // Hide loading screen
                    setTimeout(() => {
                        document.getElementById('loading').style.opacity = '0';
                        setTimeout(() => document.getElementById('loading').style.display = 'none', 1000);
                    }, 3000);
                } else {
                    // First time - show activation
                    setTimeout(() => {
                        document.getElementById('loading').style.opacity = '0';
                        setTimeout(() => document.getElementById('loading').style.display = 'none', 1000);
                    }, 2000);
                }
                
                console.log('‚úÖ Phoenix Engine Initialized');
            }

            /**
             * WEATHER & LOCATION INTEGRATION
             * Blueprint Requirement: IP geolocation + weather display
             */
            async initWeatherAndLocation() {
                try {
                    // Get location from IP
                    const locationResponse = await fetch('https://ipapi.co/json/');
                    const locationData = await locationResponse.json();
                    
                    this.location = {
                        city: locationData.city || 'Unknown',
                        state: locationData.region_code || '',
                        country: locationData.country_name || ''
                    };
                    
                    // Update location display
                    const locationDisplay = document.getElementById('location-display');
                    if (locationDisplay) {
                        locationDisplay.textContent = `${this.location.city}, ${this.location.state}`;
                    }
                    
                    // Get weather (using Open-Meteo - free, no API key needed)
                    const lat = locationData.latitude;
                    const lon = locationData.longitude;
                    
                    const weatherResponse = await fetch(
                        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=fahrenheit`
                    );
                    const weatherData = await weatherResponse.json();
                    
                    if (weatherData.current_weather) {
                        const temp = Math.round(weatherData.current_weather.temperature);
                        const weatherCode = weatherData.current_weather.weathercode;
                        
                        // Map weather codes to icons
                        const weatherIcons = {
                            0: '‚òÄÔ∏è',  // Clear
                            1: 'üå§Ô∏è',  // Mainly clear
                            2: '‚õÖ',  // Partly cloudy
                            3: '‚òÅÔ∏è',  // Overcast
                            45: 'üå´Ô∏è', // Fog
                            48: 'üå´Ô∏è', // Depositing rime fog
                            51: 'üåßÔ∏è', // Drizzle light
                            53: 'üåßÔ∏è', // Drizzle moderate
                            55: 'üåßÔ∏è', // Drizzle dense
                            61: 'üåßÔ∏è', // Rain slight
                            63: 'üåßÔ∏è', // Rain moderate
                            65: 'üåßÔ∏è', // Rain heavy
                            71: '‚ùÑÔ∏è',  // Snow slight
                            73: '‚ùÑÔ∏è',  // Snow moderate
                            75: '‚ùÑÔ∏è',  // Snow heavy
                            95: '‚õàÔ∏è',  // Thunderstorm
                        };
                        
                        const weatherConditions = {
                            0: 'Clear',
                            1: 'Mostly Clear',
                            2: 'Partly Cloudy',
                            3: 'Cloudy',
                            45: 'Foggy',
                            48: 'Foggy',
                            51: 'Light Rain',
                            53: 'Rain',
                            55: 'Heavy Rain',
                            61: 'Light Rain',
                            63: 'Rain',
                            65: 'Heavy Rain',
                            71: 'Light Snow',
                            73: 'Snow',
                            75: 'Heavy Snow',
                            95: 'Thunderstorm',
                        };
                        
                        this.weather = {
                            temp: temp,
                            condition: weatherConditions[weatherCode] || 'Unknown',
                            icon: weatherIcons[weatherCode] || '‚òÄÔ∏è'
                        };
                        
                        // Update weather display
                        document.getElementById('weather-icon').textContent = this.weather.icon;
                        document.getElementById('weather-temp').textContent = `${this.weather.temp}¬∞F`;
                        document.getElementById('weather-condition').textContent = this.weather.condition;
                    }
                    
                    console.log('‚úÖ Weather & Location initialized:', this.location, this.weather);
                    
                    // Update weather every 30 minutes
                    setInterval(() => this.initWeatherAndLocation(), 30 * 60 * 1000);
                    
                } catch (error) {
                    console.error('Weather/Location error:', error);
                    document.getElementById('location-display').textContent = 'Location Unavailable';
                    document.getElementById('weather-condition').textContent = 'Weather Unavailable';
                }
            }

            /**
             * UI EVENT HANDLERS
             * Blueprint Requirement: All button interactions
             */
            setupUIHandlers() {
                // Logout
                document.getElementById('logout-btn').addEventListener('click', () => {
                    if (confirm('Logout from Phoenix?')) {
                        localStorage.removeItem('phoenixToken');
                        localStorage.removeItem('phoenixUser');
                        window.location.href = '/login';
                    }
                });
                
                // Activation
                document.getElementById('activate-btn').addEventListener('click', () => this.activatePhoenix());
                
                // Action Menu Buttons
                ['workout', 'meal', 'goals', 'chat', 'butler', 'insights'].forEach(action => {
                    const btn = document.getElementById('action-' + action);
                    if (btn) {
                        btn.addEventListener('click', () => {
                            this.closeActionMenu();
                            
                            if (action === 'workout') this.openPlanetDetail('mercury');
                            else if (action === 'meal') this.openPlanetDetail('venus');
                            else if (action === 'goals') this.openPlanetDetail('mars');
                            else if (action === 'chat') this.activateVoice();
                            else if (action === 'butler') toggleButlerPanel();
                            else if (action === 'insights') this.showInsights();
                        });
                    }
                });
                
                // Quick Action Buttons
                ['workout', 'meal', 'butler', 'chat'].forEach(action => {
                    const btn = document.getElementById('quick-' + action);
                    if (btn) {
                        btn.addEventListener('click', () => {
                            if (action === 'workout') this.openPlanetDetail('mercury');
                            else if (action === 'meal') this.openPlanetDetail('venus');
                            else if (action === 'butler') toggleButlerPanel();
                            else if (action === 'chat') this.activateVoice();
                        });
                    }
                });
                
                // Close Planet Detail
                document.getElementById('close-detail').addEventListener('click', () => this.closePlanetDetail());
            }

            /**
             * ACTIVATE PHOENIX
             * Blueprint Requirement: First-time activation flow
             */
            activatePhoenix() {
                document.getElementById('onboarding').style.display = 'none';
                localStorage.setItem('phoenixActivated', 'true');
                this.isActivated = true;
                
                // Visual feedback
                if (this.phoenixCore) {
                    this.phoenixCore.material.emissiveIntensity = 2;
                    setTimeout(() => this.phoenixCore.material.emissiveIntensity = 0.5, 500);
                }
                
                this.showNotification('Phoenix Activated', 'AI companion online. Loading your data...');
                this.loadUserData();
                this.startDataSync();
            }

            /**
             * ACTION MENU TOGGLE
             * Blueprint Requirement: Circular menu from Phoenix core click
             */
            toggleActionMenu() {
                this.actionMenuOpen = !this.actionMenuOpen;
                document.getElementById('action-menu').style.display = this.actionMenuOpen ? 'block' : 'none';
            }

            closeActionMenu() {
                this.actionMenuOpen = false;
                document.getElementById('action-menu').style.display = 'none';
            }

            /**
             * PLANET DETAIL MODAL
             * Blueprint Requirement: Full-screen dashboard for each planet
             */
            openPlanetDetail(planetName) {
                this.currentPlanet = planetName;
                document.getElementById('planet-detail').style.display = 'block';
                
                const planetData = {
                    mercury: { title: 'FITNESS & RECOVERY', subtitle: 'Workouts, Performance, Biometrics' },
                    venus: { title: 'NUTRITION', subtitle: 'Meals, Macros, Supplements' },
                    earth: { title: 'SCHEDULE & TIME', subtitle: 'Calendar, Energy, Optimization' },
                    mars: { title: 'GOALS & HABITS', subtitle: 'Objectives, Progress, Achievements' },
                    jupiter: { title: 'WEALTH & FINANCE', subtitle: 'Spending, Budgets, Correlations' },
                    saturn: { title: 'LEGACY & LONGEVITY', subtitle: 'Long-term Health, Life Timeline' }
                };
                
                const planet = planetData[planetName] || planetData.mercury;
                document.getElementById('detail-title').textContent = planet.title;
                document.getElementById('detail-subtitle').textContent = planet.subtitle;
                
                this.loadPlanetContent(planetName);
            }

            closePlanetDetail() {
                document.getElementById('planet-detail').style.display = 'none';
                this.currentPlanet = null;
            }

            loadPlanetContent(planetName) {
                // Check if planets.js has loaded
                if (window.planetSystem) {
                    window.planetSystem.loadDashboardContent(planetName);
                    return;
                }
                
                // Fallback loading state
                const content = document.getElementById('detail-content');
                content.innerHTML = '<div style="text-align:center;padding:60px"><div style="font-size:48px;margin-bottom:20px">‚è≥</div><div style="font-size:24px;color:#00ffff">Loading dashboard...</div></div>';
                
                // Retry when planets.js loads
                setTimeout(() => {
                    if (window.planetSystem) {
                        window.planetSystem.loadDashboardContent(planetName);
                    }
                }, 500);
            }

            /**
             * AUTHENTICATION
             * Blueprint Requirement: Token-based auth with /api/auth/me
             */
            async authenticate() {
                const token = localStorage.getItem('phoenixToken');
                if (!token) {
                    console.log('‚ùå No token found');
                    window.location.href = '/login';
                    return false;
                }
                
                try {
                    const response = await fetch(API_BASE + '/auth/me', {
                        headers: getAuthHeaders()
                    });
                    
                    const data = await response.json();
                    
                    if (data.success && data.user) {
                        this.userId = data.user._id;
                        console.log('‚úÖ Authenticated:', data.user.name);
                        
                        // Personalized greeting
                        const hour = new Date().getHours();
                        const greeting = hour < 12 ? 'Good Morning' : hour < 18 ? 'Good Afternoon' : 'Good Evening';
                        document.querySelector('.greeting-main').textContent = greeting + ', ' + data.user.name.split(' ')[0];
                        
                        return true;
                    } else {
                        localStorage.removeItem('phoenixToken');
                        localStorage.removeItem('phoenixUser');
                        window.location.href = '/login.html';
                        return false;
                    }
                } catch (error) {
                    console.error('‚ùå Auth error:', error);
                    localStorage.removeItem('phoenixToken');
                    localStorage.removeItem('phoenixUser');
                    window.location.href = '/login.html';
                    return false;
                }
            }

            /**
             * DATA LOADING
             * Blueprint Requirement: Load user data from all planetary systems
             */
            async loadUserData() {
                if (!this.userId) return;
                console.log('üìä Loading user data...');
                
                // This will be enhanced by planets.js, wearables.js, etc.
                // For now, just update recovery score
                try {
                    const response = await fetch(API_BASE + '/mercury/recovery/dashboard', {
                        headers: getAuthHeaders()
                    });
                    const data = await response.json();
                    
                    if (data.success && data.data) {
                        this.recoveryScore = data.data.recoveryScore || 75;
                        this.updateRecovery();
                    }
                } catch (error) {
                    console.error('Error loading recovery:', error);
                }
            }

            startDataSync() {
                // Sync data every 30 seconds
                setInterval(() => this.loadUserData(), 30000);
            }

            async showInsights() {
                this.showNotification('Analyzing Data', 'Phoenix is analyzing your patterns...');
                // This will be enhanced by jarvis.js
            }

            /**
             * 3D SCENE SETUP
             * Blueprint Requirement: Three.js solar system visualization
             */
            setupScene() {
                this.scene = new THREE.Scene();
                this.scene.fog = new THREE.FogExp2(0x000000, 0.0008);
                
                this.camera = new THREE.PerspectiveCamera(
                    75,
                    window.innerWidth / window.innerHeight,
                    0.1,
                    1000
                );
                this.camera.position.z = 15;
                
                this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                
                document.getElementById('container').appendChild(this.renderer.domElement);
                
                // Responsive resize
                window.addEventListener('resize', () => {
                    this.camera.aspect = window.innerWidth / window.innerHeight;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(window.innerWidth, window.innerHeight);
                });
            }

            /**
             * PHOENIX CORE SPHERE
             * Blueprint Requirement: Glowing interactive center sphere
             */
            createPhoenixCore() {
                const geometry = new THREE.SphereGeometry(1.5, 64, 64);
                const material = new THREE.MeshPhongMaterial({
                    color: 0x00ffff,
                    emissive: 0x00ffff,
                    emissiveIntensity: 0.5,
                    shininess: 100,
                    transparent: true,
                    opacity: 0.8
                });
                
                this.phoenixCore = new THREE.Mesh(geometry, material);
                this.scene.add(this.phoenixCore);
                
                // Orbital rings
                for (let i = 0; i < 3; i++) {
                    const ringGeometry = new THREE.TorusGeometry(2 + i * 0.5, 0.02, 16, 100);
                    const ringMaterial = new THREE.MeshBasicMaterial({
                        color: 0x00ffff,
                        transparent: true,
                        opacity: 0.3
                    });
                    const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                    ring.rotation.x = Math.PI / 2;
                    ring.userData.rotationSpeed = 0.001 * (i + 1);
                    this.phoenixCore.add(ring);
                }
                
                // Glow effect
                const glowGeometry = new THREE.SphereGeometry(1.8, 32, 32);
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: 0x00ffff,
                    transparent: true,
                    opacity: 0.1
                });
                const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                this.phoenixCore.add(glow);
            }

            /**
             * PLANETARY SYSTEM
             * Blueprint Requirement: 6 planets representing life systems
             */
            createPlanets() {
                const planetData = [
                    { name: 'MERCURY', color: 0xff6b35, angle: 0, distance: 8 },
                    { name: 'VENUS', color: 0xff66ff, angle: Math.PI / 3, distance: 8 },
                    { name: 'EARTH', color: 0x00ff88, angle: 2 * Math.PI / 3, distance: 8 },
                    { name: 'MARS', color: 0xff4444, angle: Math.PI, distance: 8 },
                    { name: 'JUPITER', color: 0xffaa00, angle: 4 * Math.PI / 3, distance: 8 },
                    { name: 'SATURN', color: 0x8844ff, angle: 5 * Math.PI / 3, distance: 8 }
                ];
                
                planetData.forEach((data, index) => {
                    const geometry = new THREE.SphereGeometry(0.6, 32, 32);
                    const material = new THREE.MeshPhongMaterial({
                        color: data.color,
                        emissive: data.color,
                        emissiveIntensity: 0.3,
                        shininess: 80
                    });
                    
                    const planet = new THREE.Mesh(geometry, material);
                    planet.userData = {
                        angle: data.angle,
                        distance: data.distance,
                        speed: 0.0005 + index * 0.0002,
                        name: data.name
                    };
                    
                    this.scene.add(planet);
                    this.planets.push(planet);
                    
                    // Planet glow
                    const glowGeometry = new THREE.SphereGeometry(0.8, 16, 16);
                    const glowMaterial = new THREE.MeshBasicMaterial({
                        color: data.color,
                        transparent: true,
                        opacity: 0.2
                    });
                    const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                    planet.add(glow);
                });
            }

            /**
             * PARTICLE FIELD
             * Blueprint Requirement: Animated background particles
             */
            createParticleField() {
                const particleCount = 3000;
                const geometry = new THREE.BufferGeometry();
                const positions = new Float32Array(particleCount * 3);
                const velocities = [];
                
                for (let i = 0; i < particleCount; i++) {
                    positions[i * 3] = (Math.random() - 0.5) * 50;
                    positions[i * 3 + 1] = (Math.random() - 0.5) * 50;
                    positions[i * 3 + 2] = (Math.random() - 0.5) * 50;
                    
                    velocities.push({
                        x: (Math.random() - 0.5) * 0.02,
                        y: (Math.random() - 0.5) * 0.02,
                        z: (Math.random() - 0.5) * 0.02
                    });
                }
                
                geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                
                const material = new THREE.PointsMaterial({
                    color: 0x00ffff,
                    size: 0.05,
                    transparent: true,
                    opacity: 0.6,
                    blending: THREE.AdditiveBlending
                });
                
                const particles = new THREE.Points(geometry, material);
                particles.userData.velocities = velocities;
                
                this.scene.add(particles);
                this.particles.push(particles);
            }

            /**
             * LIGHTING SETUP
             * Blueprint Requirement: Dynamic lighting for 3D scene
             */
            setupLighting() {
                const ambient = new THREE.AmbientLight(0x404040);
                this.scene.add(ambient);
                
                const pointLight = new THREE.PointLight(0x00ffff, 2, 50);
                this.phoenixCore.add(pointLight);
                
                const light1 = new THREE.PointLight(0xff6b35, 0.5, 20);
                light1.position.set(5, 5, 5);
                this.scene.add(light1);
                
                const light2 = new THREE.PointLight(0xff66ff, 0.5, 20);
                light2.position.set(-5, -5, 5);
                this.scene.add(light2);
            }

            /**
             * EVENT LISTENERS
             * Blueprint Requirement: Click detection for planets and core
             */
            setupEventListeners() {
                this.raycaster = new THREE.Raycaster();
                this.mouseVector = new THREE.Vector2();
                
                const clickHandler = (e) => {
                    e.preventDefault();
                    
                    const x = e.touches ? e.touches[0].clientX : e.clientX;
                    const y = e.touches ? e.touches[0].clientY : e.clientY;
                    
                    this.mouseVector.x = (x / window.innerWidth) * 2 - 1;
                    this.mouseVector.y = -(y / window.innerHeight) * 2 + 1;
                    
                    this.raycaster.setFromCamera(this.mouseVector, this.camera);
                    
                    // Check Phoenix Core click
                    const coreIntersects = this.raycaster.intersectObject(this.phoenixCore);
                    if (coreIntersects.length > 0 && !this.actionMenuOpen) {
                        this.toggleActionMenu();
                        return;
                    }
                    
                    // Check Planet clicks
                    const planetIntersects = this.raycaster.intersectObjects(this.planets);
                    if (planetIntersects.length > 0) {
                        const planet = planetIntersects[0].object;
                        const planetName = planet.userData.name.toLowerCase();
                        this.openPlanetDetail(planetName);
                    }
                    
                    // Close action menu if clicking outside
                    if (this.actionMenuOpen && coreIntersects.length === 0) {
                        this.closeActionMenu();
                    }
                };
                
                document.addEventListener('click', clickHandler);
                document.addEventListener('touchstart', clickHandler);
                
                // Mouse movement for parallax
                document.addEventListener('mousemove', (e) => {
                    this.mouseX = (e.clientX / window.innerWidth) * 2 - 1;
                    this.mouseY = -(e.clientY / window.innerHeight) * 2 + 1;
                });
            }

            /**
             * VOICE ACTIVATION
             * Blueprint Requirement: Voice interface trigger
             */
            activateVoice() {
                if (window.voiceInterface) {
                    window.voiceInterface.startListening();
                } else if (window.startVoice) {
                    window.startVoice();
                } else {
                    const overlay = document.getElementById('voice-overlay');
                    overlay.style.display = 'flex';
                    this.isListening = true;
                    
                    setTimeout(() => {
                        overlay.style.display = 'none';
                        this.isListening = false;
                    }, 3000);
                }
            }

            /**
             * ANIMATION LOOP
             * Blueprint Requirement: 60fps smooth animation
             */
            animate() {
                requestAnimationFrame(() => this.animate());
                this.time += 0.01;
                
                // Animate Phoenix Core
                if (this.phoenixCore) {
                    this.phoenixCore.rotation.y += 0.002;
                    const scale = 1 + Math.sin(this.time * 2) * 0.05;
                    this.phoenixCore.scale.set(scale, scale, scale);
                    
                    // Rotate orbital rings
                    this.phoenixCore.children.forEach(child => {
                        if (child.userData.rotationSpeed) {
                            child.rotation.z += child.userData.rotationSpeed;
                        }
                    });
                }
                
                // Animate Planets
                this.planets.forEach(planet => {
                    planet.userData.angle += planet.userData.speed;
                    planet.position.x = Math.cos(planet.userData.angle) * planet.userData.distance;
                    planet.position.z = Math.sin(planet.userData.angle) * planet.userData.distance;
                    planet.rotation.y += 0.01;
                });
                
                // Animate Particles
                this.particles.forEach(particleSystem => {
                    const positions = particleSystem.geometry.attributes.position.array;
                    const velocities = particleSystem.userData.velocities;
                    
                    for (let i = 0; i < positions.length; i += 3) {
                        positions[i] += velocities[i / 3].x;
                        positions[i + 1] += velocities[i / 3].y;
                        positions[i + 2] += velocities[i / 3].z;
                        
                        // Bounce off boundaries
                        if (Math.abs(positions[i]) > 25) velocities[i / 3].x *= -1;
                        if (Math.abs(positions[i + 1]) > 25) velocities[i / 3].y *= -1;
                        if (Math.abs(positions[i + 2]) > 25) velocities[i / 3].z *= -1;
                    }
                    
                    particleSystem.geometry.attributes.position.needsUpdate = true;
                });
                
                // Camera parallax effect
                const targetX = this.mouseX * 2;
                const targetY = this.mouseY * 2;
                this.camera.position.x += (targetX - this.camera.position.x) * 0.05;
                this.camera.position.y += (targetY - this.camera.position.y) * 0.05;
                this.camera.lookAt(this.scene.position);
                
                // Render scene
                this.renderer.render(this.scene, this.camera);
            }

            /**
             * HUD UPDATES
             * Blueprint Requirement: Real-time time, date, recovery display
             */
            startHUD() {
                this.updateTime();
                setInterval(() => this.updateTime(), 1000);
                
                this.updateRecovery();
                setInterval(() => this.updateRecovery(), 30000);
            }

            updateTime() {
                const now = new Date();
                const time = now.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
                const date = now.toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric'
                });
                
                document.getElementById('time-display').textContent = time;
                document.getElementById('date-display').textContent = date;
            }

            updateRecovery() {
                const recoveryEl = document.getElementById('recovery-value');
                const fillEl = document.getElementById('recovery-fill');
                const statusEl = document.getElementById('recovery-status');
                
                if (recoveryEl) recoveryEl.textContent = Math.round(this.recoveryScore) + '%';
                if (fillEl) fillEl.style.width = this.recoveryScore + '%';
                
                if (statusEl) {
                    if (this.recoveryScore >= 75) statusEl.textContent = 'Optimal';
                    else if (this.recoveryScore >= 50) statusEl.textContent = 'Good';
                    else if (this.recoveryScore >= 25) statusEl.textContent = 'Low';
                    else statusEl.textContent = 'Rest Needed';
                }
            }

            /**
             * NOTIFICATIONS
             * Blueprint Requirement: Toast notifications for system events
             */
            showNotification(title, message) {
                const notification = document.createElement('div');
                notification.style.cssText = 'position:fixed;top:100px;right:30px;background:rgba(0,10,20,0.95);border:2px solid rgba(0,255,255,0.5);padding:20px;max-width:300px;z-index:10000;animation:slideIn 0.3s;box-shadow:0 0 30px rgba(0,255,255,0.3);border-radius:8px';
                notification.innerHTML = '<div style="font-size:14px;font-weight:bold;color:#00ffff;margin-bottom:10px">' + title + '</div><div style="font-size:12px;color:rgba(0,255,255,0.7)">' + message + '</div>';
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s';
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            }
        }

        // Initialize Phoenix Engine
        const phoenix = new PhoenixEngine();
        window.phoenix = phoenix;

        /**
         * BUTLER FUNCTIONS
         * Blueprint Requirement: Quick butler actions
         */
        window.toggleButlerPanel = function() {
            const panel = document.getElementById('butler-panel');
            if (panel) {
                const isVisible = panel.style.display !== 'none';
                panel.style.display = isVisible ? 'none' : 'block';
            }
        };

        window.butlerAction = async function(action) {
            console.log('ü§µ Butler action:', action);
            
            // Update butler status
            const butlerStatus = document.getElementById('butler-status');
            if (butlerStatus) butlerStatus.innerHTML = 'ü§µ <span>Butler Working...</span>';
            
            // Trigger orchestrator if available
            if (window.phoenixOrchestrator && window.phoenixOrchestrator.state.butlerActive) {
                const intent = {
                    category: 'butler',
                    action: action + '_order',
                    entities: {}
                };
                await window.phoenixOrchestrator.processCommand(action);
            } else if (window.phoenixVoice) {
                // Fallback to voice command
                const messages = {
                    food: "Order my usual food",
                    ride: "Book a ride to my usual location",
                    reservation: "Make a dinner reservation for tonight",
                    calendar: "Schedule a meeting for tomorrow",
                    email: "Send a follow-up email",
                    call: "Make a phone call",
                    sms: "Send a text message"
                };
                
                await window.phoenixVoice.processCommand(messages[action]);
            } else {
                phoenix.showNotification('Butler', `Processing: ${action}`);
            }
            
            // Reset status
            setTimeout(() => {
                if (butlerStatus) butlerStatus.innerHTML = 'ü§µ <span>Butler Ready</span>';
            }, 2000);
            
            // Close panel
            toggleButlerPanel();
        };

        /**
         * VOICE CONTROLS
         * Blueprint Requirement: Voice button and personality selector
         */
        window.toggleVoice = function() {
            if (window.phoenixVoice && window.phoenixVoice.toggleListening) {
                window.phoenixVoice.toggleListening();
            } else if (window.phoenix) {
                window.phoenix.activateVoice();
            }
        };

        window.changeVoice = function(voiceId) {
            if (window.phoenixVoice && window.phoenixVoice.setVoice) {
                window.phoenixVoice.setVoice(voiceId);
                console.log('üéôÔ∏è Voice changed to:', voiceId);
                
                // Update personality display
                const personalityEl = document.getElementById('ai-personality');
                if (personalityEl) {
                    const voices = {
                        echo: 'Echo (British Butler)',
                        nova: 'Nova (Friendly)',
                        onyx: 'Onyx (Professional)',
                        fable: 'Fable (Storyteller)',
                        shimmer: 'Shimmer (Gentle)',
                        alloy: 'Alloy (Efficient)'
                    };
                    personalityEl.textContent = voices[voiceId] || voiceId;
                }
            }
        };

        /**
         * APP INITIALIZATION
         * Blueprint Requirement: Sequential system startup
         */
        window.addEventListener('DOMContentLoaded', () => {
            phoenix.init();
            
            // Initialize Phoenix Particles Animation
            (function initPhoenixParticles() {
                const canvas = document.getElementById('phoenix-particles');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const particles = [];
                const centerX = 100;
                const centerY = 100;
                
                for (let i = 0; i < 50; i++) {
                    particles.push({
                        angle: Math.random() * Math.PI * 2,
                        distance: Math.random() * 40 + 20,
                        size: Math.random() * 2 + 1,
                        speed: Math.random() * 0.02 + 0.01,
                        alpha: Math.random() * 0.5 + 0.3
                    });
                }
                
                function animate() {
                    ctx.clearRect(0, 0, 200, 200);
                    
                    particles.forEach(p => {
                        p.angle += p.speed;
                        const x = centerX + Math.cos(p.angle) * p.distance;
                        const y = centerY + Math.sin(p.angle) * p.distance;
                        
                        ctx.beginPath();
                        ctx.arc(x, y, p.size, 0, Math.PI * 2);
                        ctx.fillStyle = 'rgba(0,255,255,' + p.alpha + ')';
                        ctx.fill();
                        
                        const gradient = ctx.createRadialGradient(x, y, 0, x, y, p.size * 3);
                        gradient.addColorStop(0, 'rgba(0,255,255,' + (p.alpha * 0.5) + ')');
                        gradient.addColorStop(1, 'rgba(0,255,255,0)');
                        ctx.fillStyle = gradient;
                        ctx.fillRect(x - p.size * 3, y - p.size * 3, p.size * 6, p.size * 6);
                    });
                    
                    requestAnimationFrame(animate);
                }
                
                animate();
            })();
            
            // Phoenix Core Click Handler
            const phoenixCoreContainer = document.getElementById('phoenix-core-container');
            if (phoenixCoreContainer) {
                phoenixCoreContainer.addEventListener('click', function() {
                    console.log('üî• Phoenix Core Activated');
                    
                    const sphere = document.getElementById('phoenix-sphere');
                    if (sphere) {
                        sphere.style.animation = 'none';
                        setTimeout(() => {
                            sphere.style.animation = 'phoenixPulse 0.5s ease-in-out 3';
                            setTimeout(() => {
                                sphere.style.animation = 'phoenixPulse 2s ease-in-out infinite';
                            }, 1500);
                        }, 10);
                    }
                    
                    phoenix.toggleActionMenu();
                });
            }
            
            console.log('üöÄ PHOENIX INITIALIZED WITH ALL SYSTEMS');
            console.log('üìä Blueprint Requirements: Weather ‚úì | Location ‚úì | Commands ‚úì');
        });
    </script>

    <!-- ============================================ -->
    <!-- MODULE LOADING -->
    <!-- Blueprint Requirement: Load all system modules -->
    <!-- ============================================ -->
    <script src="src/orchestrator.js"></script>
    <script src="src/voice-config.js"></script>  
    <script src="src/api-fix.js"></script>
    <script type="module" src="./src/api.js"></script>
    <script type="module" src="./src/voice.js"></script>
    <script type="module" src="./src/planets.js"></script>
    <script type="module" src="./src/jarvis.js"></script>
    <script type="module" src="./src/reactor.js"></script>
    <script type="module" src="./src/shaders.js"></script>
    <script type="module" src="./src/wearables.js"></script>
    <script src="phoenix-api-client.js"></script>
    <script src="phoenix-conversational-ai.js"></script>

    <script>
        /**
         * SYSTEM READY
         * Blueprint Requirement: Confirm all systems loaded
         */
        console.log('üî• PHOENIX SYSTEMS LOADING...');
        console.log('üìã Orchestrator: Managing butler + voice integration');
        console.log('üåç Weather & Location: Active with IP geolocation');
        console.log('üí¨ Voice Commands: Ready for natural language');
        console.log('ü§µ Butler: 6 quick actions + autonomous capabilities');
        console.log('üåê All 282 endpoints mapped and ready');
        console.log('‚ú® Welcome to the future of AI companions');
    </script>
</body>
</html>
