<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phoenix - Begin Your Journey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #0a0a1f 50%, #000000 100%);
            color: #ffffff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Animated Background */
        .bg-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.15;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 0, 255, 0.1) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            33% { transform: translate(30px, -30px); }
            66% { transform: translate(-20px, 20px); }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Progress Bar */
        .progress-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 255, 255, 0.1);
        }

        .progress-bar {
            height: 4px;
            background: linear-gradient(90deg, #00ffff, #8a2be2, #ff00ff);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            padding: 20px 40px;
            max-width: 900px;
            margin: 0 auto;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0.4;
            transition: opacity 0.3s;
        }

        .progress-step.active {
            opacity: 1;
        }

        .progress-step.completed {
            opacity: 0.7;
            color: #00ffff;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid rgba(0, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
        }

        .progress-step.active .step-number {
            background: linear-gradient(135deg, #00ffff, #8a2be2);
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .progress-step.completed .step-number {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
        }

        .step-label {
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 0.5px;
            display: none;
        }

        @media (min-width: 768px) {
            .step-label {
                display: block;
            }
        }

        /* Phase Container */
        .phase {
            display: none;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards;
            padding-top: 100px;
        }

        .phase.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .phase-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .phase-title {
            font-size: 56px;
            font-weight: 700;
            background: linear-gradient(135deg, #00ffff, #8a2be2, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            letter-spacing: -1px;
        }

        .phase-subtitle {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
        }

        /* Language Grid */
        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .language-card {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
        }

        .language-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(0, 255, 255, 0.5);
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 255, 255, 0.2);
        }

        .language-card.selected {
            background: rgba(0, 255, 255, 0.1);
            border-color: #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }

        .language-flag {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .language-name {
            font-size: 16px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Voice Cards */
        .voice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .voice-card {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
        }

        .voice-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(138, 43, 226, 0.5);
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(138, 43, 226, 0.2);
        }

        .voice-card.selected {
            background: rgba(138, 43, 226, 0.1);
            border-color: #8a2be2;
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.3);
        }

        .voice-icon {
            font-size: 40px;
            margin-bottom: 12px;
        }

        .voice-name {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .voice-description {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 16px;
        }

        .voice-preview-btn {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #ffffff;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .voice-preview-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .voice-preview-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin: 40px 0;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #ffffff;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.08);
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .form-group select option {
            background: #0a0a1f;
            color: #ffffff;
        }

        /* Device Cards */
        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .device-card {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 28px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
        }

        .device-card:hover:not(.disabled) {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 0, 255, 0.5);
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(255, 0, 255, 0.2);
        }

        .device-card.connected {
            background: rgba(0, 255, 0, 0.05);
            border-color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }

        .device-card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .device-logo {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .device-name {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .device-status {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.5);
        }

        .device-card.connected .device-status {
            color: #00ff00;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 60px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 18px 48px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ffff, #8a2be2);
            color: #000000;
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 255, 255, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn-skip {
            background: transparent;
            color: rgba(255, 255, 255, 0.5);
            padding: 12px 24px;
            font-size: 14px;
        }

        .btn-skip:hover {
            color: rgba(255, 255, 255, 0.7);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 16px 24px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 14px;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease;
        }

        .toast.show {
            display: block;
        }

        .toast.success {
            border-color: #00ff00;
            box-shadow: 0 10px 40px rgba(0, 255, 0, 0.3);
        }

        .toast.error {
            border-color: #ff0000;
            box-shadow: 0 10px 40px rgba(255, 0, 0, 0.3);
        }

        .toast.info {
            border-color: #00ffff;
            box-shadow: 0 10px 40px rgba(0, 255, 255, 0.3);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 255, 255, 0.1);
            border-top-color: #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Subscription Cards */
        .subscription-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin: 40px 0;
        }

        .subscription-card {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 32px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .subscription-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #00ffff, #8a2be2, #ff00ff);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .subscription-card:hover::before,
        .subscription-card.selected::before {
            opacity: 1;
        }

        .subscription-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(138, 43, 226, 0.5);
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(138, 43, 226, 0.2);
        }

        .subscription-card.selected {
            background: rgba(138, 43, 226, 0.1);
            border-color: #8a2be2;
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.3);
        }

        .subscription-badge {
            display: inline-block;
            padding: 6px 12px;
            background: linear-gradient(135deg, #00ffff, #8a2be2);
            color: #000000;
            font-size: 11px;
            font-weight: 700;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        .subscription-name {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 12px;
        }

        .subscription-price {
            font-size: 48px;
            font-weight: 700;
            background: linear-gradient(135deg, #00ffff, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subscription-period {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 24px;
        }

        .subscription-features {
            list-style: none;
        }

        .subscription-features li {
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }

        .subscription-features li:last-child {
            border-bottom: none;
        }

        .subscription-features li::before {
            content: '‚úì';
            color: #00ffff;
            font-weight: 700;
            margin-right: 12px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .phase-title {
                font-size: 36px;
            }

            .phase-subtitle {
                font-size: 16px;
            }

            .language-grid,
            .voice-grid,
            .device-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .btn {
                padding: 14px 32px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-particles"></div>
    
    <!-- Progress Bar -->
    <div class="progress-wrapper">
        <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        <div class="progress-steps">
            <div class="progress-step active" data-step="1">
                <div class="step-number">1</div>
                <span class="step-label">Language</span>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-number">2</div>
                <span class="step-label">Voice</span>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-number">3</div>
                <span class="step-label">Profile</span>
            </div>
            <div class="progress-step" data-step="4">
                <div class="step-number">4</div>
                <span class="step-label">Devices</span>
            </div>
            <div class="progress-step" data-step="5">
                <div class="step-number">5</div>
                <span class="step-label">Goals</span>
            </div>
            <div class="progress-step" data-step="6">
                <div class="step-number">6</div>
                <span class="step-label">Nutrition</span>
            </div>
            <div class="progress-step" data-step="7">
                <div class="step-number">7</div>
                <span class="step-label">Complete</span>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Phase 1: Language Selection -->
        <div class="phase active" id="phase1">
            <div class="phase-header">
                <h1 class="phase-title">Choose Your Language</h1>
                <p class="phase-subtitle">Select your preferred language for Phoenix</p>
            </div>
            <div class="language-grid">
                <div class="language-card" data-lang="en" data-name="English">
                    <div class="language-flag">üá∫üá∏</div>
                    <div class="language-name">English</div>
                </div>
                <div class="language-card" data-lang="es" data-name="Espa√±ol">
                    <div class="language-flag">üá™üá∏</div>
                    <div class="language-name">Espa√±ol</div>
                </div>
                <div class="language-card" data-lang="fr" data-name="Fran√ßais">
                    <div class="language-flag">üá´üá∑</div>
                    <div class="language-name">Fran√ßais</div>
                </div>
                <div class="language-card" data-lang="de" data-name="Deutsch">
                    <div class="language-flag">üá©üá™</div>
                    <div class="language-name">Deutsch</div>
                </div>
                <div class="language-card" data-lang="it" data-name="Italiano">
                    <div class="language-flag">üáÆüáπ</div>
                    <div class="language-name">Italiano</div>
                </div>
                <div class="language-card" data-lang="pt" data-name="Portugu√™s">
                    <div class="language-flag">üáßüá∑</div>
                    <div class="language-name">Portugu√™s</div>
                </div>
                <div class="language-card" data-lang="nl" data-name="Nederlands">
                    <div class="language-flag">üá≥üá±</div>
                    <div class="language-name">Nederlands</div>
                </div>
                <div class="language-card" data-lang="pl" data-name="Polski">
                    <div class="language-flag">üáµüá±</div>
                    <div class="language-name">Polski</div>
                </div>
                <div class="language-card" data-lang="ru" data-name="–†—É—Å—Å–∫–∏–π">
                    <div class="language-flag">üá∑üá∫</div>
                    <div class="language-name">–†—É—Å—Å–∫–∏–π</div>
                </div>
                <div class="language-card" data-lang="ja" data-name="Êó•Êú¨Ë™û">
                    <div class="language-flag">üáØüáµ</div>
                    <div class="language-name">Êó•Êú¨Ë™û</div>
                </div>
                <div class="language-card" data-lang="zh" data-name="‰∏≠Êñá">
                    <div class="language-flag">üá®üá≥</div>
                    <div class="language-name">‰∏≠Êñá</div>
                </div>
                <div class="language-card" data-lang="hi" data-name="‡§π‡§ø‡§®‡•ç‡§¶‡•Ä">
                    <div class="language-flag">üáÆüá≥</div>
                    <div class="language-name">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</div>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" id="nextPhase1" disabled>Continue</button>
            </div>
        </div>

        <!-- Phase 2: Voice Selection -->
        <div class="phase" id="phase2">
            <div class="phase-header">
                <h1 class="phase-title">Choose Your Voice</h1>
                <p class="phase-subtitle">Select Phoenix's voice personality</p>
            </div>
            <div class="voice-grid">
                <div class="voice-card" data-voice="alloy">
                    <div class="voice-icon">üé≠</div>
                    <div class="voice-name">Alloy</div>
                    <div class="voice-description">Balanced & Neutral</div>
                    <button class="voice-preview-btn" onclick="previewVoice('alloy', event)">‚ñ∂ Preview</button>
                </div>
                <div class="voice-card" data-voice="echo">
                    <div class="voice-icon">üéµ</div>
                    <div class="voice-name">Echo</div>
                    <div class="voice-description">Clear & Friendly</div>
                    <button class="voice-preview-btn" onclick="previewVoice('echo', event)">‚ñ∂ Preview</button>
                </div>
                <div class="voice-card" data-voice="fable">
                    <div class="voice-icon">üìñ</div>
                    <div class="voice-name">Fable</div>
                    <div class="voice-description">Warm & Expressive</div>
                    <button class="voice-preview-btn" onclick="previewVoice('fable', event)">‚ñ∂ Preview</button>
                </div>
                <div class="voice-card" data-voice="onyx">
                    <div class="voice-icon">üíé</div>
                    <div class="voice-name">Onyx</div>
                    <div class="voice-description">Deep & Smooth</div>
                    <button class="voice-preview-btn" onclick="previewVoice('onyx', event)">‚ñ∂ Preview</button>
                </div>
                <div class="voice-card" data-voice="nova">
                    <div class="voice-icon">‚≠ê</div>
                    <div class="voice-name">Nova</div>
                    <div class="voice-description">Bright & Energetic</div>
                    <button class="voice-preview-btn" onclick="previewVoice('nova', event)">‚ñ∂ Preview</button>
                </div>
                <div class="voice-card" data-voice="shimmer">
                    <div class="voice-icon">‚ú®</div>
                    <div class="voice-name">Shimmer</div>
                    <div class="voice-description">Soft & Gentle</div>
                    <button class="voice-preview-btn" onclick="previewVoice('shimmer', event)">‚ñ∂ Preview</button>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="previousPhase()">Back</button>
                <button class="btn btn-primary" id="nextPhase2" disabled>Continue</button>
            </div>
        </div>

        <!-- Phase 3: Profile Setup -->
        <div class="phase" id="phase3">
            <div class="phase-header">
                <h1 class="phase-title">Create Your Profile</h1>
                <p class="phase-subtitle">Help Phoenix understand you better</p>
            </div>
            <form id="profileForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="name" placeholder="John Doe" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email" placeholder="john@example.com" required>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="confirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" id="dateOfBirth" required>
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="gender" required>
                            <option value="">Select...</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                            <option value="prefer_not_to_say">Prefer not to say</option>
                        </select>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Height (cm)</label>
                        <input type="number" id="height" placeholder="175" min="100" max="250">
                    </div>
                    <div class="form-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="weight" placeholder="70" min="30" max="300">
                    </div>
                </div>
                <div class="form-group">
                    <label>Timezone</label>
                    <select id="timezone" required>
                        <option value="">Select timezone...</option>
                        <option value="America/New_York">Eastern Time (ET)</option>
                        <option value="America/Chicago">Central Time (CT)</option>
                        <option value="America/Denver">Mountain Time (MT)</option>
                        <option value="America/Los_Angeles">Pacific Time (PT)</option>
                        <option value="Europe/London">London (GMT)</option>
                        <option value="Europe/Paris">Paris (CET)</option>
                        <option value="Asia/Tokyo">Tokyo (JST)</option>
                        <option value="Asia/Shanghai">Shanghai (CST)</option>
                        <option value="Asia/Kolkata">India (IST)</option>
                        <option value="Australia/Sydney">Sydney (AEDT)</option>
                    </select>
                </div>
            </form>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="previousPhase()">Back</button>
                <button class="btn btn-primary" onclick="saveProfile()">Continue</button>
            </div>
        </div>

        <!-- Phase 4: Device Connections -->
        <div class="phase" id="phase4">
            <div class="phase-header">
                <h1 class="phase-title">Connect Your Devices</h1>
                <p class="phase-subtitle">Sync your wearables for personalized insights</p>
            </div>
            <div class="device-grid">
                <div class="device-card" data-device="fitbit">
                    <div class="device-logo">‚åö</div>
                    <div class="device-name">Fitbit</div>
                    <div class="device-status">Not connected</div>
                </div>
                <div class="device-card" data-device="polar">
                    <div class="device-logo">üíì</div>
                    <div class="device-name">Polar</div>
                    <div class="device-status">Not connected</div>
                </div>
                <div class="device-card disabled" data-device="garmin">
                    <div class="device-logo">üèÉ</div>
                    <div class="device-name">Garmin</div>
                    <div class="device-status">Coming soon</div>
                </div>
                <div class="device-card disabled" data-device="oura">
                    <div class="device-logo">üíç</div>
                    <div class="device-name">Oura</div>
                    <div class="device-status">Coming soon</div>
                </div>
                <div class="device-card disabled" data-device="whoop">
                    <div class="device-logo">üîÑ</div>
                    <div class="device-name">Whoop</div>
                    <div class="device-status">Coming soon</div>
                </div>
                <div class="device-card disabled" data-device="apple">
                    <div class="device-logo">üçé</div>
                    <div class="device-name">Apple Health</div>
                    <div class="device-status">Coming soon</div>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="previousPhase()">Back</button>
                <button class="btn btn-primary" onclick="nextPhase()">Continue</button>
                <button class="btn btn-skip" onclick="nextPhase()">Skip for now</button>
            </div>
        </div>

        <!-- Phase 5: Goals & Habits -->
        <div class="phase" id="phase5">
            <div class="phase-header">
                <h1 class="phase-title">Set Your Goals</h1>
                <p class="phase-subtitle">What do you want to achieve?</p>
            </div>
            <form id="goalsForm">
                <div class="form-group">
                    <label>Primary Goal</label>
                    <select id="primaryGoal" required>
                        <option value="">Select your main goal...</option>
                        <option value="weight_loss">Weight Loss</option>
                        <option value="muscle_gain">Build Muscle</option>
                        <option value="strength">Increase Strength</option>
                        <option value="endurance">Improve Endurance</option>
                        <option value="health">General Health</option>
                        <option value="performance">Athletic Performance</option>
                        <option value="recovery">Better Recovery</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Activity Level</label>
                    <select id="activityLevel" required>
                        <option value="">Select your activity level...</option>
                        <option value="sedentary">Sedentary (little to no exercise)</option>
                        <option value="light">Light (1-3 days/week)</option>
                        <option value="moderate">Moderate (3-5 days/week)</option>
                        <option value="active">Active (6-7 days/week)</option>
                        <option value="very_active">Very Active (twice per day)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>What motivates you? (Optional)</label>
                    <input type="text" id="motivation" placeholder="e.g., Running a marathon, looking better...">
                </div>
            </form>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="previousPhase()">Back</button>
                <button class="btn btn-primary" onclick="saveGoals()">Continue</button>
            </div>
        </div>

        <!-- Phase 6: Nutrition Setup -->
        <div class="phase" id="phase6">
            <div class="phase-header">
                <h1 class="phase-title">Nutrition Preferences</h1>
                <p class="phase-subtitle">Customize your nutrition tracking</p>
            </div>
            <form id="nutritionForm">
                <div class="form-group">
                    <label>Dietary Preference</label>
                    <select id="dietaryPreference">
                        <option value="none">No specific diet</option>
                        <option value="vegetarian">Vegetarian</option>
                        <option value="vegan">Vegan</option>
                        <option value="keto">Ketogenic</option>
                        <option value="paleo">Paleo</option>
                        <option value="mediterranean">Mediterranean</option>
                        <option value="carnivore">Carnivore</option>
                        <option value="intermittent_fasting">Intermittent Fasting</option>
                    </select>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Daily Calorie Target (kcal)</label>
                        <input type="number" id="calorieTarget" placeholder="2000" min="1000" max="5000">
                    </div>
                    <div class="form-group">
                        <label>Protein Target (g)</label>
                        <input type="number" id="proteinTarget" placeholder="150" min="0" max="500">
                    </div>
                </div>
                <div class="form-group">
                    <label>Food Allergies/Restrictions (Optional)</label>
                    <input type="text" id="restrictions" placeholder="e.g., peanuts, gluten, dairy...">
                </div>
            </form>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="previousPhase()">Back</button>
                <button class="btn btn-primary" onclick="saveNutrition()">Continue</button>
            </div>
        </div>

        <!-- Phase 7: Complete -->
        <div class="phase" id="phase7">
            <div class="phase-header">
                <h1 class="phase-title">üéâ You're All Set!</h1>
                <p class="phase-subtitle">Choose your subscription plan</p>
            </div>
            <div class="subscription-grid">
                <div class="subscription-card" data-plan="free">
                    <div class="subscription-badge">Free</div>
                    <div class="subscription-name">Starter</div>
                    <div class="subscription-price">$0</div>
                    <div class="subscription-period">Forever free</div>
                    <ul class="subscription-features">
                        <li>Basic health tracking</li>
                        <li>Workout logging</li>
                        <li>Goal setting</li>
                        <li>Community access</li>
                    </ul>
                </div>
                <div class="subscription-card selected" data-plan="pro">
                    <div class="subscription-badge">Most Popular</div>
                    <div class="subscription-name">Pro</div>
                    <div class="subscription-price">$29</div>
                    <div class="subscription-period">per month</div>
                    <ul class="subscription-features">
                        <li>Everything in Free</li>
                        <li>AI companion chat</li>
                        <li>Advanced analytics</li>
                        <li>Device integrations</li>
                        <li>Pattern detection</li>
                        <li>Predictions & insights</li>
                    </ul>
                </div>
                <div class="subscription-card" data-plan="elite">
                    <div class="subscription-badge">Best Value</div>
                    <div class="subscription-name">Elite</div>
                    <div class="subscription-price">$99</div>
                    <div class="subscription-period">per month</div>
                    <ul class="subscription-features">
                        <li>Everything in Pro</li>
                        <li>Voice AI assistant</li>
                        <li>Butler services</li>
                        <li>Quantum workouts</li>
                        <li>Priority support</li>
                        <li>Custom integrations</li>
                        <li>Early access features</li>
                    </ul>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="previousPhase()">Back</button>
                <button class="btn btn-primary" onclick="completeOnboarding()">Start Your Journey</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <script>
        // Configuration
        const API_URL = 'https://pal-backend-production.up.railway.app';
        
        // State
        let currentPhase = 1;
        let userData = {
            language: '',
            languageName: '',
            voice: '',
            profile: {},
            devices: [],
            goals: {},
            nutrition: {},
            subscription: 'pro'
        };
        let currentAudio = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkDeviceCallback();
            setupLanguageSelection();
            setupVoiceSelection();
            setupDeviceCards();
            setupSubscriptionCards();
        });

        // Language Selection
        function setupLanguageSelection() {
            document.querySelectorAll('.language-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.language-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    userData.language = card.dataset.lang;
                    userData.languageName = card.dataset.name;
                    document.getElementById('nextPhase1').disabled = false;
                });
            });
            
            document.getElementById('nextPhase1').addEventListener('click', () => nextPhase());
        }

        // Voice Selection
        function setupVoiceSelection() {
            document.querySelectorAll('.voice-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (e.target.classList.contains('voice-preview-btn')) return;
                    
                    document.querySelectorAll('.voice-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    userData.voice = card.dataset.voice;
                    document.getElementById('nextPhase2').disabled = false;
                });
            });
            
            document.getElementById('nextPhase2').addEventListener('click', () => nextPhase());
        }

        // Voice Preview with OpenAI TTS
        async function previewVoice(voiceId, event) {
            event.stopPropagation();
            const btn = event.target;
            const originalText = btn.textContent;
            
            try {
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio = null;
                }

                btn.textContent = '‚è≥ Loading...';
                btn.disabled = true;

                const welcomeMessages = {
                    'en': 'Hello! I am Phoenix, your AI health companion.',
                    'es': '¬°Hola! Soy Phoenix, tu compa√±ero de salud con IA.',
                    'fr': 'Bonjour! Je suis Phoenix, votre compagnon de sant√© IA.',
                    'de': 'Hallo! Ich bin Phoenix, dein KI-Gesundheitsbegleiter.',
                    'it': 'Ciao! Sono Phoenix, il tuo compagno di salute AI.',
                    'pt': 'Ol√°! Eu sou Phoenix, seu companheiro de sa√∫de com IA.',
                    'nl': 'Hallo! Ik ben Phoenix, je AI-gezondheidsgezin.',
                    'pl': 'Cze≈õƒá! Jestem Phoenix, twoim towarzyszem zdrowia AI.',
                    'ru': '–ü—Ä–∏–≤–µ—Ç! –Ø –§–µ–Ω–∏–∫—Å, –≤–∞—à –∫–æ–º–ø–∞–Ω—å–æ–Ω –ø–æ –∑–¥–æ—Ä–æ–≤—å—é —Å –ò–ò.',
                    'ja': '„Åì„Çì„Å´„Å°„ÅØÔºÅÁßÅ„ÅØPhoenix„ÄÅ„ÅÇ„Å™„Åü„ÅÆAIÂÅ•Â∫∑„Ç≥„É≥„Éë„Éã„Ç™„É≥„Åß„Åô„ÄÇ',
                    'zh': '‰Ω†Â•ΩÔºÅÊàëÊòØPhoenixÔºå‰Ω†ÁöÑAIÂÅ•Â∫∑‰º¥‰æ£„ÄÇ',
                    'hi': '‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç Phoenix ‡§π‡•Ç‡§Ç, ‡§Ü‡§™‡§ï‡§æ AI ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§æ‡§•‡•Ä‡•§'
                };

                const text = welcomeMessages[userData.language] || welcomeMessages['en'];

                const response = await fetch(`${API_URL}/api/tts/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, voice: voiceId, language: userData.language })
                });

                if (!response.ok) throw new Error('TTS generation failed');

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);

                currentAudio = new Audio(audioUrl);
                btn.textContent = 'üîä Playing...';

                currentAudio.onended = () => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                    URL.revokeObjectURL(audioUrl);
                    currentAudio = null;
                };

                currentAudio.onerror = () => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                    URL.revokeObjectURL(audioUrl);
                    currentAudio = null;
                    showToast('Audio playback failed', 'error');
                };

                await currentAudio.play();

            } catch (error) {
                console.error('Preview error:', error);
                btn.textContent = originalText;
                btn.disabled = false;
                showToast('Preview failed. Please try again.', 'error');
            }
        }

        // Profile Setup
        async function saveProfile() {
            const form = document.getElementById('profileForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }

            userData.profile = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                password: password,
                dateOfBirth: document.getElementById('dateOfBirth').value,
                gender: document.getElementById('gender').value,
                height: parseInt(document.getElementById('height').value) || null,
                weight: parseInt(document.getElementById('weight').value) || null,
                timezone: document.getElementById('timezone').value
            };

            showLoading(true);

            try {
                const response = await fetch(`${API_URL}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: userData.profile.name,
                        email: userData.profile.email,
                        password: userData.profile.password,
                        language: userData.language,
                        voice: userData.voice
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Registration failed');
                }

                const data = await response.json();
                localStorage.setItem('phoenixToken', data.token);
                localStorage.setItem('phoenixUser', JSON.stringify(data.user));

                await fetch(`${API_URL}/api/users/profile`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${data.token}`
                    },
                    body: JSON.stringify({
                        dateOfBirth: userData.profile.dateOfBirth,
                        gender: userData.profile.gender,
                        height: userData.profile.height,
                        weight: userData.profile.weight,
                        timezone: userData.profile.timezone
                    })
                });

                showLoading(false);
                showToast('Profile created successfully!', 'success');
                nextPhase();

            } catch (error) {
                showLoading(false);
                showToast(error.message, 'error');
            }
        }

        // Device Connection
        function setupDeviceCards() {
            document.querySelectorAll('.device-card:not(.disabled)').forEach(card => {
                card.addEventListener('click', () => connectDevice(card.dataset.device));
            });
        }

        async function connectDevice(provider) {
            const token = localStorage.getItem('phoenixToken');
            if (!token) {
                showToast('Please complete profile setup first', 'error');
                return;
            }

            showLoading(true);

            try {
                const response = await fetch(`${API_URL}/api/mercury/devices/${provider}/connect`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('Device connection failed');

                const data = await response.json();
                
                if (data.authUrl) {
                    window.location.href = data.authUrl;
                }

            } catch (error) {
                showLoading(false);
                showToast(`Failed to connect ${provider}`, 'error');
            }
        }

        function checkDeviceCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const device = urlParams.get('device');
            const status = urlParams.get('status');

            if (device && status === 'success') {
                const card = document.querySelector(`[data-device="${device}"]`);
                if (card) {
                    card.classList.add('connected');
                    card.querySelector('.device-status').textContent = 'Connected ‚úì';
                    userData.devices.push(device);
                }
                showToast(`${device} connected successfully!`, 'success');
                window.history.replaceState({}, document.title, window.location.pathname);
            } else if (status === 'error') {
                showToast('Device connection failed', 'error');
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // Goals Setup
        async function saveGoals() {
            const primaryGoal = document.getElementById('primaryGoal').value;
            const activityLevel = document.getElementById('activityLevel').value;

            if (!primaryGoal || !activityLevel) {
                showToast('Please complete all required fields', 'error');
                return;
            }

            userData.goals = {
                primary: primaryGoal,
                activityLevel: activityLevel,
                motivation: document.getElementById('motivation').value
            };

            const token = localStorage.getItem('phoenixToken');
            if (token) {
                try {
                    showLoading(true);
                    await fetch(`${API_URL}/api/users/profile`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            primaryGoal: userData.goals.primary,
                            activityLevel: userData.goals.activityLevel
                        })
                    });
                    showLoading(false);
                } catch (error) {
                    showLoading(false);
                }
            }

            nextPhase();
        }

        // Nutrition Setup
        async function saveNutrition() {
            userData.nutrition = {
                dietary: document.getElementById('dietaryPreference').value,
                calories: parseInt(document.getElementById('calorieTarget').value) || null,
                protein: parseInt(document.getElementById('proteinTarget').value) || null,
                restrictions: document.getElementById('restrictions').value
            };

            const token = localStorage.getItem('phoenixToken');
            if (token && (userData.nutrition.calories || userData.nutrition.protein)) {
                try {
                    showLoading(true);
                    await fetch(`${API_URL}/api/venus/nutrition/targets`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            calorieTarget: userData.nutrition.calories,
                            proteinTarget: userData.nutrition.protein
                        })
                    });
                    showLoading(false);
                } catch (error) {
                    showLoading(false);
                }
            }

            nextPhase();
        }

        // Subscription Selection
        function setupSubscriptionCards() {
            document.querySelectorAll('.subscription-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.subscription-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    userData.subscription = card.dataset.plan;
                });
            });
        }

        // Complete Onboarding
        async function completeOnboarding() {
            showLoading(true);

            localStorage.setItem('phoenixOnboardingData', JSON.stringify(userData));
            localStorage.setItem('phoenixOnboardingComplete', 'true');

            if (userData.subscription !== 'free') {
                const token = localStorage.getItem('phoenixToken');
                if (token) {
                    try {
                        const response = await fetch(`${API_URL}/api/subscriptions/checkout`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({ plan: userData.subscription })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            window.location.href = data.url;
                            return;
                        }
                    } catch (error) {
                        console.error('Checkout error:', error);
                    }
                }
            }

            showLoading(false);
            showToast('Welcome to Phoenix! üéâ', 'success');
            
            setTimeout(() => {
                window.location.href = '/index.html';
            }, 1500);
        }

        // Navigation
        function nextPhase() {
            if (currentPhase < 7) {
                document.getElementById(`phase${currentPhase}`).classList.remove('active');
                currentPhase++;
                document.getElementById(`phase${currentPhase}`).classList.add('active');
                updateProgress();
            }
        }

        function previousPhase() {
            if (currentPhase > 1) {
                document.getElementById(`phase${currentPhase}`).classList.remove('active');
                currentPhase--;
                document.getElementById(`phase${currentPhase}`).classList.add('active');
                updateProgress();
            }
        }

        function updateProgress() {
            const progress = ((currentPhase - 1) / 6) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;

            document.querySelectorAll('.progress-step').forEach((step, index) => {
                if (index + 1 < currentPhase) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (index + 1 === currentPhase) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }

        // Utilities
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.toggle('show', show);
        }
    </script>
</body>
</html>
