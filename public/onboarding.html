<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phoenix - Onboarding</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', 'Consolas', monospace;
            background: #000;
            color: #00ffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Background effects */
        .background {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at 50% 50%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(0, 255, 255, 0.05) 0%, transparent 40%);
            pointer-events: none;
        }

        .grid-overlay {
            position: fixed;
            inset: 0;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            opacity: 0.2;
        }

        /* Container */
        .onboarding-container {
            position: relative;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .onboarding-header {
            text-align: center;
            padding: 40px 0 20px;
        }

        .phoenix-logo {
            font-size: 48px;
            margin-bottom: 12px;
            animation: float 3s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .phoenix-title {
            font-size: 32px;
            font-weight: 700;
            color: #00ffff;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
            margin-bottom: 8px;
            letter-spacing: 8px;
        }

        .phoenix-subtitle {
            color: rgba(0, 255, 255, 0.6);
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* Progress Bar */
        .progress-container {
            margin: 40px 0;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 12px;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .progress-step-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid rgba(0, 255, 255, 0.3);
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .progress-step.active .progress-step-circle {
            background: rgba(0, 255, 255, 0.3);
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.6);
        }

        .progress-step.completed .progress-step-circle {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
        }

        .progress-step-label {
            font-size: 11px;
            color: rgba(0, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .progress-step.active .progress-step-label {
            color: #00ffff;
            font-weight: 600;
        }

        .progress-line {
            position: absolute;
            top: 16px;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(0, 255, 255, 0.1);
            z-index: 0;
        }

        .progress-line-fill {
            height: 100%;
            background: linear-gradient(90deg, rgba(0, 255, 255, 0.5), #00ffff);
            transition: width 0.5s ease;
            width: 0%;
        }

        /* Phase Container */
        .phase {
            display: none;
            flex: 1;
        }

        .phase.active {
            display: block;
            animation: fadeInUp 0.4s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .phase-content {
            background: rgba(0, 10, 20, 0.9);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 16px;
            padding: 40px;
            backdrop-filter: blur(10px);
        }

        .phase-header {
            margin-bottom: 32px;
        }

        .phase-number {
            color: #00ffff;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 12px;
        }

        .phase-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            line-height: 1.2;
            color: #00ffff;
        }

        .phase-description {
            color: rgba(0, 255, 255, 0.7);
            font-size: 15px;
            line-height: 1.6;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: rgba(0, 255, 255, 0.9);
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        label .required {
            color: #00ffff;
        }

        input[type="text"],
        input[type="email"],
        input[type="date"],
        input[type="number"],
        select {
            width: 100%;
            padding: 14px 16px;
            background: rgba(0, 10, 20, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            color: #00ffff;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #00ffff;
            background: rgba(0, 10, 20, 0.9);
            box-shadow: 0 0 0 3px rgba(0, 255, 255, 0.2);
        }

        input.error,
        select.error {
            border-color: #ff4444;
        }

        .error-message {
            color: #ff4444;
            font-size: 12px;
            margin-top: 6px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .help-text {
            font-size: 12px;
            color: rgba(0, 255, 255, 0.5);
            margin-top: 6px;
        }

        /* Selection Cards */
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }

        .selection-card {
            background: rgba(0, 10, 20, 0.8);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            position: relative;
        }

        .selection-card:hover {
            border-color: rgba(0, 255, 255, 0.6);
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .selection-card.selected {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .selection-card-icon {
            font-size: 36px;
            margin-bottom: 12px;
        }

        .selection-card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 6px;
            color: #00ffff;
        }

        .selection-card-description {
            font-size: 12px;
            color: rgba(0, 255, 255, 0.6);
        }

        /* Device Cards */
        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin: 24px 0;
        }

        .device-card {
            background: rgba(0, 10, 20, 0.8);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .device-card:hover {
            border-color: rgba(0, 255, 255, 0.6);
            background: rgba(0, 255, 255, 0.1);
        }

        .device-card.connected {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .device-logo {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .device-name {
            font-size: 13px;
            font-weight: 600;
            color: #00ffff;
        }

        .device-status {
            font-size: 11px;
            color: rgba(0, 255, 255, 0.5);
            margin-top: 4px;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 40px;
        }

        button {
            padding: 14px 32px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            flex: 1;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(0, 255, 255, 0.5));
            border: 2px solid #00ffff;
            color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.5), rgba(0, 255, 255, 0.7));
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.6);
        }

        .btn-primary:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(0, 10, 20, 0.8);
            color: #00ffff;
            border: 1px solid rgba(0, 255, 255, 0.5);
        }

        .btn-secondary:hover {
            background: rgba(0, 255, 255, 0.1);
            border-color: #00ffff;
        }

        .btn-skip {
            background: transparent;
            color: rgba(0, 255, 255, 0.5);
            padding: 14px 24px;
        }

        .btn-skip:hover {
            color: rgba(0, 255, 255, 0.8);
        }

        /* Data Status */
        .data-status {
            background: rgba(0, 10, 20, 0.8);
            border: 2px dashed rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            color: rgba(0, 255, 255, 0.5);
            font-size: 14px;
            margin: 20px 0;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid rgba(0, 255, 255, 0.2);
            border-top: 3px solid #00ffff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success Animation */
        .success-animation {
            text-align: center;
            padding: 60px 20px;
        }

        .success-icon {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.5), #00ffff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 32px;
            animation: scaleIn 0.5s ease, pulse 2s ease-in-out infinite;
            box-shadow: 0 0 40px rgba(0, 255, 255, 0.8);
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 40px rgba(0, 255, 255, 0.8); }
            50% { box-shadow: 0 0 60px rgba(0, 255, 255, 1); }
        }

        .success-icon svg {
            width: 50px;
            height: 50px;
            stroke: #000;
            stroke-width: 3;
            fill: none;
        }

        /* Subscription Plans */
        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .plan-card {
            background: rgba(0, 10, 20, 0.8);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 28px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .plan-card:hover {
            border-color: rgba(0, 255, 255, 0.6);
            transform: translateY(-4px);
        }

        .plan-card.recommended {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.15);
        }

        .plan-badge {
            position: absolute;
            top: -12px;
            right: 20px;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.5), #00ffff);
            color: #000;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .plan-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #00ffff;
        }

        .plan-price {
            font-size: 32px;
            font-weight: 700;
            color: #00ffff;
            margin-bottom: 16px;
        }

        .plan-price span {
            font-size: 16px;
            color: rgba(0, 255, 255, 0.6);
        }

        .plan-features {
            list-style: none;
            margin-bottom: 20px;
        }

        .plan-features li {
            padding: 8px 0;
            font-size: 14px;
            color: rgba(0, 255, 255, 0.8);
        }

        .plan-features li::before {
            content: "âœ“";
            color: #00ff88;
            margin-right: 8px;
            font-weight: bold;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .onboarding-container {
                padding: 12px;
            }

            .phase-content {
                padding: 24px 20px;
            }

            .phoenix-title {
                font-size: 24px;
            }

            .phase-title {
                font-size: 22px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .selection-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .btn-secondary {
                order: 2;
            }

            .btn-primary {
                order: 1;
            }

            .btn-skip {
                order: 3;
            }
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <div class="grid-overlay"></div>

    <div class="onboarding-container">
        <!-- Header -->
        <div class="onboarding-header">
            <div class="phoenix-logo">ðŸ”¥</div>
            <h1 class="phoenix-title">PHOENIX</h1>
            <p class="phoenix-subtitle">Autonomous Life Operating System</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-line">
                    <div class="progress-line-fill" id="progressLineFill"></div>
                </div>
                <div class="progress-step active" data-phase="1">
                    <div class="progress-step-circle">1</div>
                    <div class="progress-step-label">Voice</div>
                </div>
                <div class="progress-step" data-phase="2">
                    <div class="progress-step-circle">2</div>
                    <div class="progress-step-label">Profile</div>
                </div>
                <div class="progress-step" data-phase="3">
                    <div class="progress-step-circle">3</div>
                    <div class="progress-step-label">Devices</div>
                </div>
                <div class="progress-step" data-phase="4">
                    <div class="progress-step-circle">4</div>
                    <div class="progress-step-label">Goals</div>
                </div>
                <div class="progress-step" data-phase="5">
                    <div class="progress-step-circle">5</div>
                    <div class="progress-step-label">Calendar</div>
                </div>
                <div class="progress-step" data-phase="6">
                    <div class="progress-step-circle">6</div>
                    <div class="progress-step-label">Finance</div>
                </div>
                <div class="progress-step" data-phase="7">
                    <div class="progress-step-circle">7</div>
                    <div class="progress-step-label">Plan</div>
                </div>
                <div class="progress-step" data-phase="8">
                    <div class="progress-step-circle">8</div>
                    <div class="progress-step-label">Complete</div>
                </div>
            </div>
        </div>

        <!-- Phase 1: Voice & Language Selection -->
        <div class="phase active" id="phase1">
            <div class="phase-content">
                <div class="phase-header">
                    <div class="phase-number">Phase 1 of 8</div>
                    <h2 class="phase-title">Choose Your AI Companion</h2>
                    <p class="phase-description">Select a voice personality and language for your Phoenix AI companion.</p>
                </div>

                <div class="form-group">
                    <label>AI Personality</label>
                    <div class="selection-grid" id="personalityGrid">
                        <div class="data-status">No current data</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Language</label>
                    <div class="selection-grid" id="languageGrid">
                        <div class="data-status">No current data</div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-primary" onclick="nextPhase()">Continue</button>
                </div>
            </div>
        </div>

        <!-- Phase 2: Basic Profile -->
        <div class="phase" id="phase2">
            <div class="phase-content">
                <div class="phase-header">
                    <div class="phase-number">Phase 2 of 8</div>
                    <h2 class="phase-title">Create Your Profile</h2>
                    <p class="phase-description">Tell us about yourself to personalize your Phoenix experience.</p>
                </div>

                <form id="profileForm">
                    <div class="form-group">
                        <label for="name">Full Name <span class="required">*</span></label>
                        <input type="text" id="name" required>
                        <div class="error-message" id="nameError">Please enter your name</div>
                    </div>

                    <div class="form-group">
                        <label for="email">Email <span class="required">*</span></label>
                        <input type="email" id="email" required>
                        <div class="error-message" id="emailError">Please enter a valid email</div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="timezone">Timezone <span class="required">*</span></label>
                            <select id="timezone" required>
                                <option value="">Select timezone</option>
                                <option value="America/New_York">Eastern Time (ET)</option>
                                <option value="America/Chicago">Central Time (CT)</option>
                                <option value="America/Denver">Mountain Time (MT)</option>
                                <option value="America/Los_Angeles">Pacific Time (PT)</option>
                            </select>
                            <div class="error-message" id="timezoneError">Please select a timezone</div>
                        </div>

                        <div class="form-group">
                            <label for="dateOfBirth">Date of Birth</label>
                            <input type="date" id="dateOfBirth">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="gender">Gender</label>
                            <select id="gender">
                                <option value="">Select gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                                <option value="prefer_not_to_say">Prefer not to say</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="height">Height (cm)</label>
                            <input type="number" id="height" placeholder="170">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="weight">Weight (kg)</label>
                        <input type="number" id="weight" placeholder="70">
                    </div>
                </form>

                <div class="button-group">
                    <button class="btn-secondary" onclick="previousPhase()">Back</button>
                    <button class="btn-primary" onclick="validateAndNext(2)">Continue</button>
                </div>
            </div>
        </div>

        <!-- Phase 3: Wearables -->
        <div class="phase" id="phase3">
            <div class="phase-content">
                <div class="phase-header">
                    <div class="phase-number">Phase 3 of 8</div>
                    <h2 class="phase-title">Connect Your Devices</h2>
                    <p class="phase-description">Connect wearables and health devices to automatically track your biometrics.</p>
                </div>

                <div class="device-grid" id="deviceGrid">
                    <div class="data-status">No current data</div>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="previousPhase()">Back</button>
                    <button class="btn-primary" onclick="nextPhase()">Continue</button>
                    <button class="btn-skip" onclick="skipPhase(3)">Skip for now</button>
                </div>
            </div>
        </div>

        <!-- Phase 4: Goals -->
        <div class="phase" id="phase4">
            <div class="phase-content">
                <div class="phase-header">
                    <div class="phase-number">Phase 4 of 8</div>
                    <h2 class="phase-title">Set Your Goals</h2>
                    <p class="phase-description">Define your initial goals and nutrition targets.</p>
                </div>

                <div class="form-group">
                    <label>Choose a Goal Template</label>
                    <div class="selection-grid" id="goalTemplates">
                        <div class="data-status">No current data</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Nutrition Targets (Auto-calculated based on your profile)</label>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="calories">Daily Calories</label>
                            <input type="number" id="calories" placeholder="2000">
                        </div>
                        <div class="form-group">
                            <label for="protein">Protein (g)</label>
                            <input type="number" id="protein" placeholder="150">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="carbs">Carbs (g)</label>
                            <input type="number" id="carbs" placeholder="200">
                        </div>
                        <div class="form-group">
                            <label for="fats">Fats (g)</label>
                            <input type="number" id="fats" placeholder="65">
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="previousPhase()">Back</button>
                    <button class="btn-primary" onclick="saveGoals()">Continue</button>
                    <button class="btn-skip" onclick="skipPhase(4)">Skip for now</button>
                </div>
            </div>
        </div>

        <!-- Phase 5: Calendar -->
        <div class="phase" id="phase5">
            <div class="phase-content">
                <div class="phase-header">
                    <div class="phase-number">Phase 5 of 8</div>
                    <h2 class="phase-title">Connect Your Calendar</h2>
                    <p class="phase-description">Sync your calendar to enable energy-based scheduling and conflict detection.</p>
                </div>

                <div class="selection-grid">
                    <div class="selection-card" onclick="connectCalendar('google')">
                        <div class="selection-card-icon">ðŸ“…</div>
                        <div class="selection-card-title">Google Calendar</div>
                        <div class="selection-card-description">Connect Google account</div>
                    </div>
                    <div class="selection-card" onclick="connectCalendar('outlook')">
                        <div class="selection-card-icon">ðŸ“†</div>
                        <div class="selection-card-title">Outlook Calendar</div>
                        <div class="selection-card-description">Connect Microsoft account</div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="previousPhase()">Back</button>
                    <button class="btn-primary" onclick="nextPhase()">Continue</button>
                    <button class="btn-skip" onclick="skipPhase(5)">Skip for now</button>
                </div>
            </div>
        </div>

        <!-- Phase 6: Finance -->
        <div class="phase" id="phase6">
            <div class="phase-content">
                <div class="phase-header">
                    <div class="phase-number">Phase 6 of 8</div>
                    <h2 class="phase-title">Connect Your Finances</h2>
                    <p class="phase-description">Link your bank accounts to track spending and detect stress-spending patterns.</p>
                </div>

                <div class="data-status" style="margin: 40px 0;">
                    <p style="margin-bottom: 20px;">Secure connection via Plaid</p>
                    <button class="btn-primary" onclick="connectPlaid()" style="max-width: 300px; margin: 0 auto;">
                        ðŸ”’ Connect Bank Account
                    </button>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="previousPhase()">Back</button>
                    <button class="btn-primary" onclick="nextPhase()">Continue</button>
                    <button class="btn-skip" onclick="skipPhase(6)">Skip for now</button>
                </div>
            </div>
        </div>

        <!-- Phase 7: Subscription -->
        <div class="phase" id="phase7">
            <div class="phase-content">
                <div class="phase-header">
                    <div class="phase-number">Phase 7 of 8</div>
                    <h2 class="phase-title">Choose Your Plan</h2>
                    <p class="phase-description">Select a subscription plan that fits your needs. Start with a 14-day free trial.</p>
                </div>

                <div class="plans-grid">
                    <div class="plan-card" onclick="selectPlan('trial')">
                        <div class="plan-badge">Start Here</div>
                        <div class="plan-name">Free Trial</div>
                        <div class="plan-price">$0 <span>/14 days</span></div>
                        <ul class="plan-features">
                            <li>Full access to all features</li>
                            <li>No credit card required</li>
                            <li>Cancel anytime</li>
                        </ul>
                    </div>

                    <div class="plan-card recommended">
                        <div class="plan-badge">Recommended</div>
                        <div class="plan-name">Phoenix Pro</div>
                        <div class="plan-price">$29 <span>/month</span></div>
                        <ul class="plan-features">
                            <li>Unlimited AI analysis</li>
                            <li>Real-time predictions</li>
                            <li>Autonomous butler actions</li>
                            <li>All integrations</li>
                        </ul>
                    </div>

                    <div class="plan-card" onclick="selectPlan('elite')">
                        <div class="plan-name">Phoenix Elite</div>
                        <div class="plan-price">$99 <span>/month</span></div>
                        <ul class="plan-features">
                            <li>Everything in Pro</li>
                            <li>Priority support</li>
                            <li>Custom AI training</li>
                            <li>API access</li>
                        </ul>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="previousPhase()">Back</button>
                    <button class="btn-primary" onclick="startTrial()">Start Free Trial</button>
                </div>
            </div>
        </div>

        <!-- Phase 8: Complete -->
        <div class="phase" id="phase8">
            <div class="phase-content">
                <div class="success-animation">
                    <div class="success-icon">
                        <svg viewBox="0 0 24 24">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                    <h2 class="phase-title">Welcome to Phoenix!</h2>
                    <p class="phase-description">Your autonomous life operating system is ready. Let's begin your transformation.</p>

                    <div class="loading" id="finalLoading">
                        <div class="spinner"></div>
                        <p style="color: rgba(255, 255, 255, 0.6); margin-top: 12px;">Initializing your Phoenix system...</p>
                    </div>

                    <div class="button-group" id="launchButton" style="margin-top: 40px;">
                        <button class="btn-primary" onclick="launchApp()">ðŸš€ Launch Phoenix</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = '/api';
        const ENDPOINTS = {
            // Phase 1: Voice & Language
            getPersonalities: `${API_BASE}/phoenix/companion/personalities`,
            getLanguages: `${API_BASE}/user/language-preferences`,
            setPersonality: `${API_BASE}/phoenix/companion/personality`,
            setLanguage: `${API_BASE}/user/language`,

            // Phase 2: Profile
            createProfile: `${API_BASE}/user/profile`,
            updateSettings: `${API_BASE}/user/settings`,

            // Phase 3: Wearables
            ouraAuth: `${API_BASE}/mercury/device/oura/auth`,
            whoopAuth: `${API_BASE}/mercury/device/whoop/auth`,
            fitbitAuth: `${API_BASE}/mercury/device/fitbit/auth`,
            garminAuth: `${API_BASE}/mercury/device/garmin/auth`,
            appleHealthAuth: `${API_BASE}/mercury/device/apple-health/auth`,
            polarAuth: `${API_BASE}/mercury/device/polar/auth`,

            // Phase 4: Goals
            createGoal: `${API_BASE}/mars/goals`,
            getGoalTemplates: `${API_BASE}/mars/goals/templates`,
            setNutritionTargets: `${API_BASE}/venus/nutrition/targets`,
            calculateMacros: `${API_BASE}/venus/nutrition/targets/calculate`,

            // Phase 5: Calendar
            connectGoogle: `${API_BASE}/earth/calendar/connect/google`,
            connectOutlook: `${API_BASE}/earth/calendar/connect/outlook`,

            // Phase 6: Finance
            plaidLinkToken: `${API_BASE}/jupiter/link-token`,
            plaidExchange: `${API_BASE}/jupiter/exchange-token`,

            // Phase 7: Subscription
            subscriptionStatus: `${API_BASE}/subscription/status`,
            createCheckout: `${API_BASE}/subscription/checkout`,

            // Phase 8: Complete
            completeOnboarding: `${API_BASE}/user/onboarding/complete`
        };

        // State
        let currentPhase = 1;
        const totalPhases = 8;
        let onboardingData = {
            personality: null,
            language: null,
            profile: {},
            devices: [],
            goals: [],
            nutritionTargets: {},
            calendar: null,
            finance: null,
            subscription: null
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await loadPersonalities();
            await loadLanguages();
            await loadDevices();
            await loadGoalTemplates();
        });

        // Navigation
        function nextPhase() {
            if (currentPhase < totalPhases) {
                document.getElementById(`phase${currentPhase}`).classList.remove('active');
                currentPhase++;
                document.getElementById(`phase${currentPhase}`).classList.add('active');
                updateProgress();
            }
        }

        function previousPhase() {
            if (currentPhase > 1) {
                document.getElementById(`phase${currentPhase}`).classList.remove('active');
                currentPhase--;
                document.getElementById(`phase${currentPhase}`).classList.add('active');
                updateProgress();
            }
        }

        function skipPhase(phase) {
            console.log(`Skipping phase ${phase}`);
            nextPhase();
        }

        function updateProgress() {
            const progress = (currentPhase / totalPhases) * 100;
            document.getElementById('progressLineFill').style.width = `${progress}%`;

            // Update step indicators
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                const phaseNum = index + 1;
                if (phaseNum < currentPhase) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (phaseNum === currentPhase) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }

        // Phase 1: Load Personalities and Languages
        async function loadPersonalities() {
            try {
                const response = await fetch(ENDPOINTS.getPersonalities);
                if (!response.ok) throw new Error('Failed to load personalities');
                const data = await response.json();
                
                const grid = document.getElementById('personalityGrid');
                if (data && data.length > 0) {
                    grid.innerHTML = data.map(p => `
                        <div class="selection-card" onclick="selectPersonality('${p.id}')">
                            <div class="selection-card-icon">${p.icon}</div>
                            <div class="selection-card-title">${p.name}</div>
                            <div class="selection-card-description">${p.description}</div>
                        </div>
                    `).join('');
                } else {
                    grid.innerHTML = '<div class="data-status">No current data</div>';
                }
            } catch (error) {
                console.error('Error loading personalities:', error);
                document.getElementById('personalityGrid').innerHTML = '<div class="data-status">No current data</div>';
            }
        }

        async function loadLanguages() {
            try {
                const response = await fetch(ENDPOINTS.getLanguages);
                if (!response.ok) throw new Error('Failed to load languages');
                const data = await response.json();
                
                const grid = document.getElementById('languageGrid');
                if (data && data.length > 0) {
                    grid.innerHTML = data.map(l => `
                        <div class="selection-card" onclick="selectLanguage('${l.code}')">
                            <div class="selection-card-icon">${l.flag}</div>
                            <div class="selection-card-title">${l.name}</div>
                        </div>
                    `).join('');
                } else {
                    grid.innerHTML = '<div class="data-status">No current data</div>';
                }
            } catch (error) {
                console.error('Error loading languages:', error);
                document.getElementById('languageGrid').innerHTML = '<div class="data-status">No current data</div>';
            }
        }

        function selectPersonality(id) {
            onboardingData.personality = id;
            document.querySelectorAll('#personalityGrid .selection-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.selection-card').classList.add('selected');
            
            fetch(ENDPOINTS.setPersonality, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ personalityId: id })
            }).catch(err => console.error('Error setting personality:', err));
        }

        function selectLanguage(code) {
            onboardingData.language = code;
            document.querySelectorAll('#languageGrid .selection-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.selection-card').classList.add('selected');
            
            fetch(ENDPOINTS.setLanguage, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ language: code })
            }).catch(err => console.error('Error setting language:', err));
        }

        // Phase 2: Validate and Save Profile
        function validateAndNext(phase) {
            if (phase === 2) {
                if (validateProfile()) {
                    saveProfile();
                    nextPhase();
                }
            }
        }

        function validateProfile() {
            let valid = true;

            const name = document.getElementById('name');
            if (!name.value.trim()) {
                document.getElementById('nameError').classList.add('show');
                name.classList.add('error');
                valid = false;
            } else {
                document.getElementById('nameError').classList.remove('show');
                name.classList.remove('error');
            }

            const email = document.getElementById('email');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email.value)) {
                document.getElementById('emailError').classList.add('show');
                email.classList.add('error');
                valid = false;
            } else {
                document.getElementById('emailError').classList.remove('show');
                email.classList.remove('error');
            }

            const timezone = document.getElementById('timezone');
            if (!timezone.value) {
                document.getElementById('timezoneError').classList.add('show');
                timezone.classList.add('error');
                valid = false;
            } else {
                document.getElementById('timezoneError').classList.remove('show');
                timezone.classList.remove('error');
            }

            return valid;
        }

        async function saveProfile() {
            const profileData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                timezone: document.getElementById('timezone').value,
                dateOfBirth: document.getElementById('dateOfBirth').value,
                gender: document.getElementById('gender').value,
                height: document.getElementById('height').value,
                weight: document.getElementById('weight').value
            };

            onboardingData.profile = profileData;

            try {
                await fetch(ENDPOINTS.createProfile, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(profileData)
                });

                await fetch(ENDPOINTS.updateSettings, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ timezone: profileData.timezone })
                });
            } catch (error) {
                console.error('Error saving profile:', error);
            }
        }

        // Phase 3: Load and Connect Devices
        async function loadDevices() {
            const devices = [
                { id: 'oura', name: 'Oura Ring', icon: 'ðŸ’', endpoint: ENDPOINTS.ouraAuth },
                { id: 'whoop', name: 'Whoop', icon: 'âŒš', endpoint: ENDPOINTS.whoopAuth },
                { id: 'fitbit', name: 'Fitbit', icon: 'ðŸ“±', endpoint: ENDPOINTS.fitbitAuth },
                { id: 'garmin', name: 'Garmin', icon: 'ðŸƒ', endpoint: ENDPOINTS.garminAuth },
                { id: 'apple', name: 'Apple Health', icon: 'ðŸŽ', endpoint: ENDPOINTS.appleHealthAuth },
                { id: 'polar', name: 'Polar', icon: 'ðŸ»â€â„ï¸', endpoint: ENDPOINTS.polarAuth }
            ];

            const grid = document.getElementById('deviceGrid');
            grid.innerHTML = devices.map(d => `
                <div class="device-card" onclick="connectDevice('${d.id}', '${d.endpoint}')">
                    <div class="device-logo">${d.icon}</div>
                    <div class="device-name">${d.name}</div>
                    <div class="device-status">Not connected</div>
                </div>
            `).join('');
        }

        async function connectDevice(deviceId, endpoint) {
            try {
                const response = await fetch(endpoint, { method: 'POST' });
                if (!response.ok) throw new Error('Failed to connect device');
                const data = await response.json();
                
                if (data.authUrl) {
                    window.open(data.authUrl, '_blank');
                }
                
                onboardingData.devices.push(deviceId);
                event.target.closest('.device-card').classList.add('connected');
            } catch (error) {
                console.error(`Error connecting ${deviceId}:`, error);
            }
        }

        // Phase 4: Load Goal Templates and Save Goals
        async function loadGoalTemplates() {
            try {
                const response = await fetch(ENDPOINTS.getGoalTemplates);
                if (!response.ok) throw new Error('Failed to load templates');
                const data = await response.json();
                
                const grid = document.getElementById('goalTemplates');
                if (data && data.length > 0) {
                    grid.innerHTML = data.map(t => `
                        <div class="selection-card" onclick="selectGoalTemplate('${t.id}')">
                            <div class="selection-card-icon">${t.icon}</div>
                            <div class="selection-card-title">${t.name}</div>
                            <div class="selection-card-description">${t.description}</div>
                        </div>
                    `).join('');
                } else {
                    grid.innerHTML = '<div class="data-status">No current data</div>';
                }
            } catch (error) {
                console.error('Error loading goal templates:', error);
                document.getElementById('goalTemplates').innerHTML = '<div class="data-status">No current data</div>';
            }
        }

        function selectGoalTemplate(templateId) {
            document.querySelectorAll('#goalTemplates .selection-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.selection-card').classList.add('selected');
        }

        async function saveGoals() {
            const selectedTemplate = document.querySelector('#goalTemplates .selection-card.selected');
            if (selectedTemplate) {
                try {
                    await fetch(ENDPOINTS.createGoal, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ templateId: selectedTemplate.dataset.id })
                    });
                } catch (error) {
                    console.error('Error creating goal:', error);
                }
            }

            const nutritionData = {
                calories: document.getElementById('calories').value,
                protein: document.getElementById('protein').value,
                carbs: document.getElementById('carbs').value,
                fats: document.getElementById('fats').value
            };

            onboardingData.nutritionTargets = nutritionData;

            try {
                await fetch(ENDPOINTS.setNutritionTargets, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(nutritionData)
                });
            } catch (error) {
                console.error('Error saving nutrition targets:', error);
            }

            nextPhase();
        }

        // Phase 5: Connect Calendar
        async function connectCalendar(provider) {
            const endpoint = provider === 'google' ? ENDPOINTS.connectGoogle : ENDPOINTS.connectOutlook;
            try {
                const response = await fetch(endpoint);
                if (!response.ok) throw new Error('Failed to connect calendar');
                const data = await response.json();
                
                if (data.authUrl) {
                    window.open(data.authUrl, '_blank');
                }
                
                onboardingData.calendar = provider;
            } catch (error) {
                console.error('Error connecting calendar:', error);
            }
        }

        // Phase 6: Connect Plaid
        async function connectPlaid() {
            try {
                const response = await fetch(ENDPOINTS.plaidLinkToken, { method: 'POST' });
                if (!response.ok) throw new Error('Failed to get Plaid token');
                const data = await response.json();
                
                if (data.linkToken) {
                    // Initialize Plaid Link (requires Plaid SDK)
                    console.log('Plaid Link Token:', data.linkToken);
                    alert('Plaid integration would open here');
                }
            } catch (error) {
                console.error('Error connecting Plaid:', error);
            }
        }

        // Phase 7: Select Plan and Start Trial
        function selectPlan(planId) {
            document.querySelectorAll('.plan-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.plan-card').classList.add('selected');
            onboardingData.subscription = planId;
        }

        async function startTrial() {
            try {
                await fetch(ENDPOINTS.createCheckout, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ plan: 'trial' })
                });
                nextPhase();
            } catch (error) {
                console.error('Error starting trial:', error);
            }
        }

        // Phase 8: Complete and Launch
        async function launchApp() {
            document.getElementById('launchButton').style.display = 'none';
            document.getElementById('finalLoading').classList.add('show');

            try {
                await fetch(ENDPOINTS.completeOnboarding, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ...onboardingData,
                        completedAt: new Date().toISOString()
                    })
                });

                setTimeout(() => {
                    window.location.href = '/index.html';
                }, 2000);
            } catch (error) {
                console.error('Error completing onboarding:', error);
                document.getElementById('finalLoading').classList.remove('show');
                document.getElementById('launchButton').style.display = 'flex';
            }
        }
    </script>
</body>
</html>
