<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phoenix - Onboarding</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            background: #000;
            color: #00ffff;
            overflow: hidden;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 255, 0.95);
            color: #000;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 255, 255, 0.4);
            z-index: 10000;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        .toast.show { display: block; }
        .toast.success { background: rgba(0, 255, 0, 0.95); }
        .toast.error { background: rgba(255, 0, 0, 0.95); color: #fff; }
        .toast.info { background: rgba(0, 150, 255, 0.95); color: #fff; }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Phase Container */
        .phase-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.5s ease;
            background: radial-gradient(circle at center, rgba(0, 15, 30, 1) 0%, rgba(0, 0, 0, 1) 100%);
        }

        .phase-container.active {
            display: flex;
            opacity: 1;
        }

        .phase-content {
            text-align: center;
            max-width: 600px;
            padding: 40px;
        }

        .content-title {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
        }

        .content-subtitle {
            font-size: 20px;
            color: rgba(0, 255, 255, 0.8);
            margin-bottom: 30px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            color: rgba(0, 255, 255, 0.9);
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 255, 255, 0.05);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            color: #00ffff;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        /* Button Styles */
        .btn {
            padding: 15px 40px;
            background: rgba(0, 255, 255, 0.2);
            border: 2px solid #00ffff;
            color: #00ffff;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn:hover {
            background: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #00ffff;
            color: #000;
        }

        .btn-primary:hover {
            background: #00dddd;
        }

        .btn-skip {
            background: transparent;
            border-color: rgba(0, 255, 255, 0.3);
            margin-left: 15px;
        }

        /* Device Grid */
        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .device-card {
            background: rgba(0, 255, 255, 0.05);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .device-card:hover {
            background: rgba(0, 255, 255, 0.1);
            border-color: #00ffff;
            transform: translateY(-5px);
        }

        .device-card.connected {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }

        .device-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .device-name {
            font-size: 14px;
            color: #00ffff;
        }

        .device-status {
            font-size: 12px;
            color: rgba(0, 255, 255, 0.6);
            margin-top: 8px;
        }

        .device-status.connected {
            color: #00ff00;
        }

        /* Progress Bar */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(0, 255, 255, 0.2);
            z-index: 9999;
        }

        .progress-fill {
            height: 100%;
            background: #00ffff;
            transition: width 0.5s ease;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
        }

        /* Language/Voice Grid */
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .selection-card {
            background: rgba(0, 255, 255, 0.05);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .selection-card:hover {
            background: rgba(0, 255, 255, 0.1);
            border-color: #00ffff;
        }

        .selection-card.selected {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Phase 0: Welcome -->
    <div id="phase-0" class="phase-container active">
        <div class="phase-content">
            <div class="content-title">WELCOME TO PHOENIX</div>
            <div class="content-subtitle">Your AI-Powered Life Operating System</div>
            <button class="btn btn-primary" onclick="nextPhase()" style="margin-top: 40px;">
                BEGIN SETUP
            </button>
        </div>
    </div>

    <!-- Phase 1: Voice & Language -->
    <div id="phase-1" class="phase-container">
        <div class="phase-content">
            <div class="content-title">CHOOSE YOUR LANGUAGE</div>
            <div class="selection-grid" id="languageGrid"></div>
            
            <div class="content-subtitle" style="margin-top: 40px;">SELECT YOUR VOICE</div>
            <div class="selection-grid" id="voiceGrid"></div>
            
            <button class="btn btn-primary" id="phase1Continue" disabled onclick="nextPhase()" style="margin-top: 40px;">
                CONTINUE
            </button>
        </div>
    </div>

    <!-- Phase 2: Account Creation -->
    <div id="phase-2" class="phase-container">
        <div class="phase-content">
            <div class="content-title">CREATE YOUR ACCOUNT</div>
            <div class="content-subtitle">Let's get you set up</div>
            
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="signupName" placeholder="John Doe">
            </div>
            
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="signupEmail" placeholder="you@example.com">
            </div>
            
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            
            <button class="btn btn-primary" onclick="createAccount()" style="margin-top: 20px;">
                CREATE ACCOUNT
            </button>
        </div>
    </div>

    <!-- Phase 3: Verification Code -->
    <div id="phase-3" class="phase-container">
        <div class="phase-content">
            <div class="content-title">VERIFY YOUR EMAIL</div>
            <div class="content-subtitle">Enter the code sent to <span id="userEmail"></span></div>
            
            <div class="form-group">
                <input type="text" id="verificationCode" placeholder="000000" maxlength="6" style="text-align: center; font-size: 32px; letter-spacing: 10px;">
            </div>
            
            <button class="btn btn-primary" onclick="verifyCode()" style="margin-top: 20px;">
                VERIFY
            </button>
            <button class="btn btn-skip" onclick="resendCode()">
                RESEND CODE
            </button>
        </div>
    </div>

    <!-- Phase 4: Connect Devices -->
    <div id="phase-4" class="phase-container">
        <div class="phase-content" style="max-width: 700px;">
            <div class="content-title">CONNECT YOUR DEVICES</div>
            <div class="content-subtitle">Sync your health data automatically</div>
            
            <div class="device-grid" id="deviceGrid"></div>
            
            <button class="btn btn-primary" onclick="nextPhase()" style="margin-top: 30px;">
                CONTINUE
            </button>
            <button class="btn btn-skip" onclick="nextPhase()">
                SKIP FOR NOW
            </button>
        </div>
    </div>

    <!-- Phase 5: Goals & Nutrition -->
    <div id="phase-5" class="phase-container">
        <div class="phase-content">
            <div class="content-title">SET YOUR GOALS</div>
            <div class="content-subtitle">What do you want to achieve?</div>
            
            <div class="form-group">
                <label>Primary Goal</label>
                <input type="text" id="primaryGoal" placeholder="e.g., Lose 20 lbs, Run a marathon">
            </div>
            
            <div class="form-group">
                <label>Target Weight (lbs)</label>
                <input type="number" id="targetWeight" placeholder="180">
            </div>
            
            <button class="btn btn-primary" onclick="nextPhase()" style="margin-top: 20px;">
                CONTINUE
            </button>
            <button class="btn btn-skip" onclick="nextPhase()">
                SKIP FOR NOW
            </button>
        </div>
    </div>

    <!-- Phase 6: Calendar -->
    <div id="phase-6" class="phase-container">
        <div class="phase-content">
            <div class="content-title">CONNECT YOUR CALENDAR</div>
            <div class="content-subtitle">Let Phoenix optimize your schedule</div>
            
            <button class="btn btn-primary" onclick="connectGoogle()" style="margin: 20px 10px;">
                üìÖ CONNECT GOOGLE CALENDAR
            </button>
            <button class="btn btn-primary" onclick="connectOutlook()" style="margin: 20px 10px;">
                üìÖ CONNECT OUTLOOK
            </button>
            
            <br><button class="btn btn-skip" onclick="nextPhase()" style="margin-top: 20px;">
                SKIP FOR NOW
            </button>
        </div>
    </div>

    <!-- Phase 7: Finance -->
    <div id="phase-7" class="phase-container">
        <div class="phase-content">
            <div class="content-title">CONNECT YOUR BANK</div>
            <div class="content-subtitle">Track spending and financial health</div>
            
            <button class="btn btn-primary" onclick="connectPlaid()" style="margin-top: 20px;">
                üè¶ CONNECT BANK ACCOUNT
            </button>
            
            <br><button class="btn btn-skip" onclick="nextPhase()" style="margin-top: 30px;">
                SKIP FOR NOW
            </button>
        </div>
    </div>

    <!-- Phase 8: Subscription -->
    <div id="phase-8" class="phase-container">
        <div class="phase-content">
            <div class="content-title">START YOUR FREE TRIAL</div>
            <div class="content-subtitle">7 days free, then $29/month</div>
            
            <div style="margin: 30px 0; font-size: 18px; line-height: 1.8;">
                ‚úì Unlimited AI conversations<br>
                ‚úì All planetary systems<br>
                ‚úì Autonomous butler<br>
                ‚úì Real-time insights<br>
                ‚úì Device integrations
            </div>
            
            <button class="btn btn-primary" onclick="startTrial()" style="margin-top: 20px;">
                START FREE TRIAL
            </button>
            <button class="btn btn-skip" onclick="goToDashboard()">
                SKIP TRIAL
            </button>
        </div>
    </div>

    <script>
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:5000/api' 
            : 'https://pal-backend-production.up.railway.app/api';

        let currentPhase = 0;
        let userData = {
            language: 'en',
            voice: null,
            name: '',
            email: '',
            password: '',
            token: null
        };

        const LANGUAGES = [
            { code: 'en', name: 'English', flag: 'üá∫üá∏' },
            { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏' },
            { code: 'fr', name: 'Fran√ßais', flag: 'üá´üá∑' },
            { code: 'de', name: 'Deutsch', flag: 'üá©üá™' },
            { code: 'it', name: 'Italiano', flag: 'üáÆüáπ' },
            { code: 'pt', name: 'Portugu√™s', flag: 'üáµüáπ' }
        ];

        const VOICES = [
            { id: 'alloy', name: 'Alloy' },
            { id: 'echo', name: 'Echo' },
            { id: 'fable', name: 'Fable' },
            { id: 'onyx', name: 'Onyx' },
            { id: 'nova', name: 'Nova' },
            { id: 'shimmer', name: 'Shimmer' }
        ];

        const DEVICES = [
            { id: 'fitbit', name: 'Fitbit', icon: '‚åö' },
            { id: 'polar', name: 'Polar', icon: 'üèÉ' },
            { id: 'apple', name: 'Apple Health', icon: '‚ù§Ô∏è', disabled: true },
            { id: 'whoop', name: 'WHOOP', icon: 'üí™', disabled: true }
        ];

        // Initialize
        (function init() {
            renderLanguages();
            renderVoices();
            renderDevices();
            updateProgress();
        })();

        function renderLanguages() {
            const grid = document.getElementById('languageGrid');
            grid.innerHTML = LANGUAGES.map(lang => `
                <div class="selection-card ${lang.code === 'en' ? 'selected' : ''}" onclick="selectLanguage('${lang.code}')">
                    <div style="font-size: 32px;">${lang.flag}</div>
                    <div style="margin-top: 8px; font-size: 12px;">${lang.name}</div>
                </div>
            `).join('');
        }

        function renderVoices() {
            const grid = document.getElementById('voiceGrid');
            grid.innerHTML = VOICES.map(voice => `
                <div class="selection-card" onclick="selectVoice('${voice.id}')">
                    <div style="font-size: 16px;">${voice.name}</div>
                </div>
            `).join('');
        }

        function renderDevices() {
            const grid = document.getElementById('deviceGrid');
            grid.innerHTML = DEVICES.map(device => `
                <div class="device-card ${device.disabled ? 'disabled' : ''}" onclick="${device.disabled ? '' : `connectDevice('${device.id}')`}">
                    <div class="device-icon">${device.icon}</div>
                    <div class="device-name">${device.name}</div>
                    <div class="device-status">${device.disabled ? 'Coming Soon' : 'Tap to connect'}</div>
                </div>
            `).join('');
        }

        function selectLanguage(code) {
            userData.language = code;
            document.querySelectorAll('#languageGrid .selection-card').forEach(el => el.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            checkPhase1Complete();
        }

        function selectVoice(id) {
            userData.voice = id;
            document.querySelectorAll('#voiceGrid .selection-card').forEach(el => el.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            checkPhase1Complete();
        }

        function checkPhase1Complete() {
            const btn = document.getElementById('phase1Continue');
            btn.disabled = !(userData.language && userData.voice);
        }

        async function createAccount() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            if (!name || !email || !password) {
                showToast('Please fill in all fields', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password, language: userData.language, voice: userData.voice })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Registration failed');
                }

                userData.name = name;
                userData.email = email;
                userData.token = data.token;
                localStorage.setItem('phoenixToken', data.token);

                document.getElementById('userEmail').textContent = email;
                showToast('Account created! Check your email for verification code', 'success');
                nextPhase();
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        async function verifyCode() {
            const code = document.getElementById('verificationCode').value;

            if (!code || code.length !== 6) {
                showToast('Please enter 6-digit code', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/verify`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userData.token}`
                    },
                    body: JSON.stringify({ code })
                });

                if (!response.ok) {
                    throw new Error('Invalid code');
                }

                showToast('Email verified!', 'success');
                nextPhase();
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        async function resendCode() {
            try {
                await fetch(`${API_BASE}/auth/resend-code`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userData.token}`
                    }
                });
                showToast('Code resent to your email', 'success');
            } catch (error) {
                showToast('Failed to resend code', 'error');
            }
        }

        async function connectDevice(deviceId) {
            if (!userData.token) {
                showToast('Please create account first', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/mercury/devices/${deviceId}/connect`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userData.token}`
                    }
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Connection failed');
                }

                // Redirect to OAuth
                window.location.href = data.authUrl;
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        function connectGoogle() {
            showToast('Google Calendar integration coming soon', 'info');
        }

        function connectOutlook() {
            showToast('Outlook integration coming soon', 'info');
        }

        function connectPlaid() {
            showToast('Bank integration coming soon', 'info');
        }

        function startTrial() {
            showToast('Starting free trial...', 'success');
            setTimeout(goToDashboard, 1500);
        }

        function goToDashboard() {
            localStorage.setItem('phoenixOnboardingComplete', 'true');
            window.location.href = '/index.html';
        }

        function nextPhase() {
            document.getElementById(`phase-${currentPhase}`).classList.remove('active');
            currentPhase++;
            document.getElementById(`phase-${currentPhase}`).classList.add('active');
            updateProgress();
        }

        function updateProgress() {
            const progress = (currentPhase / 8) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
