<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Phoenix - The 30-Second Miracle</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* ============================================
           PHOENIX CINEMATIC ONBOARDING
           The 30-Second Miracle - Jobs/Einstein Simplicity
           Show Magic First, Ask Questions Later
           ============================================ */

        :root {
            --cyan: #00D9FF;
            --cyan-glow: rgba(0, 217, 255, 0.8);
            --cyan-dim: rgba(0, 217, 255, 0.4);
            --cyan-bg: rgba(0, 217, 255, 0.1);

            --gold: #FFD700;
            --gold-glow: rgba(255, 215, 0, 0.8);

            --green: #00FF88;

            --bg-dark: #000;
            --bg-panel: rgba(0, 10, 20, 0.95);

            --font: 'SF Mono', 'Monaco', 'Courier New', monospace;

            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font);
            background: var(--bg-dark);
            color: var(--cyan);
            overflow-x: hidden;
            min-height: 100vh;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Starfield Background */
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 10;
            max-width: 600px;
            width: 100%;
            padding: 40px 20px;
            text-align: center;
        }

        /* Phase System - Only show active phase */
        .phase {
            display: none;
            opacity: 0;
            animation: fadeIn 0.8s ease-out forwards;
        }

        .phase.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Phoenix Orb */
        .phoenix-orb {
            width: 150px;
            height: 150px;
            margin: 0 auto 40px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--cyan-bg), transparent);
            border: 3px solid var(--cyan-dim);
            box-shadow: 0 0 40px var(--cyan-glow), inset 0 0 30px var(--cyan-dim);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .phoenix-orb::before {
            content: '';
            position: absolute;
            width: 60%;
            height: 60%;
            border-radius: 50%;
            background: radial-gradient(circle, var(--cyan-glow), transparent);
            animation: orbPulse 2s ease-in-out infinite;
        }

        /* Orb States */
        .phoenix-orb.listening {
            border-color: var(--cyan);
            box-shadow: 0 0 60px var(--cyan-glow), inset 0 0 40px var(--cyan-dim);
            animation: orbListening 1.5s ease-in-out infinite;
        }

        .phoenix-orb.processing {
            border-color: var(--gold);
            box-shadow: 0 0 60px var(--gold-glow);
            animation: orbSpin 2s linear infinite;
        }

        .phoenix-orb.speaking {
            animation: orbSpeak 0.8s ease-in-out infinite;
        }

        @keyframes orbPulse {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        @keyframes orbListening {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes orbSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes orbSpeak {
            0%, 100% { transform: scale(1); box-shadow: 0 0 40px var(--cyan-glow); }
            50% { transform: scale(1.08); box-shadow: 0 0 60px var(--cyan-glow); }
        }

        /* DNA Helix Animation (for building) */
        .dna-helix {
            display: none;
            width: 100px;
            height: 100px;
            margin: 20px auto;
            position: relative;
        }

        .dna-helix.active {
            display: block;
        }

        .dna-strand {
            position: absolute;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--cyan), var(--gold));
            border-radius: 2px;
            animation: dnaRotate 2s linear infinite;
        }

        .dna-strand:nth-child(1) { left: 20px; }
        .dna-strand:nth-child(2) { right: 20px; animation-delay: -1s; }

        @keyframes dnaRotate {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }

        /* Typography */
        .title {
            font-size: 48px;
            font-weight: 700;
            color: var(--cyan);
            text-shadow: 0 0 30px var(--cyan-glow);
            margin-bottom: 20px;
            letter-spacing: 4px;
        }

        .message {
            font-size: 18px;
            line-height: 1.6;
            color: var(--cyan);
            margin: 30px 0;
            opacity: 0.9;
        }

        .message.large {
            font-size: 22px;
            font-weight: 500;
        }

        .status {
            font-size: 14px;
            color: var(--cyan-dim);
            margin: 20px 0;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* Input Fields */
        .input-container {
            margin: 30px 0;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"] {
            width: 100%;
            padding: 15px 20px;
            background: var(--bg-panel);
            border: 2px solid var(--cyan-dim);
            border-radius: 12px;
            color: var(--cyan);
            font-family: var(--font);
            font-size: 16px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: var(--cyan);
            box-shadow: 0 0 20px var(--cyan-glow);
        }

        input::placeholder {
            color: var(--cyan-dim);
        }

        /* Buttons */
        .btn {
            padding: 15px 40px;
            background: var(--cyan-bg);
            border: 2px solid var(--cyan);
            border-radius: 12px;
            color: var(--cyan);
            font-family: var(--font);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn:hover {
            background: var(--cyan-dim);
            box-shadow: 0 0 30px var(--cyan-glow);
            transform: translateY(-2px);
        }

        .btn-primary {
            background: var(--cyan);
            color: #000;
        }

        .btn-primary:hover {
            background: var(--cyan-glow);
            box-shadow: 0 0 40px var(--cyan-glow);
        }

        .btn-secondary {
            background: transparent;
            border-color: var(--cyan-dim);
            color: var(--cyan-dim);
        }

        .btn-secondary:hover {
            border-color: var(--cyan);
            color: var(--cyan);
        }

        /* Icon Dock (Demo) */
        .demo-dock {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            align-items: center;
            gap: 15px;
            padding: 15px 25px;
            background: var(--bg-panel);
            border: 2px solid var(--gold);
            border-radius: 25px;
            box-shadow: 0 8px 40px rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(20px);
            z-index: 1000;
        }

        .demo-dock.active {
            display: flex;
            animation: dockSlideUp 0.5s ease-out;
        }

        @keyframes dockSlideUp {
            from { transform: translateX(-50%) translateY(100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        .dock-icon {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 70px;
            padding: 12px;
            background: rgba(0, 217, 255, 0.05);
            border: 2px solid rgba(0, 217, 255, 0.3);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dock-icon:hover {
            background: rgba(0, 217, 255, 0.15);
            border-color: var(--cyan);
            transform: translateY(-5px);
        }

        .dock-icon i {
            font-size: 32px;
            color: var(--cyan);
            margin-bottom: 8px;
        }

        .dock-icon .label {
            font-size: 10px;
            color: var(--cyan);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .ready-arrow {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold);
            color: #000;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            opacity: 0;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5);
        }

        .ready-arrow.blink {
            animation: arrowBlink 1s ease-in-out infinite;
        }

        .ready-arrow::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid var(--gold);
        }

        @keyframes arrowBlink {
            0%, 100% { opacity: 1; transform: translateX(-50%) translateY(0); }
            50% { opacity: 0.4; transform: translateX(-50%) translateY(-5px); }
        }

        /* Demo Widget */
        .demo-widget {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 450px;
            max-width: 90vw;
            height: 350px;
            background: var(--bg-panel);
            border: 2px solid var(--cyan);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 217, 255, 0.4);
            backdrop-filter: blur(30px);
            display: none;
            flex-direction: column;
            z-index: 2000;
            opacity: 0;
        }

        .demo-widget.active {
            display: flex;
            animation: widgetPopIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }

        @keyframes widgetPopIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.3); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .widget-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--cyan-dim);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .widget-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--cyan);
        }

        .widget-controls {
            display: flex;
            gap: 10px;
        }

        .widget-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
        }

        .widget-btn.minimize { background: var(--gold); }
        .widget-btn.close { background: #ff4444; }

        .widget-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .widget-content iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 12px;
        }

        /* Voice Button */
        .voice-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--cyan-bg);
            border: 3px solid var(--cyan);
            color: var(--cyan);
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .voice-btn:hover {
            background: var(--cyan-dim);
            box-shadow: 0 0 30px var(--cyan-glow);
            transform: scale(1.1);
        }

        .voice-btn.listening {
            animation: voicePulse 1s ease-in-out infinite;
        }

        @keyframes voicePulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 20px var(--cyan-glow); }
            50% { transform: scale(1.15); box-shadow: 0 0 40px var(--cyan-glow); }
        }

        /* Options Container */
        .options {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .title { font-size: 36px; }
            .message { font-size: 16px; }
            .message.large { font-size: 18px; }
            .phoenix-orb { width: 120px; height: 120px; }
            .demo-widget { width: 95vw; height: 400px; }
        }

        /* Hide scrollbar */
        body::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Starfield Background -->
    <canvas id="starfield"></canvas>

    <!-- Main Container -->
    <div class="container">

        <!-- PHASE 1: INTRO (3 seconds) -->
        <div id="phase-intro" class="phase active">
            <div class="phoenix-orb" id="orb"></div>
            <div class="title">PHOENIX</div>
            <div class="subtitle" style="margin-top: 20px; font-size: 14px; color: rgba(0, 217, 255, 0.6); letter-spacing: 1px;">
                DEMONSTRATION MODE
            </div>
            <button class="btn btn-primary" id="startBtn" onclick="beginDemo()" style="margin-top: 40px; padding: 18px 50px; font-size: 18px;">
                START ‚Üí
            </button>
        </div>

        <!-- PHASE 2: HOOK (10 seconds) -->
        <div id="phase-hook" class="phase">
            <div class="phoenix-orb listening" id="orb-hook"></div>
            <div class="message large">
                I'm Phoenix. I can create anything you describe.<br>
                Try me. Tell me something you want.
            </div>
            <div class="input-container">
                <input type="text" id="createInput" placeholder="Create me a..." />
            </div>
            <div class="voice-btn" id="voiceBtn">
                <i class="fa-solid fa-microphone"></i>
            </div>
            <div class="status">Type or speak anything</div>
        </div>

        <!-- PHASE 3: MIRACLE (15 seconds) -->
        <div id="phase-miracle" class="phase">
            <div class="phoenix-orb processing" id="orb-miracle"></div>
            <div class="dna-helix active">
                <div class="dna-strand"></div>
                <div class="dna-strand"></div>
            </div>
            <div class="status" id="buildStatus">Creating your music player...</div>
        </div>

        <!-- PHASE 4: REALIZATION (10 seconds) -->
        <div id="phase-realization" class="phase">
            <div class="phoenix-orb" id="orb-realization"></div>
            <div class="message">
                I can create anything.<br>
                Spotify. YouTube. Gmail. Weather.<br>
                Or anything custom you describe.<br><br>
                I learn from everything you do.<br>
                I'll track your health, workouts, goals.<br>
                I'll plan your day, manage your life.<br><br>
                I'm your companion. For life.<br><br>
                What's your name?
            </div>
        </div>

        <!-- PHASE 5: NAME (20 seconds) -->
        <div id="phase-name" class="phase">
            <div class="phoenix-orb speaking" id="orb-name"></div>
            <div class="message">What's your name?</div>
            <div class="input-container">
                <input type="text" id="nameInput" placeholder="Your name..." autofocus />
            </div>
            <button class="btn btn-primary" onclick="submitName()">NEXT</button>
        </div>

        <!-- PHASE 6: ACCOUNT CHOICE (30 seconds) -->
        <div id="phase-account-choice" class="phase">
            <div class="phoenix-orb" id="orb-choice"></div>
            <div class="message" id="greetingMessage">
                Hello, <span id="userName"></span>.<br><br>
                I'm going to learn everything about you.<br>
                The more I know, the better I serve.<br><br>
                Create an account and I'll remember everything.<br>
                Or start now and explore.
            </div>
            <div class="options">
                <button class="btn btn-primary" onclick="showAccountForm()">CREATE ACCOUNT</button>
                <button class="btn btn-secondary" onclick="skipToApp()">START NOW ‚Üí</button>
            </div>
        </div>

        <!-- PHASE 7: ACCOUNT FORM (optional) -->
        <div id="phase-account-form" class="phase">
            <div class="phoenix-orb" id="orb-account"></div>
            <div class="message">Just your email or phone.<br>That's all I need.</div>
            <div class="input-container">
                <input type="email" id="emailInput" placeholder="Email or phone..." />
                <input type="password" id="passwordInput" placeholder="Password..." />
            </div>
            <button class="btn btn-primary" onclick="createAccount()">CREATE ACCOUNT</button>
            <button class="btn btn-secondary" onclick="skipToApp()">SKIP ‚Üí</button>
            <div class="status" id="accountStatus"></div>
        </div>

        <!-- PHASE 8: SUCCESS -->
        <div id="phase-success" class="phase">
            <div class="phoenix-orb speaking" id="orb-success"></div>
            <div class="message large">
                Perfect. I'll never forget you.<br><br>
                <span id="successMessage">Launching Phoenix...</span>
            </div>
        </div>

    </div>

    <!-- Demo Dock (appears in Phase 3) -->
    <div class="demo-dock" id="demoDock">
        <div class="dock-icon" id="dockIcon" onclick="openDemoWidget()">
            <div class="ready-arrow" id="readyArrow">‚Üê Ready!</div>
            <i class="fa-solid fa-music"></i>
            <div class="label">Music</div>
        </div>
    </div>

    <!-- Demo Widget (appears when icon clicked) -->
    <div class="demo-widget" id="demoWidget">
        <div class="widget-header">
            <div class="widget-title">Music Player</div>
            <div class="widget-controls">
                <div class="widget-btn minimize" onclick="closeDemoWidget()"></div>
                <div class="widget-btn close" onclick="closeDemoWidget()"></div>
            </div>
        </div>
        <div class="widget-content">
            <iframe src="https://open.spotify.com/embed/playlist/37i9dQZF1DXcBWIGoYBM5M" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
        </div>
    </div>

    <script>
        console.log('üöÄ Phoenix Cinematic Onboarding - The 30-Second Miracle');

        // ============================================
        // CONFIGURATION
        // ============================================
        const API_BASE_URL = 'https://pal-backend-production.up.railway.app/api';

        let userData = {
            name: '',
            email: '',
            password: '',
            skipAccount: true,
            authToken: null
        };

        let currentPhase = 0;
        let ttsAudio = null;

        // ============================================
        // WIDGET TYPE DETECTION
        // ============================================
        function detectWidgetFromInput(userInput) {
            const input = userInput.toLowerCase().trim();

            // Business / Finance
            if (input.includes('business') || input.includes('company') || input.includes('startup') || input.includes('plan')) {
                return {
                    type: 'business',
                    icon: 'fa-solid fa-briefcase',
                    title: 'Business Plan',
                    description: 'your business plan',
                    content: createBusinessPlanWidget()
                };
            }

            // Music
            if (input.includes('music') || input.includes('spotify') || input.includes('song') || input.includes('playlist')) {
                return {
                    type: 'music',
                    icon: 'fa-solid fa-music',
                    title: 'Music Player',
                    description: 'your music player',
                    content: '<iframe src="https://www.youtube.com/embed/videoseries?list=PLFgquLnL59alCl_2TQvOiD5Vgm1hCaGSI" width="100%" height="100%" frameborder="0" allow="autoplay" allowfullscreen></iframe>'
                };
            }

            // Video / YouTube
            if (input.includes('video') || input.includes('youtube') || input.includes('watch') || input.includes('movie')) {
                return {
                    type: 'video',
                    icon: 'fa-solid fa-video',
                    title: 'Video Player',
                    description: 'your video player',
                    content: '<iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" width="100%" height="100%" frameborder="0" allow="autoplay" allowfullscreen></iframe>'
                };
            }

            // Weather
            if (input.includes('weather') || input.includes('forecast') || input.includes('temperature')) {
                return {
                    type: 'weather',
                    icon: 'fa-solid fa-cloud-sun',
                    title: 'Weather',
                    description: 'your weather dashboard',
                    content: createWeatherWidget()
                };
            }

            // Maps
            if (input.includes('map') || input.includes('location') || input.includes('navigate') || input.includes('directions')) {
                return {
                    type: 'map',
                    icon: 'fa-solid fa-map-location-dot',
                    title: 'Maps',
                    description: 'your map',
                    content: '<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d387190.279909073!2d-74.25986568241216!3d40.697663747405195!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c24fa5d33f083b%3A0xc80b8f06e177fe62!2sNew%20York%2C%20NY!5e0!3m2!1sen!2sus!4v1639000000000!5m2!1sen!2sus" width="100%" height="100%" frameborder="0" allowfullscreen></iframe>'
                };
            }

            // Default to music player
            return {
                type: 'music',
                icon: 'fa-solid fa-music',
                title: 'Music Player',
                description: 'your music player',
                content: '<iframe src="https://www.youtube.com/embed/videoseries?list=PLFgquLnL59alCl_2TQvOiD5Vgm1hCaGSI" width="100%" height="100%" frameborder="0" allow="autoplay" allowfullscreen></iframe>'
            };
        }

        function createBusinessPlanWidget() {
            return `
                <div style="padding: 30px; color: rgba(0, 217, 255, 0.9); font-family: monospace; line-height: 1.8; height: 100%; overflow-y: auto;">
                    <h2 style="color: #FFD700; margin-bottom: 20px;">üìä MILLION DOLLAR BUSINESS PLAN</h2>
                    <div style="margin-bottom: 20px;">
                        <strong style="color: #00ff88;">Executive Summary:</strong><br>
                        Revolutionary AI-powered personal assistant platform targeting high-performance individuals.
                        Projected $1M ARR within 18 months through premium subscriptions and enterprise contracts.
                    </div>
                    <div style="margin-bottom: 20px;">
                        <strong style="color: #00ff88;">Market Opportunity:</strong><br>
                        ‚Ä¢ Global productivity software market: $96.36B (2025)<br>
                        ‚Ä¢ AI assistant market growing at 28.5% CAGR<br>
                        ‚Ä¢ Target: 10,000 premium users @ $99/month = $11.88M annually
                    </div>
                    <div style="margin-bottom: 20px;">
                        <strong style="color: #00ff88;">Revenue Model:</strong><br>
                        ‚Ä¢ Personal Tier: $29/month<br>
                        ‚Ä¢ Premium Tier: $99/month<br>
                        ‚Ä¢ Enterprise: $499/month per seat
                    </div>
                    <div style="margin-bottom: 20px;">
                        <strong style="color: #00ff88;">Go-to-Market:</strong><br>
                        1. Beta launch with 100 power users<br>
                        2. Viral marketing through AI demo videos<br>
                        3. Partnership with fitness/productivity influencers<br>
                        4. Enterprise sales for Fortune 500 companies
                    </div>
                    <div>
                        <strong style="color: #00ff88;">12-Month Projection:</strong><br>
                        Month 3: 500 users ‚Ä¢ $14,500 MRR<br>
                        Month 6: 2,000 users ‚Ä¢ $98,000 MRR<br>
                        Month 12: 8,400 users ‚Ä¢ $524,600 MRR<br>
                        <strong style="color: #FFD700;">‚Üí $1.26M first year run-rate</strong>
                    </div>
                </div>
            `;
        }

        function createWeatherWidget() {
            return `
                <div style="padding: 40px; text-align: center; color: rgba(0, 217, 255, 0.9); height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                    <div style="font-size: 72px; margin-bottom: 20px;">‚õÖ</div>
                    <div style="font-size: 48px; font-weight: 700; color: #FFD700; margin-bottom: 10px;">72¬∞F</div>
                    <div style="font-size: 24px; margin-bottom: 30px;">Partly Cloudy</div>
                    <div style="display: flex; gap: 30px; margin-top: 20px;">
                        <div>
                            <div style="font-size: 14px; color: rgba(0, 217, 255, 0.6);">HIGH</div>
                            <div style="font-size: 20px; font-weight: 600;">78¬∞</div>
                        </div>
                        <div>
                            <div style="font-size: 14px; color: rgba(0, 217, 255, 0.6);">LOW</div>
                            <div style="font-size: 20px; font-weight: 600;">65¬∞</div>
                        </div>
                        <div>
                            <div style="font-size: 14px; color: rgba(0, 217, 255, 0.6);">HUMIDITY</div>
                            <div style="font-size: 20px; font-weight: 600;">45%</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================
        // STARFIELD BACKGROUND
        // ============================================
        function initStarfield() {
            const canvas = document.getElementById('starfield');
            const ctx = canvas.getContext('2d');

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const stars = [];
            for (let i = 0; i < 150; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 1.5,
                    alpha: Math.random()
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                stars.forEach(star => {
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(0, 217, 255, ${star.alpha})`;
                    ctx.fill();

                    star.alpha += (Math.random() - 0.5) * 0.02;
                    star.alpha = Math.max(0.1, Math.min(0.9, star.alpha));
                });
                requestAnimationFrame(animate);
            }
            animate();
        }

        // ============================================
        // TEXT-TO-SPEECH (OpenAI)
        // ============================================
        async function speak(text) {
            try {
                const response = await fetch(`${API_BASE_URL}/tts/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        voice: 'nova',
                        speed: 1.0,
                        format: 'base64'
                    })
                });

                if (!response.ok) {
                    console.warn('TTS unavailable, continuing silently');
                    return;
                }

                const data = await response.json();

                // Convert base64 to audio
                const audioData = atob(data.audio || data.data);
                const audioArray = new Uint8Array(audioData.length);
                for (let i = 0; i < audioData.length; i++) {
                    audioArray[i] = audioData.charCodeAt(i);
                }
                const audioBlob = new Blob([audioArray], { type: 'audio/mpeg' });
                const audioUrl = URL.createObjectURL(audioBlob);

                // Play audio
                if (ttsAudio) {
                    ttsAudio.pause();
                    ttsAudio = null;
                }

                ttsAudio = new Audio(audioUrl);
                ttsAudio.volume = 0.8;

                return new Promise((resolve) => {
                    ttsAudio.onended = () => {
                        URL.revokeObjectURL(audioUrl);
                        resolve();
                    };
                    ttsAudio.onerror = () => {
                        console.warn('Audio playback error');
                        resolve();
                    };
                    ttsAudio.play().catch(() => resolve());
                });
            } catch (error) {
                console.error('TTS error:', error);
            }
        }

        // ============================================
        // PHASE NAVIGATION
        // ============================================
        function goToPhase(phaseId) {
            console.log(`üìç Moving to ${phaseId}`);

            // Hide all phases
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));

            // Show target phase
            const phase = document.getElementById(phaseId);
            if (phase) {
                phase.classList.add('active');
            }
        }

        // ============================================
        // ONBOARDING FLOW
        // ============================================

        async function startOnboarding() {
            initStarfield();

            // PHASE 1: INTRO (3 seconds)
            await speak("Hello.");
            await sleep(2000);

            // PHASE 2: HOOK (10 seconds)
            goToPhase('phase-hook');
            await speak("I'm Phoenix. I can create anything you describe. Try me. Tell me something you want.");

            // Setup input listener
            const input = document.getElementById('createInput');
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && input.value.trim()) {
                    handleCreateRequest(input.value.trim());
                }
            });

            // Setup voice button (simplified for demo)
            document.getElementById('voiceBtn').addEventListener('click', () => {
                handleCreateRequest('spotify music player');
            });
        }

        async function handleCreateRequest(userInput) {
            console.log('üéØ User requested:', userInput);

            // Detect widget type from user input
            const widget = detectWidgetFromInput(userInput);
            console.log('üì¶ Creating:', widget.type);

            // PHASE 3: MIRACLE (15 seconds)
            goToPhase('phase-miracle');

            // Update building status text dynamically
            const buildStatus = document.getElementById('buildStatus');
            buildStatus.textContent = `Creating ${widget.description}...`;

            await speak(`Creating ${widget.description}...`);

            // Building animation (2.5 seconds)
            await sleep(2500);

            // Update dock icon dynamically
            const dockIcon = document.getElementById('dockIcon');
            const dockIconElement = dockIcon.querySelector('i');
            dockIconElement.className = widget.icon;

            const dockLabel = dockIcon.querySelector('.label');
            dockLabel.textContent = widget.title;

            // Update widget title and content
            const widgetTitle = document.getElementById('demoWidget').querySelector('.widget-title');
            widgetTitle.textContent = widget.title;

            const widgetContent = document.getElementById('demoWidget').querySelector('.widget-content');
            widgetContent.innerHTML = widget.content;

            // Show dock with icon
            const dock = document.getElementById('demoDock');
            const arrow = document.getElementById('readyArrow');
            dock.classList.add('active');

            await sleep(500);

            // Blink arrow
            arrow.classList.add('blink');
            await speak("Done. Click it.");

            // Wait for user to click icon (auto-click after 5s for demo)
            setTimeout(() => {
                if (!document.getElementById('demoWidget').classList.contains('active')) {
                    openDemoWidget();
                }
            }, 5000);
        }

        function openDemoWidget() {
            document.getElementById('readyArrow').classList.remove('blink');
            document.getElementById('demoWidget').classList.add('active');

            // After 3 seconds, continue to realization
            setTimeout(async () => {
                goToPhase('phase-realization');
                await speak("I can create anything. Spotify. YouTube. Gmail. Weather. Or anything custom you describe. I learn from everything you do. I'll track your health, workouts, goals. I'll plan your day, manage your life. I'm your companion. For life. What's your name?");

                // Move to name phase
                setTimeout(() => {
                    goToPhase('phase-name');
                    document.getElementById('nameInput').focus();
                }, 3000);
            }, 3000);
        }

        function closeDemoWidget() {
            document.getElementById('demoWidget').classList.remove('active');
        }

        async function submitName() {
            const nameInput = document.getElementById('nameInput');
            const name = nameInput.value.trim();

            if (!name) {
                alert('Please enter your name');
                return;
            }

            userData.name = name;
            document.getElementById('userName').textContent = name;

            // Move to account choice
            goToPhase('phase-account-choice');
            await speak(`Hello, ${name}. I'm going to learn everything about you. The more I know, the better I serve. Create an account and I'll remember everything. Or start now and explore.`);
        }

        function showAccountForm() {
            userData.skipAccount = false;
            goToPhase('phase-account-form');
            document.getElementById('emailInput').focus();
        }

        async function createAccount() {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            const statusEl = document.getElementById('accountStatus');

            if (!email || !password) {
                statusEl.textContent = 'Email and password required';
                statusEl.style.color = '#ff4444';
                return;
            }

            userData.email = email;
            userData.password = password;
            userData.skipAccount = false;

            statusEl.textContent = 'Creating account...';
            statusEl.style.color = 'var(--cyan)';

            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: userData.name,
                        email: userData.email,
                        password: userData.password,
                        voice: 'nova',
                        language: 'en'
                    })
                });

                const data = await response.json();

                if (response.ok && data.token) {
                    userData.authToken = data.token;
                    localStorage.setItem('phoenixToken', data.token);
                    localStorage.setItem('phoenixName', userData.name);

                    goToPhase('phase-success');
                    document.getElementById('successMessage').textContent = 'Account created successfully!';
                    await speak("Perfect. I'll never forget you. Launching Phoenix...");

                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                } else {
                    statusEl.textContent = data.message || 'Account creation failed';
                    statusEl.style.color = '#ff4444';
                }
            } catch (error) {
                console.error('Registration error:', error);
                statusEl.textContent = 'Network error. Try again.';
                statusEl.style.color = '#ff4444';
            }
        }

        async function skipToApp() {
            userData.skipAccount = true;
            localStorage.setItem('phoenixName', userData.name);

            goToPhase('phase-success');
            document.getElementById('successMessage').textContent = 'Starting Phoenix...';
            await speak("Let's begin. Welcome to Phoenix.");

            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 2000);
        }

        // ============================================
        // UTILITIES
        // ============================================
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ============================================
        // INITIALIZE
        // ============================================
        // Begin demo when user clicks START button
        async function beginDemo() {
            // Hide start button
            document.getElementById('startBtn').style.display = 'none';
            document.querySelector('#phase-intro .subtitle').style.display = 'none';

            // Start onboarding sequence
            await startOnboarding();
        }

        window.addEventListener('DOMContentLoaded', () => {
            console.log('‚úÖ Onboarding loaded');
            initStarfield();
            // Wait for user to click START button (beginDemo)
        });
    </script>
</body>
</html>
