<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phoenix Voice Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0f;
            color: #fff;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-container {
            text-align: center;
            max-width: 700px;
            padding: 40px;
        }

        .voice-orb {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, #00d4ff 0%, #0066ff 100%);
            margin: 0 auto 40px;
            box-shadow: 0 0 60px rgba(0, 212, 255, 0.6);
            animation: pulse 2s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s;
        }

        .voice-orb.listening {
            animation: listening 1s ease-in-out infinite;
            box-shadow: 0 0 100px rgba(0, 255, 170, 0.8);
            background: radial-gradient(circle, #00ffaa 0%, #00d4ff 100%);
        }

        .voice-orb.processing {
            animation: processing 1.5s ease-in-out infinite;
            box-shadow: 0 0 80px rgba(255, 165, 0, 0.8);
            background: radial-gradient(circle, #ffaa00 0%, #ff6600 100%);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes listening {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes processing {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.08) rotate(180deg); }
        }

        .voice-prompt {
            font-size: 24px;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .voice-transcript {
            font-size: 18px;
            min-height: 60px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin: 20px 0;
        }

        .voice-response {
            font-size: 16px;
            padding: 20px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 12px;
            margin-top: 20px;
            min-height: 80px;
            line-height: 1.6;
        }

        .intent-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .command-examples {
            margin-top: 40px;
            text-align: left;
        }

        .command-examples h3 {
            font-size: 16px;
            margin-bottom: 16px;
            opacity: 0.6;
        }

        .example-category {
            margin-bottom: 20px;
        }

        .example-category h4 {
            font-size: 14px;
            opacity: 0.5;
            margin-bottom: 8px;
        }

        .command-examples ul {
            list-style: none;
        }

        .command-examples li {
            padding: 8px 12px;
            margin: 4px 0;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            font-size: 14px;
            opacity: 0.7;
            cursor: pointer;
            transition: all 0.2s;
        }

        .command-examples li:hover {
            background: rgba(0, 212, 255, 0.1);
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="voice-container">
        <div id="voiceOrb" class="voice-orb" onclick="toggleListening()"></div>

        <div class="voice-prompt">
            <span id="promptText">Click orb or say "Phoenix"</span>
        </div>

        <div class="voice-transcript">
            <span id="transcript">Listening...</span>
        </div>

        <div class="voice-response">
            <span id="response">Voice interface ready. Ask me anything!</span>
        </div>

        <div class="command-examples">
            <h3>üåü UNIVERSAL AI - TRY ANY COMMAND:</h3>

            <div class="example-category">
                <h4>‚ôÄÔ∏è VENUS - Fitness & Nutrition</h4>
                <ul>
                    <li onclick="simulateCommand(this)">"I want a fat ass"</li>
                    <li onclick="simulateCommand(this)">"Generate a chest workout"</li>
                    <li onclick="simulateCommand(this)">"Help me lose 10 pounds"</li>
                    <li onclick="simulateCommand(this)">"Create a meal plan for cutting"</li>
                </ul>
            </div>

            <div class="example-category">
                <h4>‚òøÔ∏è MERCURY - Health & Biometrics</h4>
                <ul>
                    <li onclick="simulateCommand(this)">"What's my recovery score?"</li>
                    <li onclick="simulateCommand(this)">"How's my sleep?"</li>
                    <li onclick="simulateCommand(this)">"Am I overtraining?"</li>
                    <li onclick="simulateCommand(this)">"Should I train today?"</li>
                </ul>
            </div>

            <div class="example-category">
                <h4>‚ôÇÔ∏è MARS - Goals & Habits</h4>
                <ul>
                    <li onclick="simulateCommand(this)">"Show my progress"</li>
                    <li onclick="simulateCommand(this)">"Help me wake up at 6am"</li>
                    <li onclick="simulateCommand(this)">"What are my active goals?"</li>
                </ul>
            </div>

            <div class="example-category">
                <h4>‚ôÉ JUPITER - Finance</h4>
                <ul>
                    <li onclick="simulateCommand(this)">"Where am I overspending?"</li>
                    <li onclick="simulateCommand(this)">"Show my budget status"</li>
                    <li onclick="simulateCommand(this)">"Analyze my spending"</li>
                </ul>
            </div>

            <div class="example-category">
                <h4>üåç EARTH - Calendar & Energy</h4>
                <ul>
                    <li onclick="simulateCommand(this)">"When should I schedule my meeting?"</li>
                    <li onclick="simulateCommand(this)">"What's my energy level?"</li>
                    <li onclick="simulateCommand(this)">"Give me a run down of my week"</li>
                </ul>
            </div>

            <div class="example-category">
                <h4>üî• PHOENIX - AI & Automation</h4>
                <ul>
                    <li onclick="simulateCommand(this)">"What patterns do you see?"</li>
                    <li onclick="simulateCommand(this)">"Order me a smoothie from Smoothie King"</li>
                    <li onclick="simulateCommand(this)">"Call my dentist"</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        let recognition;
        let isListening = false;
        let conversationHistory = [];

        // Initialize speech recognition
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onresult = (event) => {
                const transcript = Array.from(event.results)
                    .map(result => result[0])
                    .map(result => result.transcript)
                    .join('');

                document.getElementById('transcript').textContent = transcript;

                // Process final results
                if (event.results[event.results.length - 1].isFinal) {
                    processCommand(transcript);
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                document.getElementById('response').textContent = `Error: ${event.error}`;
            };

            recognition.onend = () => {
                if (isListening) {
                    recognition.start(); // Auto-restart
                }
            };
        } else {
            document.getElementById('response').textContent = 'Voice recognition not supported in this browser';
        }

        function toggleListening() {
            if (!recognition) return;

            if (isListening) {
                stopListening();
            } else {
                startListening();
            }
        }

        function startListening() {
            recognition.start();
            isListening = true;
            document.getElementById('voiceOrb').classList.add('listening');
            document.getElementById('promptText').textContent = 'Listening...';
        }

        function stopListening() {
            recognition.stop();
            isListening = false;
            document.getElementById('voiceOrb').classList.remove('listening');
            document.getElementById('promptText').textContent = 'Click orb or say "Phoenix"';
        }

        function simulateCommand(element) {
            const command = element.textContent.replace(/"/g, '');
            document.getElementById('transcript').textContent = command;
            processCommand(command);
        }

        /**
         * UNIVERSAL NATURAL LANGUAGE PROCESSING
         * Sends ALL commands to the backend AI router
         * Backend automatically determines intent and routes to correct planet
         */
        async function processCommand(command) {
            const lowerCommand = command.toLowerCase();

            // Show processing state
            const orb = document.getElementById('voiceOrb');
            orb.classList.remove('listening');
            orb.classList.add('processing');
            document.getElementById('response').innerHTML = `<div class="intent-badge" style="background: rgba(255,165,0,0.2); color: #ffaa00;">Processing...</div><div>Analyzing: "${command}"</div>`;

            // Handle "open" commands locally (instant navigation)
            if (lowerCommand.includes('open')) {
                const planetMap = {
                    'mercury': 'mercury.html',
                    'venus': 'venus.html',
                    'earth': 'earth.html',
                    'mars': 'mars.html',
                    'jupiter': 'jupiter.html',
                    'saturn': 'saturn.html',
                    'dashboard': 'dashboard.html'
                };

                for (const [planet, url] of Object.entries(planetMap)) {
                    if (lowerCommand.includes(planet)) {
                        document.getElementById('response').textContent = `Opening ${planet.charAt(0).toUpperCase() + planet.slice(1)}...`;
                        setTimeout(() => window.location.href = url, 500);
                        return;
                    }
                }
            }

            // Send to Universal NL endpoint
            try {
                const token = localStorage.getItem('phoenixToken');

                const response = await fetch(`${window.PhoenixConfig.API_BASE_URL}/phoenix/universal`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: command,
                        conversationHistory: conversationHistory.slice(-5) // Last 5 messages for context
                    })
                });

                orb.classList.remove('processing');

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const result = await response.json();
                console.log('üåü Universal NL Response:', result);

                // Display intent badge
                const planetColors = {
                    'mercury': '#00d4ff',
                    'venus': '#ff1493',
                    'mars': '#ff4500',
                    'jupiter': '#ffa500',
                    'earth': '#00ff7f',
                    'saturn': '#9370db',
                    'phoenix': '#ff6347'
                };

                // Display conversational response (intent badge removed - was showing debug info)
                document.getElementById('response').innerHTML = `<div>${result.response}</div>`;

                // Add to conversation history
                conversationHistory.push({
                    role: 'user',
                    content: command
                });
                conversationHistory.push({
                    role: 'assistant',
                    content: result.response
                });

                // Keep only last 10 messages (5 exchanges)
                if (conversationHistory.length > 10) {
                    conversationHistory = conversationHistory.slice(-10);
                }

                // Optional: Navigate to planet after 3 seconds if relevant
                const navigationActions = ['open', 'show', 'display', 'view'];
                if (navigationActions.includes(result.intent.action.toLowerCase())) {
                    const planetMap = {
                        'mercury': 'mercury.html',
                        'venus': 'venus.html',
                        'earth': 'earth.html',
                        'mars': 'mars.html',
                        'jupiter': 'jupiter.html',
                        'saturn': 'saturn.html'
                    };

                    const planetUrl = planetMap[result.intent.planet];
                    if (planetUrl) {
                        setTimeout(() => {
                            document.getElementById('response').innerHTML += `<div style="margin-top: 12px; opacity: 0.7;">Opening ${result.intent.planet}...</div>`;
                            setTimeout(() => window.location.href = planetUrl, 1000);
                        }, 2000);
                    }
                }

            } catch (error) {
                console.error('‚ùå Universal NL Error:', error);
                orb.classList.remove('processing');

                // Fallback to local processing for demo purposes
                document.getElementById('response').innerHTML = `
                    <div class="intent-badge" style="background: rgba(255,0,0,0.2); color: #ff4444;">Offline Mode</div>
                    <div>I heard: "${command}"<br><br>
                    Universal AI is offline. Please ensure you're logged in and connected to the backend.<br><br>
                    ${error.message}</div>
                `;
            }
        }

        // Auto-start listening
        setTimeout(() => {
            console.log('üåü Phoenix Voice Interface - Universal AI Ready');
            console.log('üì° Backend:', window.PhoenixConfig.API_BASE_URL);
            console.log('üéØ Universal Endpoint: POST /api/phoenix/universal');
            startListening();
        }, 1000);
    </script>
</body>
</html>
