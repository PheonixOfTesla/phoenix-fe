<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Phoenix - The Most Sophisticated AI Life Companion">
    <title>Phoenix - AI Life Operating System</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="phoenix-voice.css">
    <style>
        /* ============================================
           VIEW MANAGER - Controls which view is visible
           ============================================ */
        .view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
        }

        .view.active {
            display: block;
        }

        .view.main-app {
            position: relative;
            z-index: 1;
        }

        /* ============================================
           AUTHENTICATION VIEW STYLES
           ============================================ */
        .auth-view {
            background: #000;
            color: #00ffff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
        }

        .auth-container {
            width: 90%;
            max-width: 450px;
            background: rgba(0, 10, 20, 0.95);
            border: 2px solid rgba(0, 255, 255, 0.5);
            padding: 50px 40px;
            backdrop-filter: blur(20px);
            box-shadow: 0 0 60px rgba(0, 255, 255, 0.4);
            animation: slideIn 0.8s ease-out;
            margin: 0 auto;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .auth-logo-text {
            font-size: 48px;
            color: #00ffff;
            text-shadow: 0 0 30px rgba(0, 255, 255, 1);
            letter-spacing: 8px;
            margin-bottom: 10px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                text-shadow: 0 0 30px rgba(0, 255, 255, 1);
            }
            50% {
                text-shadow: 0 0 50px rgba(0, 255, 255, 1);
            }
        }

        .auth-logo-subtitle {
            font-size: 14px;
            color: rgba(0, 255, 255, 0.6);
            letter-spacing: 2px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            color: rgba(0, 255, 255, 0.5);
            font-size: 14px;
            letter-spacing: 2px;
            border-bottom: 2px solid transparent;
        }

        .auth-tab.active {
            color: #00ffff;
            border-bottom-color: #00ffff;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-size: 11px;
            color: rgba(0, 255, 255, 0.7);
            margin-bottom: 8px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            font-family: inherit;
            font-size: 14px;
            outline: none;
            transition: all 0.3s;
        }

        .form-input:focus {
            background: rgba(0, 255, 255, 0.1);
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #00ffff;
            color: #00ffff;
            font-family: inherit;
            font-size: 14px;
            letter-spacing: 3px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .submit-btn:hover {
            background: rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .error-message, .success-message {
            padding: 15px;
            margin-bottom: 20px;
            font-size: 12px;
            display: none;
            border-radius: 4px;
        }

        .error-message {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.5);
            color: #ff4444;
        }

        .success-message {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.5);
            color: #00ffff;
        }

        .error-message.show, .success-message.show {
            display: block;
        }

        /* ============================================
           ONBOARDING VIEW STYLES (From onboarding.html)
           ============================================ */
        .onboarding-view {
            background: #000;
            color: #00ffff;
            font-family: 'Courier New', 'Consolas', monospace;
        }

        .onboarding-container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .progress-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        }

        .progress-bar {
            height: 4px;
            background: linear-gradient(90deg, #00ffff, rgba(0, 255, 255, 1));
            transition: width 0.5s ease;
            box-shadow: 0 0 20px rgba(0, 255, 255, 1);
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            padding: 15px 40px;
            max-width: 900px;
            margin: 0 auto;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0.3;
            transition: opacity 0.3s;
            font-size: 11px;
            letter-spacing: 1px;
        }

        .progress-step.active {
            opacity: 1;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 1);
        }

        .progress-step.completed {
            opacity: 0.6;
        }

        .step-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid rgba(0, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            transition: all 0.3s;
        }

        .progress-step.active .step-number {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .progress-step.completed .step-number {
            border-color: #00ffff;
            background: #00ffff;
            color: #000;
        }

        .phase {
            display: none;
        }

        .phase.active {
            display: block;
            animation: fadeIn 0.6s ease-out;
        }

        .phase-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .phase-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #00ffff;
            text-shadow: 0 0 20px rgba(0, 255, 255, 1);
            letter-spacing: 2px;
        }

        .phase-subtitle {
            font-size: 14px;
            color: rgba(0, 255, 255, 0.6);
            letter-spacing: 1px;
        }

        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .selection-card {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.05), rgba(0, 255, 255, 0.1));
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 4px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .selection-card:hover {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.15);
            transform: translateY(-4px);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
        }

        .selection-card.selected {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .selection-card .icon {
            font-size: 48px;
            margin-bottom: 16px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 1);
        }

        .selection-card .title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #00ffff;
        }

        .selection-card .subtitle {
            font-size: 12px;
            color: rgba(0, 255, 255, 0.6);
        }

        .voice-preview-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 12px;
            font-size: 11px;
            letter-spacing: 1px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .voice-preview-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 32px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            min-width: 140px;
            font-family: inherit;
            letter-spacing: 2px;
        }

        .btn-primary {
            background: rgba(0, 255, 255, 0.1);
            color: #00ffff;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
        }

        .btn-primary:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(0, 255, 255, 0.6);
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #00ffff;
        }

        .intro-text {
            text-align: center;
            max-width: 600px;
            margin: 0 auto 40px;
            line-height: 1.8;
            color: rgba(0, 255, 255, 0.6);
            font-size: 14px;
        }

        .phoenix-avatar {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            position: relative;
        }

        .avatar-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 255, 255, 0.1), transparent);
            border: 3px solid rgba(0, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            animation: corePulse 3s ease-in-out infinite;
        }

        @keyframes corePulse {
            0%, 100% {
                box-shadow: 0 0 30px rgba(0, 255, 255, 1);
            }
            50% {
                box-shadow: 0 0 50px rgba(0, 255, 255, 1);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .auth-container {
                padding: 40px 30px;
                width: 95%;
            }

            .auth-logo-text {
                font-size: 36px;
            }

            .selection-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ============================================ -->
    <!-- VIEW: LANDING (Choose Login or Register) -->
    <!-- ============================================ -->
    <div class="view landing-view" id="landing-view">
        <canvas id="landing-bg-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none"></canvas>

        <div style="position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:20px">
            <div style="text-align:center;margin-bottom:60px">
                <div style="font-size:72px;font-weight:900;letter-spacing:8px;background:linear-gradient(135deg,#00ffff,#00cccc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px">
                    PHOENIX
                </div>
                <div style="font-size:16px;color:rgba(0,255,255,0.6);letter-spacing:4px;font-weight:300">
                    AI LIFE OPERATING SYSTEM
                </div>
            </div>

            <div style="display:flex;flex-direction:column;gap:20px;width:100%;max-width:400px">
                <button onclick="ViewManager.showView('login')" style="padding:24px;font-size:18px;font-weight:700;letter-spacing:2px;background:linear-gradient(135deg,rgba(0,255,255,0.2),rgba(0,255,255,0.1));border:2px solid rgba(0,255,255,0.5);color:#00ffff;border-radius:8px;cursor:pointer;transition:all 0.3s;text-transform:uppercase">
                    LOGIN
                </button>
                <button onclick="window.location.href='onboarding.html'" style="padding:24px;font-size:18px;font-weight:700;letter-spacing:2px;background:linear-gradient(135deg,rgba(0,255,255,0.1),rgba(0,255,255,0.05));border:2px solid rgba(0,255,255,0.3);color:rgba(0,255,255,0.8);border-radius:8px;cursor:pointer;transition:all 0.3s;text-transform:uppercase">
                    CREATE ACCOUNT
                </button>
            </div>

            <div style="margin-top:40px;text-align:center;color:rgba(0,255,255,0.4);font-size:13px;line-height:1.6">
                The most sophisticated AI companion<br>
                for optimizing your entire existence
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- VIEW: LOGIN -->
    <!-- ============================================ -->
    <div class="view auth-view" id="login-view">
        <canvas id="auth-bg-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none"></canvas>

        <div class="auth-container" style="position:relative;z-index:2">
            <div class="auth-logo">
                <div class="auth-logo-text">PHOENIX</div>
                <div class="auth-logo-subtitle">LOGIN</div>
            </div>

            <div class="error-message" id="auth-error"></div>
            <div class="success-message" id="auth-success"></div>

            <!-- Login Form -->
            <div class="auth-form active" id="login-form">
                <form id="login-form-element">
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <div class="phone-input-wrapper" style="display: flex; gap: 10px;">
                            <select id="login-countryCode" class="form-input" style="width: 120px; flex-shrink: 0;">
                                <option value="+1" data-country="US">üá∫üá∏ +1</option>
                                <option value="+44" data-country="GB">üá¨üáß +44</option>
                                <option value="+91" data-country="IN">üáÆüá≥ +91</option>
                                <option value="+86" data-country="CN">üá®üá≥ +86</option>
                                <option value="+81" data-country="JP">üáØüáµ +81</option>
                                <option value="+49" data-country="DE">üá©üá™ +49</option>
                                <option value="+33" data-country="FR">üá´üá∑ +33</option>
                                <option value="+61" data-country="AU">üá¶üá∫ +61</option>
                                <option value="+39" data-country="IT">üáÆüáπ +39</option>
                                <option value="+34" data-country="ES">üá™üá∏ +34</option>
                                <option value="+7" data-country="RU">üá∑üá∫ +7</option>
                                <option value="+55" data-country="BR">üáßüá∑ +55</option>
                                <option value="+52" data-country="MX">üá≤üáΩ +52</option>
                                <option value="+82" data-country="KR">üá∞üá∑ +82</option>
                                <option value="+31" data-country="NL">üá≥üá± +31</option>
                            </select>
                            <input type="tel" class="form-input" id="login-phone" placeholder="(555) 123-4567" style="flex: 1;" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="submit-btn" id="login-btn">ACTIVATE PHOENIX</button>
                    <div style="text-align: center; margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
                        <button type="button" class="btn-link" onclick="window.location.href='onboarding.html'" style="background: none; border: none; color: rgba(0,255,255,0.7); cursor: pointer; text-decoration: underline; font-size: 14px;">
                            Don't have an account? Create one
                        </button>
                        <button type="button" class="btn-link" onclick="toggleLoginMethod()" style="background: none; border: none; color: rgba(0,255,255,0.6); cursor: pointer; text-decoration: underline; font-size: 13px;">
                            Sign in with email instead
                        </button>
                        <button type="button" class="btn-link" onclick="showForgotPassword()" style="background: none; border: none; color: rgba(0,255,255,0.5); cursor: pointer; text-decoration: underline; font-size: 13px;">
                            Forgot password?
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- VIEW: ONBOARDING (Language, Voice, Account Setup) -->
    <!-- ============================================ -->
    <div class="view onboarding-view" id="onboarding-view">
        <div class="grid-underlay"></div>

        <!-- Progress Bar -->
        <div class="progress-wrapper">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            <div class="progress-steps">
                <div class="progress-step active" data-step="0">
                    <div class="step-number">1</div>
                    <span>LANG</span>
                </div>
                <div class="progress-step" data-step="1">
                    <div class="step-number">2</div>
                    <span>VOICE</span>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="step-number">3</div>
                    <span>ACCOUNT</span>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="step-number">4</div>
                    <span>COMPLETE</span>
                </div>
            </div>
        </div>

        <div class="onboarding-container">
            <!-- Phase 0: Language Selection -->
            <div class="phase active" id="ob-phase0">
                <div class="phoenix-avatar">
                    <div class="avatar-circle">üî•</div>
                </div>
                <div class="phase-header">
                    <h1 class="phase-title">SELECT LANGUAGE</h1>
                    <p class="phase-subtitle">CHOOSE YOUR PREFERRED LANGUAGE</p>
                </div>
                <div class="selection-grid" id="languageGrid">
                    <div class="selection-card" data-lang="en" data-name="English">
                        <div class="icon">üá¨üáß</div>
                        <div class="title">ENGLISH</div>
                        <div class="subtitle">Global</div>
                    </div>
                    <div class="selection-card" data-lang="es" data-name="Spanish">
                        <div class="icon">üá™üá∏</div>
                        <div class="title">ESPA√ëOL</div>
                        <div class="subtitle">Spanish</div>
                    </div>
                    <div class="selection-card" data-lang="fr" data-name="French">
                        <div class="icon">üá´üá∑</div>
                        <div class="title">FRAN√áAIS</div>
                        <div class="subtitle">French</div>
                    </div>
                    <div class="selection-card" data-lang="de" data-name="German">
                        <div class="icon">üá©üá™</div>
                        <div class="title">DEUTSCH</div>
                        <div class="subtitle">German</div>
                    </div>
                    <div class="selection-card" data-lang="it" data-name="Italian">
                        <div class="icon">üáÆüáπ</div>
                        <div class="title">ITALIANO</div>
                        <div class="subtitle">Italian</div>
                    </div>
                    <div class="selection-card" data-lang="pt" data-name="Portuguese">
                        <div class="icon">üáµüáπ</div>
                        <div class="title">PORTUGU√äS</div>
                        <div class="subtitle">Portuguese</div>
                    </div>
                    <div class="selection-card" data-lang="nl" data-name="Dutch">
                        <div class="icon">üá≥üá±</div>
                        <div class="title">NEDERLANDS</div>
                        <div class="subtitle">Dutch</div>
                    </div>
                    <div class="selection-card" data-lang="pl" data-name="Polish">
                        <div class="icon">üáµüá±</div>
                        <div class="title">POLSKI</div>
                        <div class="subtitle">Polish</div>
                    </div>
                    <div class="selection-card" data-lang="ru" data-name="Russian">
                        <div class="icon">üá∑üá∫</div>
                        <div class="title">–†–£–°–°–ö–ò–ô</div>
                        <div class="subtitle">Russian</div>
                    </div>
                    <div class="selection-card" data-lang="ja" data-name="Japanese">
                        <div class="icon">üáØüáµ</div>
                        <div class="title">Êó•Êú¨Ë™û</div>
                        <div class="subtitle">Japanese</div>
                    </div>
                    <div class="selection-card" data-lang="zh" data-name="Chinese">
                        <div class="icon">üá®üá≥</div>
                        <div class="title">‰∏≠Êñá</div>
                        <div class="subtitle">Chinese</div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="ViewManager.showView('auth')">[ ‚Üê BACK TO LOGIN ]</button>
                    <button class="btn btn-primary" id="nextPhase0" disabled>[ CONTINUE ]</button>
                </div>
            </div>

            <!-- Phase 1: Voice Selection -->
            <div class="phase" id="ob-phase1">
                <div class="phoenix-avatar">
                    <div class="avatar-circle">üî•</div>
                </div>
                <div class="phase-header">
                    <h1 class="phase-title">SELECT VOICE</h1>
                    <p class="phase-subtitle">CHOOSE YOUR AI COMPANION'S VOICE</p>
                </div>
                <div class="selection-grid" id="voiceGrid">
                    <div class="selection-card" data-voice="nova">
                        <div class="icon">üòä</div>
                        <div class="title">NOVA</div>
                        <div class="subtitle">Friendly Helper</div>
                        <button class="voice-preview-btn" onclick="Onboarding.previewVoice('nova', event)">‚ñ∂ PREVIEW</button>
                    </div>
                    <div class="selection-card" data-voice="echo">
                        <div class="icon">üá¨üáß</div>
                        <div class="title">ECHO</div>
                        <div class="subtitle">British Butler</div>
                        <button class="voice-preview-btn" onclick="Onboarding.previewVoice('echo', event)">‚ñ∂ PREVIEW</button>
                    </div>
                    <div class="selection-card" data-voice="onyx">
                        <div class="icon">üíº</div>
                        <div class="title">ONYX</div>
                        <div class="subtitle">Professional</div>
                        <button class="voice-preview-btn" onclick="Onboarding.previewVoice('onyx', event)">‚ñ∂ PREVIEW</button>
                    </div>
                    <div class="selection-card" data-voice="shimmer">
                        <div class="icon">üå∏</div>
                        <div class="title">SHIMMER</div>
                        <div class="subtitle">Gentle Guide</div>
                        <button class="voice-preview-btn" onclick="Onboarding.previewVoice('shimmer', event)">‚ñ∂ PREVIEW</button>
                    </div>
                    <div class="selection-card" data-voice="alloy">
                        <div class="icon">‚ö°</div>
                        <div class="title">ALLOY</div>
                        <div class="subtitle">Neutral Balanced</div>
                        <button class="voice-preview-btn" onclick="Onboarding.previewVoice('alloy', event)">‚ñ∂ PREVIEW</button>
                    </div>
                    <div class="selection-card" data-voice="fable">
                        <div class="icon">üìñ</div>
                        <div class="title">FABLE</div>
                        <div class="subtitle">Storyteller</div>
                        <button class="voice-preview-btn" onclick="Onboarding.previewVoice('fable', event)">‚ñ∂ PREVIEW</button>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="Onboarding.previousPhase()">[ BACK ]</button>
                    <button class="btn btn-primary" id="nextPhase1" disabled>[ CONTINUE ]</button>
                </div>
            </div>

            <!-- Phase 2: Account Creation -->
            <div class="phase" id="ob-phase2">
                <div class="phoenix-avatar">
                    <div class="avatar-circle">üî•</div>
                </div>
                <div class="phase-header">
                    <h1 class="phase-title">CREATE ACCOUNT</h1>
                    <p class="phase-subtitle">REGISTER YOUR CREDENTIALS</p>
                </div>
                <form id="accountForm" style="max-width:500px;margin:0 auto">
                    <div class="form-group">
                        <label class="form-label">FULL NAME</label>
                        <input type="text" class="form-input" id="ob-name" placeholder="John Doe" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">EMAIL</label>
                        <input type="email" class="form-input" id="ob-email" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">PASSWORD</label>
                        <input type="password" class="form-input" id="ob-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CONFIRM PASSWORD</label>
                        <input type="password" class="form-input" id="ob-password-confirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                    </div>
                </form>
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="Onboarding.previousPhase()">[ BACK ]</button>
                    <button class="btn btn-primary" onclick="Onboarding.createAccount()">[ CREATE ACCOUNT ]</button>
                </div>
            </div>

            <!-- Phase 3: Complete -->
            <div class="phase" id="ob-phase3">
                <div class="phoenix-avatar">
                    <div class="avatar-circle">üî•</div>
                </div>
                <div class="phase-header">
                    <h1 class="phase-title">WELCOME TO PHOENIX</h1>
                    <p class="phase-subtitle">YOUR AI COMPANION IS READY</p>
                </div>
                <div class="intro-text">
                    <p>YOUR ACCOUNT HAS BEEN CREATED SUCCESSFULLY.</p>
                    <p>I'M PHOENIX, AND I'LL HELP YOU OPTIMIZE YOUR LIFE.</p>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="
                        localStorage.setItem('phoenixOnboardingComplete', 'true');
                        localStorage.setItem('phoenixOnboardingChoice', 'explore');
                        window.location.href='dashboard.html'
                    " style="font-size:14px;padding:18px 48px">
                        [ LAUNCH PHOENIX ]
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- VIEW: MAIN APP (The full Phoenix dashboard) -->
    <!-- ============================================ -->
    <div class="view main-app" id="main-app-view">
        <!-- Loading Screen -->
        <div id="loading" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10000;transition:opacity 1s">
            <div style="font-size:64px;color:#00ffff;text-shadow:0 0 30px rgba(0,255,255,1);letter-spacing:12px;margin-bottom:30px;animation:pulse 2s infinite">PHOENIX</div>
            <div style="width:60px;height:60px;border:3px solid rgba(0,255,255,0.2);border-top-color:#00ffff;border-radius:50%;animation:spin 1s linear infinite"></div>
            <div style="margin-top:30px;color:rgba(0,255,255,0.7);font-size:14px;letter-spacing:2px">INITIALIZING AI SYSTEMS...</div>
        </div>

        <!-- Main app content will be loaded here from existing index.html -->
        <div id="main-content">
            <!-- HUD, panels, voice controls, etc. -->
            <p style="color:#00ffff;text-align:center;padding-top:200px;font-size:24px">
                üî• PHOENIX MAIN APP LOADS HERE üî•
            </p>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- GLOBAL SCRIPTS -->
    <!-- ============================================ -->
    <script src="src/config.js"></script>
    <script src="src/api.js"></script>

    <script>
        // ============================================
        // VIEW MANAGER - Routes between views
        // ============================================
        const ViewManager = {
            currentView: null,

            init() {
                console.log('[ViewManager] Initializing...');
                this.checkAuthentication();
            },

            async checkAuthentication() {
                const token = localStorage.getItem('phoenixToken');

                if (!token) {
                    console.log('[ViewManager] No token found, showing login view');
                    this.showView('login');
                    return;
                }

                // Verify token is valid
                try {
                    const response = await fetch(`${PhoenixConfig.API_BASE_URL}/auth/me`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    const data = await response.json();

                    if (data.success) {
                        console.log('[ViewManager] Valid token, redirecting to dashboard');
                        window.location.href = 'dashboard.html';
                        return;
                    } else {
                        console.log('[ViewManager] Invalid token, showing login view');
                        localStorage.removeItem('phoenixToken');
                        localStorage.removeItem('phoenixUser');
                        this.showView('login');
                    }
                } catch (error) {
                    console.error('[ViewManager] Token verification failed:', error);
                    this.showView('login');
                }
            },

            showView(viewName) {
                console.log(`[ViewManager] Switching to view: ${viewName}`);

                // Hide all views
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));

                // Show selected view
                const views = {
                    'landing': document.getElementById('landing-view'),
                    'login': document.getElementById('login-view'),
                    'auth': document.getElementById('login-view'), // Alias for backwards compatibility
                    'onboarding': document.getElementById('onboarding-view'),
                    'main': document.getElementById('main-app-view')
                };

                const view = views[viewName];
                if (view) {
                    view.classList.add('active');
                    this.currentView = viewName;

                    // Initialize view-specific code
                    if (viewName === 'landing') this.initLandingView();
                    if (viewName === 'login' || viewName === 'auth') this.initAuthView();
                    if (viewName === 'onboarding') Onboarding.init();
                    if (viewName === 'main') this.initMainApp();
                }
            },

            initLandingView() {
                // Constellation background for landing
                const canvas = document.getElementById('landing-bg-canvas');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                const stars = [];
                for (let i = 0; i < 100; i++) {
                    stars.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        radius: Math.random() * 2,
                        alpha: Math.random()
                    });
                }

                function animate() {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    stars.forEach(star => {
                        ctx.beginPath();
                        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(0, 255, 255, ${star.alpha})`;
                        ctx.fill();

                        star.alpha += (Math.random() - 0.5) * 0.02;
                        star.alpha = Math.max(0.1, Math.min(1, star.alpha));
                    });

                    requestAnimationFrame(animate);
                }
                animate();
            },

            initAuthView() {
                // Constellation background
                const canvas = document.getElementById('auth-bg-canvas');
                const ctx = canvas.getContext('2d');
                let stars = [];

                function resize() {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                    createStars();
                }

                function createStars() {
                    stars = [];
                    const starCount = Math.floor((canvas.width * canvas.height) / 4000); // More stars for denser web

                    for (let i = 0; i < starCount; i++) {
                        stars.push({
                            x: Math.random() * canvas.width,
                            y: Math.random() * canvas.height,
                            size: Math.random() * 2 + 0.5,
                            vx: (Math.random() - 0.5) * 0.3,
                            vy: (Math.random() - 0.5) * 0.3,
                            alpha: Math.random() * 0.5 + 0.3
                        });
                    }
                }

                function update() {
                    stars.forEach(star => {
                        star.x += star.vx;
                        star.y += star.vy;

                        // Wrap around edges
                        if (star.x < 0) star.x = canvas.width;
                        if (star.x > canvas.width) star.x = 0;
                        if (star.y < 0) star.y = canvas.height;
                        if (star.y > canvas.height) star.y = 0;

                        // Twinkle effect
                        star.alpha += (Math.random() - 0.5) * 0.02;
                        star.alpha = Math.max(0.2, Math.min(0.8, star.alpha));
                    });
                }

                function draw() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    // Draw connections (web effect)
                    for (let i = 0; i < stars.length; i++) {
                        for (let j = i + 1; j < stars.length; j++) {
                            const dx = stars[i].x - stars[j].x;
                            const dy = stars[i].y - stars[j].y;
                            const distance = Math.sqrt(dx * dx + dy * dy);

                            if (distance < 150) { // Connection distance
                                const opacity = (1 - distance / 150) * 0.15;
                                ctx.strokeStyle = `rgba(0, 255, 255, ${opacity})`;
                                ctx.lineWidth = 0.5;
                                ctx.beginPath();
                                ctx.moveTo(stars[i].x, stars[i].y);
                                ctx.lineTo(stars[j].x, stars[j].y);
                                ctx.stroke();
                            }
                        }
                    }

                    // Draw stars
                    stars.forEach(star => {
                        ctx.fillStyle = `rgba(0, 255, 255, ${star.alpha})`;
                        ctx.beginPath();
                        ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                        ctx.fill();

                        // Glow effect
                        ctx.shadowBlur = 10;
                        ctx.shadowColor = 'rgba(0, 255, 255, 0.5)';
                        ctx.fill();
                        ctx.shadowBlur = 0;
                    });
                }

                function animate() {
                    update();
                    draw();
                    requestAnimationFrame(animate);
                }

                resize();
                window.addEventListener('resize', resize);
                animate();
            },

            initMainApp() {
                // Load main app scripts and UI
                console.log('[ViewManager] Main app initialized');

                // Hide loading screen after 2 seconds
                setTimeout(() => {
                    const loading = document.getElementById('loading');
                    if (loading) {
                        loading.style.opacity = '0';
                        setTimeout(() => loading.style.display = 'none', 1000);
                    }
                }, 2000);
            }
        };

        // ============================================
        // AUTHENTICATION CONTROLLER
        // ============================================
        const Auth = {
            init() {
                // Login form
                document.getElementById('login-form-element').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await this.handleLogin();
                });
            },

            async handleLogin() {
                // Check if using phone or email
                const phoneInput = document.getElementById('login-phone');
                const emailInput = document.getElementById('login-email-alt');

                let email;
                if (phoneInput && phoneInput.offsetParent !== null) {
                    // Phone login is active
                    const countryCode = document.getElementById('login-countryCode').value;
                    const phone = phoneInput.value;
                    email = countryCode + phone.replace(/\D/g, ''); // Remove non-digits and prepend country code
                } else if (emailInput) {
                    // Email login is active
                    email = emailInput.value;
                }

                const password = document.getElementById('login-password').value;

                this.hideMessages();
                document.getElementById('login-btn').disabled = true;
                document.getElementById('login-btn').textContent = 'CONNECTING...';

                try {
                    const response = await fetch(`${PhoenixConfig.API_BASE_URL}/auth/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });

                    // Handle rate limiting (429)
                    if (response.status === 429) {
                        this.showError('Too many login attempts. Please wait 2 minutes and try again.');
                        return;
                    }

                    // Handle non-200 responses
                    if (!response.ok) {
                        this.showError(`Login failed (Error ${response.status}). Please try again.`);
                        return;
                    }

                    const data = await response.json();

                    if (data.success && data.token) {
                        localStorage.setItem('phoenixToken', data.token);
                        localStorage.setItem('phoenixUser', JSON.stringify(data.user));

                        this.showSuccess('Login successful!');
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 500);
                    } else {
                        this.showError(data.message || 'Login failed');
                    }
                } catch (error) {
                    console.error('[Auth] Login error:', error);
                    this.showError('Connection error. Please try again.');
                } finally {
                    document.getElementById('login-btn').disabled = false;
                    document.getElementById('login-btn').textContent = 'ACTIVATE PHOENIX';
                }
            },

            showError(message) {
                const el = document.getElementById('auth-error');
                el.textContent = message;
                el.classList.add('show');
            },

            showSuccess(message) {
                const el = document.getElementById('auth-success');
                el.textContent = message;
                el.classList.add('show');
            },

            hideMessages() {
                document.getElementById('auth-error').classList.remove('show');
                document.getElementById('auth-success').classList.remove('show');
            }
        };

        // ============================================
        // ONBOARDING CONTROLLER
        // ============================================
        const Onboarding = {
            currentPhase: 0,
            userData: {
                language: 'en',
                languageName: 'English',
                voice: 'echo',
                name: '',
                email: '',
                password: ''
            },

            init() {
                console.log('[Onboarding] Initialized');
                this.setupLanguageSelection();
                this.setupVoiceSelection();
                this.currentPhase = 0;
                this.updateProgress();
            },

            setupLanguageSelection() {
                document.querySelectorAll('#languageGrid .selection-card').forEach(card => {
                    card.addEventListener('click', () => {
                        document.querySelectorAll('#languageGrid .selection-card').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        this.userData.language = card.dataset.lang;
                        this.userData.languageName = card.dataset.name;
                        document.getElementById('nextPhase0').disabled = false;
                    });
                });

                document.getElementById('nextPhase0').addEventListener('click', () => {
                    localStorage.setItem('phoenixLanguage', this.userData.language);
                    this.nextPhase();
                });
            },

            setupVoiceSelection() {
                document.querySelectorAll('#voiceGrid .selection-card').forEach(card => {
                    card.addEventListener('click', () => {
                        document.querySelectorAll('#voiceGrid .selection-card').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        this.userData.voice = card.dataset.voice;
                        document.getElementById('nextPhase1').disabled = false;
                    });
                });

                document.getElementById('nextPhase1').addEventListener('click', () => {
                    localStorage.setItem('phoenixVoice', this.userData.voice);
                    this.nextPhase();
                });
            },

            async createAccount() {
                const form = document.getElementById('accountForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const password = document.getElementById('ob-password').value;
                const confirmPassword = document.getElementById('ob-password-confirm').value;

                if (password !== confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }

                this.userData.name = document.getElementById('ob-name').value;
                this.userData.email = document.getElementById('ob-email').value;
                this.userData.password = password;

                try {
                    const response = await fetch(`${PhoenixConfig.API_BASE_URL}/auth/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name: this.userData.name,
                            email: this.userData.email,
                            password: this.userData.password,
                            language: this.userData.language,
                            voice: this.userData.voice,
                            role: 'client'
                        })
                    });

                    const data = await response.json();

                    if (data.success && data.token) {
                        localStorage.setItem('phoenixToken', data.token);
                        localStorage.setItem('phoenixUser', JSON.stringify(data.user));

                        console.log('[Onboarding] Account created successfully');
                        this.nextPhase();
                    } else {
                        alert(data.message || 'Registration failed');
                    }
                } catch (error) {
                    console.error('[Onboarding] Registration error:', error);
                    alert('Connection error. Please try again.');
                }
            },

            nextPhase() {
                if (this.currentPhase < 3) {
                    document.getElementById(`ob-phase${this.currentPhase}`).classList.remove('active');
                    this.currentPhase++;
                    document.getElementById(`ob-phase${this.currentPhase}`).classList.add('active');
                    this.updateProgress();
                }
            },

            previousPhase() {
                if (this.currentPhase > 0) {
                    document.getElementById(`ob-phase${this.currentPhase}`).classList.remove('active');
                    this.currentPhase--;
                    document.getElementById(`ob-phase${this.currentPhase}`).classList.add('active');
                    this.updateProgress();
                }
            },

            updateProgress() {
                const progress = (this.currentPhase / 3) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;

                document.querySelectorAll('.progress-step').forEach((step, index) => {
                    if (index < this.currentPhase) {
                        step.classList.add('completed');
                        step.classList.remove('active');
                    } else if (index === this.currentPhase) {
                        step.classList.add('active');
                        step.classList.remove('completed');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });
            },

            async previewVoice(voiceId, event) {
                // Prevent card click event from firing
                event.stopPropagation();

                const button = event.target;
                const originalText = button.textContent;

                try {
                    button.textContent = '‚è≥ LOADING...';
                    button.disabled = true;

                    // Voice preview messages in selected language
                    const previewMessages = {
                        'nova': "Hello! I'm Nova, your friendly AI companion. I'm here to help make your day better!",
                        'echo': "Good day. I am Echo, your personal AI butler, at your service.",
                        'onyx': "Greetings. I'm Onyx, your professional AI assistant. Let's get to work.",
                        'shimmer': "Hi there! I'm Shimmer. I'm here to support you with kindness and care.",
                        'alloy': "Hello. I'm Alloy, your efficient AI assistant. Ready to optimize your day.",
                        'fable': "Welcome, dear friend! I'm Fable, and I have wonderful stories to share with you!"
                    };

                    const message = previewMessages[voiceId] || "Hello! This is a voice preview.";

                    // Call backend TTS API
                    const response = await fetch(`${PhoenixConfig.API_BASE_URL}/tts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            text: message,
                            voice: voiceId
                        })
                    });

                    if (!response.ok) {
                        throw new Error('TTS request failed');
                    }

                    // Get audio blob
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);

                    // Play audio
                    const audio = new Audio(audioUrl);
                    button.textContent = '‚ñ∂ PLAYING...';

                    await audio.play();

                    // Clean up when done
                    audio.onended = () => {
                        URL.revokeObjectURL(audioUrl);
                        button.textContent = originalText;
                        button.disabled = false;
                    };

                } catch (error) {
                    console.error('[Onboarding] Voice preview error:', error);
                    button.textContent = '‚ùå ERROR';
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.disabled = false;
                    }, 2000);
                }
            }
        };

        // ============================================
        // TOGGLE LOGIN METHOD (Phone vs Email)
        // ============================================
        let usingPhoneLogin = true;

        function toggleLoginMethod() {
            const loginForm = document.getElementById('login-form-element');

            if (usingPhoneLogin) {
                // Switch to email login
                loginForm.innerHTML = `
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="login-email-alt" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="submit-btn" id="login-btn">ACTIVATE PHOENIX</button>
                    <div style="text-align: center; margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
                        <button type="button" class="btn-link" onclick="toggleLoginMethod()" style="background: none; border: none; color: rgba(0,255,255,0.7); cursor: pointer; text-decoration: underline; font-size: 13px;">
                            Sign in with phone number
                        </button>
                        <button type="button" class="btn-link" onclick="showForgotPassword()" style="background: none; border: none; color: rgba(0,255,255,0.5); cursor: pointer; text-decoration: underline; font-size: 13px;">
                            Forgot password?
                        </button>
                    </div>
                `;
                usingPhoneLogin = false;
            } else {
                // Switch back to phone login
                loginForm.innerHTML = `
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <div class="phone-input-wrapper" style="display: flex; gap: 10px;">
                            <select id="login-countryCode" class="form-input" style="width: 120px; flex-shrink: 0;">
                                <option value="+1" data-country="US">üá∫üá∏ +1</option>
                                <option value="+44" data-country="GB">üá¨üáß +44</option>
                                <option value="+91" data-country="IN">üáÆüá≥ +91</option>
                                <option value="+86" data-country="CN">üá®üá≥ +86</option>
                                <option value="+81" data-country="JP">üáØüáµ +81</option>
                                <option value="+49" data-country="DE">üá©üá™ +49</option>
                                <option value="+33" data-country="FR">üá´üá∑ +33</option>
                                <option value="+61" data-country="AU">üá¶üá∫ +61</option>
                                <option value="+39" data-country="IT">üáÆüáπ +39</option>
                                <option value="+34" data-country="ES">üá™üá∏ +34</option>
                                <option value="+7" data-country="RU">üá∑üá∫ +7</option>
                                <option value="+55" data-country="BR">üáßüá∑ +55</option>
                                <option value="+52" data-country="MX">üá≤üáΩ +52</option>
                                <option value="+82" data-country="KR">üá∞üá∑ +82</option>
                                <option value="+31" data-country="NL">üá≥üá± +31</option>
                            </select>
                            <input type="tel" class="form-input" id="login-phone" placeholder="(555) 123-4567" style="flex: 1;" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="submit-btn" id="login-btn">ACTIVATE PHOENIX</button>
                    <div style="text-align: center; margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
                        <button type="button" class="btn-link" onclick="window.location.href='onboarding.html'" style="background: none; border: none; color: rgba(0,255,255,0.7); cursor: pointer; text-decoration: underline; font-size: 14px;">
                            Don't have an account? Create one
                        </button>
                        <button type="button" class="btn-link" onclick="toggleLoginMethod()" style="background: none; border: none; color: rgba(0,255,255,0.6); cursor: pointer; text-decoration: underline; font-size: 13px;">
                            Sign in with email instead
                        </button>
                        <button type="button" class="btn-link" onclick="showForgotPassword()" style="background: none; border: none; color: rgba(0,255,255,0.5); cursor: pointer; text-decoration: underline; font-size: 13px;">
                            Forgot password?
                        </button>
                    </div>
                `;
                usingPhoneLogin = true;
            }
        }

        async function showForgotPassword() {
            const email = prompt('Enter your email address to reset your password:');
            if (!email) return;

            if (!email.includes('@')) {
                alert('Please enter a valid email address.');
                return;
            }

            try {
                const response = await api.request('/auth/reset-password', {
                    method: 'POST',
                    body: JSON.stringify({ email })
                });

                if (response.success) {
                    // In development, backend returns the reset code
                    if (response.resetCode) {
                        const resetCode = prompt(`Password reset code sent!\n\nDEVELOPMENT MODE: Your reset code is ${response.resetCode}\n\nEnter the 3-digit code:`);
                        if (resetCode) {
                            await handleResetCode(resetCode, email);
                        }
                    } else {
                        alert('Password reset code sent to ' + email + '\n\nCheck your email and enter the code when you receive it.');
                        const resetCode = prompt('Enter the 3-digit reset code from your email:');
                        if (resetCode) {
                            await handleResetCode(resetCode, email);
                        }
                    }
                }
            } catch (error) {
                console.error('Reset password error:', error);
                alert('Failed to send reset code. Please try again.');
            }
        }

        async function handleResetCode(resetCode, email) {
            const newPassword = prompt('Enter your new password (minimum 6 characters):');
            if (!newPassword) return;

            if (newPassword.length < 6) {
                alert('Password must be at least 6 characters long.');
                return;
            }

            try {
                const response = await api.request(`/auth/reset-password/${resetCode}`, {
                    method: 'PUT',
                    body: JSON.stringify({ password: newPassword })
                });

                if (response.success) {
                    alert('Password reset successful! You can now login with your new password.');
                } else {
                    alert('Invalid or expired reset code. Please try again.');
                }
            } catch (error) {
                console.error('Reset code error:', error);
                alert('Invalid or expired reset code. Please request a new one.');
            }
        }

        // ============================================
        // INITIALIZE ON PAGE LOAD
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[Phoenix] Initializing unified app...');

            // Start view manager
            ViewManager.init();

            // Initialize auth controller
            Auth.init();

            // Add CSS animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
                .grid-underlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-image:
                        linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
                    background-size: 50px 50px;
                    opacity: 0.1;
                    pointer-events: none;
                    z-index: 0;
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>
